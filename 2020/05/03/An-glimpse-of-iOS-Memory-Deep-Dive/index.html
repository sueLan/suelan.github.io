<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="RY&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" type="image/ico" href="[object Object]"/>
  
  <title>
    
      A glimpse of iOS Memory Deep Dive | RY &#39;s Blog
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    
<script src="/js/qrious.js"></script>

  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    
<script src="/js/local-search.js"></script>


<meta name="generator" content="Hexo 5.4.2"></head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>RY 's Blog</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/series/" class="item-link">Series</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/series/" class="menu-link">Series</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off"
                    placeholder="Please enter your keyword(s) to search." spellcheck="false"
                    type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>A glimpse of iOS Memory Deep Dive</h2>
  <p class="post-date">2020-05-03</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>This is an pretty good session about iOS memory. <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2018/416/">iOS Memory Deep Dive - WWDC 2018 - Videos - Apple Developer</a>. I saw it and took some notes here. </p>
<blockquote>
<p>Not all memory is created equal. </p>
</blockquote>
<p>There are dirty memory, clean memory, compressed memory in iOS system. We have to know the differences between them. </p>
<h2 id="Page"><a href="#Page" class="headerlink" title="Page"></a>Page</h2><p>Page is typically 16KB in size and operating system gives it to you when your app requests memory.  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memory in use = number of pages x page size </span><br></pre></td></tr></table></figure>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/b576f28d.png" alt="b576f28d.png"></p>
<p>Some pages can hold multiple objects, and some objects<br>can span multiple pages. </p>
<h3 id="Pages-Types"><a href="#Pages-Types" class="headerlink" title="Pages Types"></a>Pages Types</h3><ul>
<li><p>Clean</p>
<ul>
<li>Data that can be paged out of memory</li>
<li>Memory mapped files</li>
<li>frameworks*</li>
</ul>
</li>
<li><p>Dirty </p>
<ul>
<li>memory written by an app </li>
<li>all heap allocations</li>
<li>decoded image buffers</li>
</ul>
</li>
<li>Comporessed </li>
</ul>
<blockquote>
<p>There is no traditional disk swap in iOS </p>
</blockquote>
<h2 id="Memory-compressor"><a href="#Memory-compressor" class="headerlink" title="Memory compressor"></a>Memory compressor</h2><p>The system will do the compression and decompression for you by memory compressor.</p>
<p>What does Memory compressor do? </p>
<ul>
<li>Compresses unaccessed pages </li>
<li>Decompresses pages upon access</li>
</ul>
<p>Before being compressed: </p>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/cdb635fb.png" alt="cdb635fb.png"></p>
<p>After being compressed:<br><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/8b7d45fa.png" alt="8b7d45fa.png"></p>
<p>When you got Memory warning, you App is not always the cause. Maybe because the compressor freeing memory. Like, you receiving a phone call while using the App.</p>
<p>After being decompressed: </p>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/f0910e00.png" alt="f0910e00.png"></p>
<p>After removing objects in <code>didReceiveMemoryWarning</code> </p>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/28bedf77.png" alt="28bedf77.png"></p>
<h2 id="Caching"><a href="#Caching" class="headerlink" title="Caching"></a>Caching</h2><ul>
<li>Trade-offs between CPU and memory. Caching can reduce the CPU usage and time complexity, but it costs memory. </li>
<li>Remember the compressor. When decompressing, the used memory will be increased.</li>
<li>Prefer NSCache over dictionary. </li>
</ul>
<h2 id="Memory-Profile"><a href="#Memory-Profile" class="headerlink" title="Memory Profile"></a>Memory Profile</h2><p>It is the dirty size + the compressed size that the system uses to determine how much memory the app is really using. </p>
<p>We should mainly focuse on these two part, dirty and compressed memory when analyzing the memory profile.<br><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/8af52c4f.png" alt="8af52c4f.png"></p>
<h2 id="Tools-for-Profiling-Footprint"><a href="#Tools-for-Profiling-Footprint" class="headerlink" title="Tools for Profiling Footprint"></a>Tools for Profiling Footprint</h2><ol>
<li><p>Xcode memory gauge<br><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/447accd0.png" alt="447accd0.png"></p>
</li>
<li><p>Instruments</p>
</li>
</ol>
<ul>
<li>Allocations </li>
<li>Leaks </li>
<li>VM Tracker <ul>
<li>providing profiles for dirty and compressed memories. </li>
<li><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/69341a61.png" alt="69341a61.png"></li>
</ul>
</li>
<li>Virtual memory trace <ul>
<li><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/1ca65c7e.png" alt="1ca65c7e.png"></li>
</ul>
</li>
</ul>
<ol start="3">
<li>Debugger<br><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/cd78fa8b.png" alt="cd78fa8b.png"></li>
<li>memory graph </li>
</ol>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/af606628.png" alt="af606628.png"></p>
<h2 id="working-with-memory-graph-using-commands"><a href="#working-with-memory-graph-using-commands" class="headerlink" title="working with memory graph using commands"></a>working with memory graph using commands</h2><h3 id="vmmap"><a href="#vmmap" class="headerlink" title="vmmap"></a>vmmap</h3><p><code>vmmap</code> helps to show some dirty memory info of your app. In general, we should look for the big number for the size.<br>There are <code>virtual size</code>, <code>resident size</code>, <code>dirty size</code>, <code>swapped size</code> columns here. </p>
<p>According to this <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2018/416/">session</a>, we can ignore the <code>virtual size</code>, because it is memory requested by the app, while not neccessarily be used.  <code>swapped size</code> is related to compressed memory. So we should care more about <code>dirty size</code> and <code>swapped size</code>.</p>
<h4 id="An-example-of-using-vmmap-to-debug-a-memory-issue"><a href="#An-example-of-using-vmmap-to-debug-a-memory-issue" class="headerlink" title="An example of using vmmap to debug a memory issue"></a>An example of using vmmap to debug a memory issue</h4><p>First, we can use summary info to look for the big numbers in <code>virtual size</code> and <code>swapped size</code> colomn. Here, we find <code>CG Image</code> takes much more memory than others. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmmap --summary PlanetPics.memgraph</span><br></pre></td></tr></table></figure>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/d58088d1.png" alt="d58088d1.png"></p>
<p>Then, we use <code>grep</code> to get more info about <code>CG Image</code>.<br><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/751c8f78.png" alt="751c8f78.png"></p>
<p>There are  two regions here, the last row is summary info. The secong CG Image region takes more takes more dirty and swapped memory. So we have to see more infomation of this region by using <code>--verbose</code> option.</p>
<p>All these commands can work with other shell commands, like redirecting the output stream a <code>output.txt</code> file. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmmap --verbose PlanetPics.memgraph | grep &quot; CG image&quot; | &gt; output.txt</span><br></pre></td></tr></table></figure>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/14c0b2ff.png" alt="14c0b2ff.png"></p>
<p>And we will more regions.   </p>
<blockquote>
<p>It turns out that vmmap, by default, if it finds contiguous regions, it collapses. A general rule. the later region was created, the later my app’s life cycle it happened. Chance are this later region is more closely tied to whatever caused that memory pike. </p>
</blockquote>
<p>So, we start to look at the last region. We can use the start memory address of the last region and search it in the memory graph in XCode.</p>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/5d389834.png" alt="5d389834.png"></p>
<p>Or use <code>leak</code> to get the trace tree. By scanning these info, we would find more clues. </p>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/f63287f5.png" alt="f63287f5.png"></p>
<p>Here, using <code>malloc_history</code> to see the back trace for this object, we found the related code creating this particular VM memory. </p>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/d8143352.png" alt="d8143352.png"></p>
<ol>
<li>vmmap and AWK</li>
</ol>
<p>This command can work with other commands.<br><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/bca9bf95.png" alt="bca9bf95.png"></p>
<h3 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leaks App.memgraph</span><br></pre></td></tr></table></figure>
<p>It not only shows the cycle, but also the root object of the cycle. </p>
<ul>
<li><p>leak circle<br><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/21107588.png" alt="21107588.png"></p>
</li>
<li><p>root object<br><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/fbc1d8bb.png" alt="fbc1d8bb.png"></p>
</li>
</ul>
<h3 id="heap"><a href="#heap" class="headerlink" title="heap"></a>heap</h3><ul>
<li>Shows objects allocated on the heap; </li>
<li>useful for indentifying large objects in memory adn what allocated it. <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">heap App.memgraph</span><br><span class="line">heap App.memgraph -addresses all | &lt;classes-pattern&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>heap</code> command shows the class name  in <code>CLASS_NAME</code> column, the num of the class in <code>COUNT</code> column, the average size of the object  in the <code>AVG</code> column, the total size in the <code>BYTES</code> column. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heap App.memgraph -sortBySize | &gt; ~/output.txt</span><br></pre></td></tr></table></figure>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/b0766b6a.png" alt="b0766b6a.png"></p>
<h3 id="malloc-history"><a href="#malloc-history" class="headerlink" title="malloc_history"></a>malloc_history</h3><p>In some cases, we not only want to know the memory size, but also want to know the how it created. So, here comes the <code>malloc_history</code> command.</p>
<ul>
<li>enable the malloc_stack logging</li>
</ul>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/1153a225.png" alt="1153a225.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">malloc_history App.memgraph [address]</span><br></pre></td></tr></table></figure>
<p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/a70d0d43.png" alt="a70d0d43.png"></p>
<h3 id="Which-tool-to-pick"><a href="#Which-tool-to-pick" class="headerlink" title="Which tool to pick"></a>Which tool to pick</h3><p><img src="f30bdfea-25ac-4eb9-af3e-278a74a85022/d68340ee.png" alt="d68340ee.png"></p>
<p>Use <code>vmmap</code> and <code>heap</code> to find some objects or regions with big number,  use <code>leak</code> to see references between objects, like finding circular reference; use <code>malloc_history</code> to see how it is created.  </p>
<h2 id="Related"><a href="#Related" class="headerlink" title="Related:"></a>Related:</h2><ul>
<li><a href="https://suelan.github.io/2020/05/03/iOS-images-in-memory/">iOS-images-in-memory</a></li>
</ul>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#WWDC" >
    <span class="tag-code">WWDC</span>
  </a>

  <a href="/tags#Image" >
    <span class="tag-code">Image</span>
  </a>

  <a href="/tags#Debug" >
    <span class="tag-code">Debug</span>
  </a>

  <a href="/tags#Memory" >
    <span class="tag-code">Memory</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2020/04/25/How-to-inspect-network-activity-of-your-iOS-applicatoin/">
        <span class="nav-arrow">← </span>
        
          How Flipper network plugin works under the hood
        
      </a>
    
    
      <a class="nav-right" href="/2020/05/03/iOS-images-in-memory/">
        
          iOS images in memory
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
  
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">scan qr code and share this article</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Utterances START -->
      <div id="utterances"></div>
      <script src="https://utteranc.es/client.js"
        repo=""
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async></script>    
      <!-- Utterances END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Page"><span class="toc-nav-text">Page</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Pages-Types"><span class="toc-nav-text">Pages Types</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Memory-compressor"><span class="toc-nav-text">Memory compressor</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Caching"><span class="toc-nav-text">Caching</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Memory-Profile"><span class="toc-nav-text">Memory Profile</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Tools-for-Profiling-Footprint"><span class="toc-nav-text">Tools for Profiling Footprint</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#working-with-memory-graph-using-commands"><span class="toc-nav-text">working with memory graph using commands</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vmmap"><span class="toc-nav-text">vmmap</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#An-example-of-using-vmmap-to-debug-a-memory-issue"><span class="toc-nav-text">An example of using vmmap to debug a memory issue</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#leak"><span class="toc-nav-text">leak</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#heap"><span class="toc-nav-text">heap</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#malloc-history"><span class="toc-nav-text">malloc_history</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Which-tool-to-pick"><span class="toc-nav-text">Which tool to pick</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Related"><span class="toc-nav-text">Related:</span></a></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'https://suelan.github.io/2020/05/03/An-glimpse-of-iOS-Memory-Deep-Dive/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>






    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2022 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a target="_blank" rel="noopener" href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->


<script src="/js/script.js"></script>


  </body>
</html>