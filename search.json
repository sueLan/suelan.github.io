[{"title":"Understand onViewableItemsChanged in FlatList","url":"/2020/01/21/onViewableItemsChanged/","content":"\n## What is onViewableItemsChanged\n\n`onViewableItemsChanged` is a props in [VirtualizedList](https://facebook.github.io/react-native/docs/flatlist#onviewableitemschanged) and it's subclass [FlatList]((https://facebook.github.io/react-native/docs/flatlist#onviewableitemschanged)). When we scroll a FlatList, the items showed on the screen change. This function is called telling what current `viewableItems` are and what `changed` items are. \n\nThis function should be used together with [viewabilityConfig](https://facebook.github.io/react-native/docs/virtualizedlist#viewabilityconfig). A specific `onViewableItemsChanged` will be called when its corresponding `ViewabilityConfig`'s conditions are met.\n\nHere is [ViewabilityConfig](https://facebook.github.io/react-native/docs/flatlist#viewabilityconfig) \n```js \nexport type ViewabilityConfig = {\n  /**\n   * Minimum amount of time (in milliseconds) that an item must be physically viewable before the\n   * viewability callback will be fired. A high number means that scrolling through content without\n   * stopping will not mark the content as viewable.\n   */\n  minimumViewTime?: number,\n\n  /**\n   * Percent of viewport that must be covered for a partially occluded item to count as\n   * \"viewable\", 0-100. Fully visible items are always considered viewable. A value of 0 means\n   * that a single pixel in the viewport makes the item viewable, and a value of 100 means that\n   * an item must be either entirely visible or cover the entire viewport to count as viewable.\n   */\n  viewAreaCoveragePercentThreshold?: number,\n\n  /**\n   * Similar to `viewAreaPercentThreshold`, but considers the percent of the item that is visible,\n   * rather than the fraction of the viewable area it covers.\n   */\n  itemVisiblePercentThreshold?: number,\n\n  /**\n   * Nothing is considered viewable until the user scrolls or `recordInteraction` is called after\n   * render.\n   */\n  waitForInteraction?: boolean,\n|};\n```\nHere is the type of `onViewableItemsChanged`: \n```js\n /**\n   * Called when the viewability of rows changes, as defined by the\n   * `viewabilityConfig` prop.\n   */\n  onViewableItemsChanged?: ?(info: {\n    viewableItems: Array<ViewToken>,\n    changed: Array<ViewToken>,\n    ...\n  }) => void,\n  \nexport type ViewToken = {\n  item: any,\n  // The key of this item\n  key: string,\n  index: ?number,\n  // indicated whether this item is viewable or not\n  isViewable: boolean,\n  section?: any,\n  ...\n};\n```\n## How to use it \n\n```js\n  viewabilityConfig = {\n    waitForInteraction: true,\n    viewAreaCoveragePercentThreshold: 95,\n    itemVisiblePercentThreshold: 75\n  }\n\n  onViewableItemsChanged = ({viewableItems, changed}) => {\n    console.log(\"Visible items are\", viewableItems);\n    console.log(\"Changed in this iteration\", changed);\n  };\n\n  render() {\n    return (\n      <FlatList\n        style={{\n          paddingTop: 60\n        }}\n        viewabilityConfig={this.viewabilityConfig}\n        onViewableItemsChanged={this.onViewableItemsChanged}\n        data={this._items}\n        renderItem={this._renderItem}\n        keyExtractor={item => item.id}\n      />\n    )\n  }\n```\n\n## The Implementation \n\n### 1. Overview \n\n\n![a0336b02.png](/img/9af4f3b0-fe64-4a98-b94e-d456f65ae7cc/a0336b02.png)\n\n### 2. The Viewable Region \n\n1. Get VirtualizedList layout info from the `nativeEvent` using the `onScroll` func, and store these info in `scrollMetrics` object. \n\n\n```js\nconst timestamp = e.timeStamp;\nlet visibleLength = this._selectLength(e.nativeEvent.layoutMeasurement);\nlet contentLength = this._selectLength(e.nativeEvent.contentSize);\nlet offset = this._selectOffset(e.nativeEvent.contentOffset);\nlet dOffset = offset - this._scrollMetrics.offset;\n\n// ...\n\n this._scrollMetrics = {\n      contentLength,\n      dt,\n      dOffset,\n      offset,\n      timestamp,\n      velocity,\n      visibleLength,\n    };\n\n```\n\n\n```js\n_selectLength(\n    metrics: $ReadOnly<{\n      height: number,\n      width: number,\n      ...\n    }>,\n  ): number {\n    return !this.props.horizontal ? metrics.height : metrics.width;\n}\n\n_selectOffset(\n    metrics: $ReadOnly<{\n      x: number,\n      y: number,\n      ...\n    }>,\n  ): number {\n    return !this.props.horizontal ? metrics.y : metrics.x;\n}\n\n```\n\n\n![5d152b82.png](/img/9af4f3b0-fe64-4a98-b94e-d456f65ae7cc/5d152b82.png)\n\n## ViewabilityHelperCallbackTuple\n\n```js\n_viewabilityTuples: Array<ViewabilityHelperCallbackTuple> = [];\n```\n\n`ViewabilityHelperCallbackTuple` is an array storing `ViewabilityHelper/onViewableItemsChanged` pairs\n\n```js\ntype ViewabilityHelperCallbackTuple = {\n  viewabilityHelper: ViewabilityHelper,\n  onViewableItemsChanged: (info: {\n    viewableItems: Array<ViewToken>,\n    changed: Array<ViewToken>,\n    ...\n  }) => void,\n  ...\n};\n```\n\nIf a developer defines [viewabilityConfigCallbackPairs](https://facebook.github.io/react-native/docs/flatlist#viewabilityconfigcallbackpairs),  each `viewabilityConfig` will be used to initialize a `ViewabilityHelper` object. \n\n[ref code](https://github.com/facebook/react-native/blob/84adc85523770ebfee749a020920e0b216cf69f8/Libraries/Lists/VirtualizedList.js#L743). \n\n```js\n if (this.props.viewabilityConfigCallbackPairs) {\n      this._viewabilityTuples = this.props.viewabilityConfigCallbackPairs.map(\n        pair => ({\n          viewabilityHelper: new ViewabilityHelper(pair.viewabilityConfig),\n          onViewableItemsChanged: pair.onViewableItemsChanged,\n        }),\n      );\n    } else if (this.props.onViewableItemsChanged) {\n      this._viewabilityTuples.push({\n        viewabilityHelper: new ViewabilityHelper(this.props.viewabilityConfig),\n        onViewableItemsChanged: this.props.onViewableItemsChanged,\n      });\n    }\n\n```\n\nHere, we should pay attention on `ViewabilityHelper`, which is `\na utility class for calculating viewable items based on the viewabilityConfig and metrics, like scroll position and layout.\n`\nFor a `VirtualizedList`, there would be multiple `ViewabilityHelper` objects in `_viewabilityTuples`,  containing different `viewabilityConfig` to handle different viewability conditions.  \n\nThere are some important props in `ViewabilityHelper`. \n\n```js\nclass ViewabilityHelper {\n  _config: ViewabilityConfig;\n  _hasInteracted: boolean = false;\n  /* A set of `timeoutID`, used for memory management */\n  _timers: Set<number> = new Set();\n  // Indexs of the viewable items\n  _viewableIndices: Array<number> = [];\n  // A map for viewable items\n  _viewableItems: Map<string, ViewToken> = new Map();\n}\n\n```\n\nThere is a func `_updateViewableItems`,  which is called in many scenarios, like `onScroll` method. It will call `viewabilityHelper.onUpdate` to calculate the viewable items. \n\n```js\n_updateViewableItems(data: any) {\n    const {getItemCount} = this.props;\n\n    this._viewabilityTuples.forEach(tuple => {\n      tuple.viewabilityHelper.onUpdate(\n        getItemCount(data),\n        // contentOffset of the list \n        this._scrollMetrics.offset,\n        // ğŸŒŸ viewportHeight \n        this._scrollMetrics.visibleLength, \n        this._getFrameMetrics,\n        this._createViewToken,\n        tuple.onViewableItemsChanged,\n        this.state,\n      );\n    });\n  }\n\n```\n- `this._scrollMetrics.visibleLength` is used as `viewportHeight`\n- `this._createViewToken` is used to construct a `ViewToken` object, which contains `item` data, `index`, `key` and viewability of the `item`. \n\n- [this._getFrameMetrics](1864) will get frame of the cell by index from the `this._frames` map, and its shape is \n\n```js\n{ [cellKey]: {\n      // offset of the item cell\n      offset: number, \n      // length of the item cell in the scrolling direction \n      length: number, \n      index: number,\n      inLayout: boolean,\n    }\n}\n```\n\n- The shape of the `this.state` is\n\n```js\ntype State = {\n  // The range of the rendered items, \n  // used for the optimization to reduce the scan size\n  first: number,\n  last: number,\n  ...\n};\n```\n\n### 3. How to get viewable items\n \nIn `onUpdate` method, it calls `computeViewableItems` to get `viewableIndices` \n\n#### computeViewableItems\n\nIn `computeViewableItems`, it only go through the specific range of items, [first, last]. If a item is viewable, it will be stored in an array named `viewableIndices`. \n\n```js\n  for (let idx = first; idx <= last; idx++) {\n      const metrics = getFrameMetrics(idx);\n      if (!metrics) {\n        continue;\n      }\n      // The top postion of current item cell, relative to the screen \n      const top = metrics.offset - scrollOffset;\n      // The bottom position of current item cell \n      const bottom = top + metrics.length;\n      if (top < viewportHeight && bottom > 0) {\n        firstVisible = idx;\n        if (\n          _isViewable(\n            viewAreaMode,\n            viewablePercentThreshold,\n            top,\n            bottom,\n            viewportHeight,\n            metrics.length,\n          )\n        ) {\n          viewableIndices.push(idx);\n        }\n      } else if (firstVisible >= 0) {\n        break;\n      }\n    }\n    return viewableIndices;\n  }\n```\n![layout.png](/img/9af4f3b0-fe64-4a98-b94e-d456f65ae7cc/3252d60e.png)\n\n### 4. The condition for viewable item \n\n An item is said to be in a \"viewable\" state when any of the following\n  is true for longer than `minimumViewTime` milliseconds (after an interaction if `waitForInteraction`\n is true):\n \n  - Occupying >= `viewAreaCoveragePercentThreshold` of the view area XOR fraction of the item\n   visible in the view area >= `itemVisiblePercentThreshold`.\n\n   \n   ![3a915aee.png](/img/9af4f3b0-fe64-4a98-b94e-d456f65ae7cc/cc1f4f90.png)\n  - Entirely visible on screen\n\n\n![7c4f2df0.png](/img/9af4f3b0-fe64-4a98-b94e-d456f65ae7cc/a8e66aed.png)\n\n[ref](https://github.com/facebook/react-native/blob/84adc85523770ebfee749a020920e0b216cf69f8/Libraries/Lists/ViewabilityHelper.js#L64)\n\n```js\nfunction _isViewable(\n  viewAreaMode: boolean,\n  viewablePercentThreshold: number,\n  top: number,\n  bottom: number,\n  viewportHeight: number,\n  itemLength: number,\n): boolean {\n  if (_isEntirelyVisible(top, bottom, viewportHeight)) {\n    return true;\n  } else {\n    const pixels = _getPixelsVisible(top, bottom, viewportHeight);\n    const percent =\n      100 * (viewAreaMode ? pixels / viewportHeight : pixels / itemLength);\n    return percent >= viewablePercentThreshold;\n  }\n}\n\nfunction _getPixelsVisible(\n  top: number,\n  bottom: number,\n  viewportHeight: number,\n): number {\n  const visibleHeight = Math.min(bottom, viewportHeight) - Math.max(top, 0);\n  return Math.max(0, visibleHeight);\n}\n\nfunction _isEntirelyVisible(\n  top: number,\n  bottom: number,\n  viewportHeight: number,\n): boolean {\n  return top >= 0 && bottom <= viewportHeight && bottom > top;\n}\n```\n[code here](https://github.com/facebook/react-native/blob/84adc85523770ebfee749a020920e0b216cf69f8/Libraries/Lists/ViewabilityHelper.js#L300)\n\n### Timer and Schedule \nInside [onUpdate func in ViewabilityHelper](https://github.com/facebook/react-native/blob/84adc85523770ebfee749a020920e0b216cf69f8/Libraries/Lists/ViewabilityHelper.js#L228), if the user defines `minimumViewTime` value, the `_onUpdateSync` should be scheduled to be called, using `setTimeout`.\n\n```js\n this._viewableIndices = viewableIndices;\n if (this._config.minimumViewTime) {\n      const handle = setTimeout(() => {\n        this._timers.delete(handle);\n        this._onUpdateSync(\n          viewableIndices,\n          onViewableItemsChanged,\n          createViewToken,\n        );\n      }, this._config.minimumViewTime);\n      this._timers.add(handle);\n    } else {\n      this._onUpdateSync(\n        viewableIndices,\n        onViewableItemsChanged,\n        createViewToken,\n      );\n    }\n```\n\nAnd, in the [_onUpdateSync](https://github.com/facebook/react-native/blob/84adc85523770ebfee749a020920e0b216cf69f8/Libraries/Lists/ViewabilityHelper.js#L267) func, it will filter out indices that have gone out of view.\n\n\n```js\n    // Filter out indices that have gone out of view since this call was scheduled.\n    viewableIndicesToCheck = viewableIndicesToCheck.filter(ii =>\n      this._viewableIndices.includes(ii),\n    );\n\n```\n\n\n## Calculate changed items \n\nThere is a `preItems` array, it stores the previous visible items. Now we have a `nextItems` array, we got to know how to the `changed` array by extract the changed items. \n\nFor example, if scrolling down, some viewable items will become out of the screen, some hidden items will become viewable. \n![99830c30.png](/img/9af4f3b0-fe64-4a98-b94e-d456f65ae7cc/99830c30.png)\n\n```js\n_onUpdateSync(\n    viewableIndicesToCheck,\n    onViewableItemsChanged,\n    createViewToken,\n  ) {\n    // Filter out indices that have gone out of view since this call was scheduled.\n    viewableIndicesToCheck = viewableIndicesToCheck.filter(ii =>\n      this._viewableIndices.includes(ii),\n    );\n    const prevItems = this._viewableItems;\n    const nextItems = new Map(\n      viewableIndicesToCheck.map(ii => {\n        const viewable = createViewToken(ii, true);\n        return [viewable.key, viewable];\n      }),\n    );\n\n    const changed = [];\n    for (const [key, viewable] of nextItems) {\n      if (!prevItems.has(key)) {\n        changed.push(viewable);\n      }\n    }\n    for (const [key, viewable] of prevItems) {\n      if (!nextItems.has(key)) {\n        changed.push({...viewable, isViewable: false});\n      }\n    }\n    if (changed.length > 0) {\n      this._viewableItems = nextItems;\n      onViewableItemsChanged({\n        viewableItems: Array.from(nextItems.values()),\n        changed,\n        viewabilityConfig: this._config,\n      });\n    }\n  }\n}\n```","tags":["Dive into React Native"],"categories":["React Native"]},{"title":"Gaussian Filter","url":"/2019/07/12/Gaussian-Filter/","content":"\né«˜æ–¯å‡½æ•°åœ¨å­¦æœ¯é¢†åŸŸè¿ç”¨çš„éå¸¸å¹¿æ³›ã€‚ å†™å·¥ç¨‹äº§å“çš„æ—¶å€™ï¼Œç»å¸¸ç”¨å®ƒæ¥å»é™¤å›¾ç‰‡æˆ–è€…è§†é¢‘çš„å™ªéŸ³ï¼Œå¹³æ»‘å›¾ç‰‡, Blurå¤„ç†ã€‚æˆ‘ä»¬ä»Šå¤©æ¥çœ‹çœ‹é«˜æ–¯æ»¤æ³¢, Gaussian Filterã€‚ \n**1Dçš„é«˜æ–¯å‡½æ•°**\nä¸€ç»´çš„é«˜æ–¯å‡½æ•°ï¼ˆæˆ–è€…å«æ­£æ€åˆ†å¸ƒï¼‰æ–¹ç¨‹è·Ÿå›¾å½¢å¦‚ä¸‹: \n$$G(x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} e^{-\\frac{x^2}{2\\sigma^2}}$$\n![image.png](/img/Gaussian-Filter/gaussian.png)\n\n$\\mu$æ˜¯å‡å€¼ï¼›$\\sigma$ æ˜¯æ ‡å‡†æ–¹å·®ã€‚å®ƒæœ‰ä¸ªé‡è¦ç‰¹ç‚¹æ˜¯ -$\\sigma$ åˆ°+$\\sigma$ ä¹‹é—´çš„G(x)ä¸xè½´å›´æˆçš„é¢ç§¯å å…¨éƒ¨é¢ç§¯çš„68.2%.  -2$\\sigma$ åˆ°+2$\\sigma$ä¹‹é—´çš„é¢ç§¯å 95%ã€‚-3$\\sigma$ åˆ°+3$\\sigma$ä¹‹é—´çš„é¢ç§¯å 99.7%ã€‚\nå¦‚æœæˆ‘ä»¬ç»™-3$\\sigma$ åˆ°+3$\\sigma$åŒºé—´, å®ƒå‡ ä¹åŒ…æ‹¬äº†æ‰€æœ‰å¯èƒ½çš„ç‚¹ã€‚è¿™ä¸ªç‰¹æ€§å¯¹Filter kernelçš„ç”Ÿæˆå¾ˆé‡è¦ã€‚\n\n\n**2Dçš„é«˜æ–¯å‡½æ•°**\n$$G(x, y) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} e^{-\\frac{x^2 + y^2}{2\\sigma^2}}$$\n\n![image.png](/img/Gaussian-Filter/2d-gaussian.png)\n\n\n**æ‰€è°“é«˜æ–¯æ»¤æ³¢æ“ä½œï¼Œå…¶å®å°±æ˜¯ç”¨é«˜æ–¯å‡½æ•°å¯¹imageåšå·ç§¯è®¡ç®—**ã€‚ä½†ä¸€èˆ¬å›¾åƒåœ¨è®¡ç®—æœºä¸­ä¸€èˆ¬æ˜¯ç¦»æ•£çš„3DçŸ©é˜µï¼Œè€Œé«˜æ–¯å‡½æ•°æ˜¯è¿ç»­å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä»è¿ç»­é«˜æ–¯å‡½æ•°ä¸­é‡‡æ ·ç”Ÿæˆç¦»æ•£çš„2DçŸ©é˜µï¼Œå³Gaussian Filter Kernelã€‚ æˆ‘ä»¬å¯ä»¥æ§åˆ¶Kernalçš„sizeï¼Œè®©å®ƒçš„ç‚¹éƒ½è½åœ¨-3$\\sigma$ åˆ°+3$\\sigma$åŒºé—´å†…ã€‚\n### ç”Ÿæˆé«˜æ–¯kernel \n\n```c++\n// Function to create Gaussian filter; sigma is standard deviation\nMatrix getGaussian(int height, int width, double sigma)\n{\n    Matrix kernel(height, Array(width));\n    // sum is for normalization \n    double sum=0.0;\n    int i,j;\n    \n   // generating the kernel \n    for (i=0 ; i<height ; i++) {\n        for (j=0 ; j<width ; j++) {\n            // using gaussian function to generate gaussian filter \n            kernel[i][j] = exp(-(i*i+j*j)/(2*sigma*sigma))/(2*M_PI*sigma*sigma);\n            sum += kernel[i][j];\n        }\n    }\n   \n   // normalising the Kernel \n    for (i=0 ; i<height ; i++) {\n        for (j=0 ; j<width ; j++) {\n            kernel[i][j] /= sum;\n        }\n    }\n\n    return kernel;\n}\n```\n[ä»£ç æ¥æº](https://gist.github.com/OmarAflak/aca9d0dc8d583ff5a5dc16ca5cdda86a)\næ¯”å¦‚ï¼Œæˆ‘ä»¬ç”¨é«˜æ–¯å‡½æ•°ç”Ÿæˆäº†ä¸€ä¸ª5x5ï¼Œ $\\sigma$æ˜¯1çš„é«˜æ–¯æ ¸2DçŸ©é˜µ:\n![image.png](/img/Gaussian-Filter/gaussian_matrix.png)\nå®ƒæœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š \n1. æœ€ä¸­é—´çš„å€¼æœ€å¤§ï¼Œå€¼å‘å‘¨å›´é€’å‡\n2. $\\sigma$è¶Šå¤§ï¼Œé«˜æ–¯å‡½æ•°çš„å³°è¶Šå®½ï¼Œä¸´æ¥çš„æ•°å€¼å·®è¶Šå¤§\n\n### å¯¹å›¾ç‰‡åº”ç”¨é«˜æ–¯Filter\nå¯¹æŸä¸ªåƒç´ ç‚¹image[i][j]ï¼ŒFitlerå¯¹åŸå›¾å¯¹åº”çš„åƒç´ ç‚¹åšç‚¹ä¹˜ï¼Œç›¸åŠ ã€‚ ç”Ÿæˆæ–°çš„å€¼ã€‚\n![https://www.youtube.com/watch?v=C_zFhWdM4ic](/img/Gaussian-Filter/convoltion.gif)\n[ææ–™æ¥æº](https://www.youtube.com/watch?v=C_zFhWdM4ic)\n```c++\nImage applyFilter(Image &image, Matrix &filter){\n    assert(image.size()==3 && filter.size()!=0);\n\n    int height = image[0].size();\n    int width = image[0][0].size();\n    int filterHeight = filter.size();\n    int filterWidth = filter[0].size();\n    int newImageHeight = height-filterHeight+1;\n    int newImageWidth = width-filterWidth+1;\n    int d,i,j,h,w;\n\n    Image newImage(3, Matrix(newImageHeight, Array(newImageWidth)));\n    \n   // iter the image pixel\n    for (d=0 ; d<3 ; d++) {\n        for (i=0 ; i<newImageHeight ; i++) {\n            for (j=0 ; j<newImageWidth ; j++) {\n                // using filter convolute the image matrix\n                for (h=i ; h<i+filterHeight ; h++) {\n                    for (w=j ; w<j+filterWidth ; w++) {\n                        newImage[d][i][j] += filter[h-i][w-j]*image[d][h][w];\n                    }\n                }\n            }\n        }\n    }\n\n    return newImage;\n}\n```\nå¦‚ä¸‹å›¾ï¼Œå›¾ç‰‡è¢«å¹³æ»‘å¤„ç†äº†ã€‚\n![image.png](/img/Gaussian-Filter/blur_image.png)\n\n#### More: \n[https://gist.github.com/OmarAflak/aca9d0dc8d583ff5a5dc16ca5cdda86a](https://gist.github.com/OmarAflak/aca9d0dc8d583ff5a5dc16ca5cdda86a)\n\n","tags":["CV"],"categories":["Algorithm"]},{"title":"792. Number of Matching Subsequences","url":"/2019/07/06/792-Number-of-Matching-Subsequences/","content":"\n## [é¢˜ç›®](https://leetcode-cn.com/problems/number-of-matching-subsequences/)\n\n## Solution 1 \næ€è·¯ï¼šå­˜å‚¨ + äºŒåˆ†æŸ¥æ‰¾\n1. é¦–å…ˆå°†å­—ç¬¦ä¸€é›†å¯¹åº”çš„ä¸‹æ ‡å­˜å‚¨åœ¨26 * nçš„äºŒç»´æ•°ç»„ä¸­ã€‚æ¯”å¦‚å¯¹å­—ç¬¦ä¸² 'abcdea'å­˜å‚¨ä¸º\n\n| Char | Index |\n| --- | --- |\n| 0 | [0, 5] |\n| 1 | [1] |\n| 2 | [2] |\n| 3 | [3] |\n| 4 | [4] |\n| ... |  |\n| 25 |  |\n\nå¯¹åº”ä»£ç : \n\n```c++\n  vector<vector<int>> store(26, vector<int>());\n    for (int i = 0; i < S.size(); ++i) {\n        // å­˜å‚¨å­—æ¯è·Ÿindex\n        store[S[i] - 'a'].push_back(i);\n    }\n```\n\n1. å¯¹æŸä¸ªwordï¼ŒæŸ¥æ‰¾å®ƒçš„å­—ç¬¦æ˜¯å¦åœ¨äºŒç»´æ•°ç»„ä¸­ã€‚\n\n```c++\nint numMatchingSubseq(string S, vector<string>& words) {\n    vector<vector<int>> store(26, vector<int>());\n    for (int i = 0; i < S.size(); ++i) {\n        // å­˜å‚¨å­—æ¯è·Ÿindex\n        store[S[i] - 'a'].push_back(i);\n    }\n\n    int res = 0;\n    for (auto &word: words) {\n        int x = -1;\n        bool found = true;\n        for (auto c: word) {\n            // search\n            auto it = upper_bound(store[c - 'a'].begin(), store[c - 'a'].end(), x);\n            if (it == store[c - 'a'].end()) {\n                found = false;\n                break;\n            } else {\n                // æ›´æ–°æœ€æ–°çš„ä¸‹æ ‡ä½ç½®\n                x = *it;\n            }\n        }\n        if (found) res++;\n    }\n\n    return res;\n}\n```\n## Solution 2 \nç¬¬äºŒç§æ€è·¯ï¼Œæ¥è‡ª[Stefanå¤§ç¥](https://leetcode.com/problems/number-of-matching-subsequences/discuss/117634/Efficient-and-simple-go-through-words-in-parallel-with-explanation)ã€‚ \nè¿™ç§æ€è·¯ï¼Œå­˜å‚¨çš„æ˜¯wordsä¸­ç­‰å¾…åŒ¹é…çš„å­—ç¬¦çš„index pairã€‚æ¯”å¦‚ words = [\"a\", \"bb\", \"acd\", \"ace\"]å­˜å‚¨çš„ç»“æœæ˜¯: \n|  idx | pair |\n| --- | --- |\n| â€˜a' | [(0, 1), (2, 1), (3, 1)] |\n| â€˜b' | [(1, 1)] |\n\n\n\n```c++\nint numMatchingSubseq(string S, vector<string>& words) {\n    vector<pair<int, int>> waiting[128];\n    for (int i = 0; i < words.size(); i++)\n        waiting[words[i][0]].emplace_back(i, 1);\n    for (char c : S) {\n        auto advance = waiting[c];\n        waiting[c].clear();\n        for (auto it : advance)\n            waiting[words[it.first][it.second++]].push_back(it);\n    }\n\n    return waiting[0].size();\n}\n```\n\n"},{"title":"1011. Capacity To Ship Packages Within D Days","url":"/2019/06/14/1011-Capacity-To-Ship-Packages-Within-D-Days/","content":"## [é¢˜ç›®](https://leetcode.com/problems/capacity-to-ship-packages-within-d-days/)\n## åˆ†æ\næ¥è‡ªVladç¥çš„è§£ç­”https://leetcode.com/problems/capacity-to-ship-packages-within-d-days/discuss/256737/C%2B%2B-Binary-Search \n\nå…ˆå®šä¸‹å¯èƒ½çš„æ‰¿é‡èŒƒå›´: \n1. æœ€å¤§ maxCap æ˜¯æ‰€æœ‰åŒ…è£¹çš„é‡é‡å’Œ\n2. æœ€å° minCap = max{ maxCap/D, æœ€é‡çš„åŒ…è£¹é‡é‡) \n3. ç”¨ Binary Search æŸ¥æ‰¾ `the least weight capacity of the ship`, è¯¥èˆ¹èƒ½åœ¨Då¤©å†…è¿é€å®Œæ‰€æœ‰è´§ç‰©\n\n```c++\n// æ±‚è½½è´§åŠ›ä¸º capacity çš„èˆ¹è¿å®Œæ‰€æœ‰è´§ç‰©çš„å¤©æ•°\nint countDays(vector<int>& weights, int capacity) {\n    int count = 1, load = 0;\n    for (auto w: weights) {\n        load += w;\n        if (load > capacity) {\n            // è¶…è¿‡è½½é‡èƒ½åŠ›ï¼Œç¬¬äºŒå¤©ç»§ç»­è¿è½½\n            load = w;\n            count++;\n        }\n    }\n\n    return count;\n}\n\nint shipWithinDays(vector<int>& weights, int D) {\n    auto maxCap = std::accumulate(weights.begin(), weights.end(), 0);\n    auto minCap = max(*max_element(weights.begin(), weights.end()), maxCap / D);\n    // Binary Search \n    while (minCap < maxCap) {\n        int mid = (minCap + maxCap) / 2;\n        if (countDays(weights, mid) <= D) {\n            maxCap = mid;\n        } else {\n            minCap = mid + 1;\n        }\n    }\n\n    return minCap;\n}\n\n```","tags":["Algorithm"],"categories":["Algorithm"]},{"title":"LeetCode:1014. Best Sightseeing Pair","url":"/2019/06/11/LeetCode-1014-Best-Sightseeing-Pair/","content":"\n## é¢˜ç›®ï¼š [1014. Best Sightseeing Pair](https://leetcode.com/problems/best-sightseeing-pair/)\n \n\n### åˆ†æ\nè¿™é“é¢˜æ±‚ `the maximum score of a pair of sightseeing spots`; score = A[i] + A[j] + i - j)ã€‚ æ˜¯ä¸ªæœ€ä¼˜è§£é—®é¢˜ã€‚  \nè¿­ä»£ä¸­ï¼Œå½“å‰idxä¸ºi; è¦è€ƒè™‘ (0, i-1)çš„æ•°ä¸­å¯¹scoreå¢ç›Šæœ€å¤§çš„æ•°çš„ä¸‹æ ‡æ˜¯max_idxã€‚ è®¡ç®— (max_idx, i)çš„scoreï¼Œ å¹¶è·Ÿä¹‹å‰æœ€å¤§å€¼åšæ¯”è¾ƒã€‚\n\n```c++\nint maxScoreSightseeingPair(vector<int> & A) {\n    // 2<= A.length <= 50000\n    int max_idx = 0, res = A[0], inc = 0;\n    for (int i = 1; i < A.size(); ++i) {\n        inc = A[max_idx] - i + max_idx;\n        res = max(res, A[i] + inc);\n        max_idx = A[i] > inc ? i : max_idx;\n    }\n\n    return res;\n}\n```\n\n**æ›´ä¸ºç®€çº¦çš„å†™æ³•ï¼š**\nmax_incæ¯æ¬¡è¿­ä»£åéƒ½è‡ªå‡1ï¼Œæ˜¯å› ä¸ºè¿›å…¥ä¸‹ä¸€æ¬¡è¿­ä»£i+1çš„æ—¶å€™ï¼Œå®ƒå¯¹åˆ†æ•°çš„å¢ç›Šåªå‰©ä¸‹äº†A[max_inc] + i - (i+1)ã€‚\n```c++\nint maxScoreSightseeingPair2(vector<int>& A) {\n    int max_inc = A[0] - 1, res = 0;\n    for (int i = 1; i < A.size(); ++i, max_inc--) {\n        res = max(res, max_inc + A[i]);\n        max_inc = max(A[i], max_inc);\n    }\n\n    return res;\n}\n```\n\næ—¶é—´å¤æ‚åº¦: $o(n)$","tags":["Algorithm"],"categories":["Algorithm"]},{"title":"React Native: ExpoKitæ¨¡å¼é…ç½®Push Notification Notification","url":"/2019/06/10/React-Native-ExpoKit-Notification/","content":"\nExpo sdkå·²ç»æœ‰ä¸€å¥—Push Notificationsçš„æ–¹æ¡ˆï¼Œæ¥å…¥æ–¹ä¾¿, ä½†éœ€è¦æœåŠ¡ç«¯é…åˆæ¥å…¥å¯¹åº”sdk.è€Œexpo-server-sdkä¸­é»˜è®¤ä½¿ç”¨Google Cloud Messaging å’Œ APNSï¼› å› ä¸ºAndroidå›½å†…æ— æ³•ç”¨è°·æ­Œçš„æœåŠ¡ï¼Œå†åŠ ä¸Šæ²¡æœ‰æœåŠ¡ç«¯å¯¹åº”å¼€å‘è¯­è¨€çš„sdk, æˆ‘ä»¬æœ€åè¿˜æ˜¯é€‰äº†ä¼ ç»Ÿçš„æ–¹å¼ã€‚\n\n## Expo Eject \nç”¨expoåˆ›å»ºçš„RNé¡¹ç›®å·²ç»ä¸å†æœ‰ios/ & android/çš„å·¥ç¨‹é…ç½®æ–‡ä»¶å¤¹ã€‚ æ‰€ä»¥æˆ‘ä»¬è¦å…ˆç”¨ `expo eject`å‘½åç”ŸæˆiOSè·ŸAndroidçš„å·¥ç¨‹é…ç½®æ–‡ä»¶, ã€‚\n\n`expo eject`ä¼šæ”¹å˜å¼€å‘æµç¨‹ï¼Œæ¯”å¦‚ï¼Œè¦è¿è¡Œä¸€ä¸ªé¡¹ç›®ï¼Œä¸æ­¢è¦`expo start`ï¼Œ è¿˜è¦ç”¨Xcodeæˆ–è€…AndroidStudio Runä¸€ä¸ªnativeé¡¹ç›®ã€‚ æ‰€ä»¥çœŸçš„è¦é€šè¯»è¿™ä¸ªæ–‡æ¡£ï¼Œä»”ç»†è€ƒè™‘è¦ä¸è¦è¿™ä¹ˆåš[Ejecting to ExpoKit - Expo Documentation](https://docs.expo.io/versions/latest/expokit/eject/#__next)\n\n1. é¦–å…ˆï¼Œæˆ‘ä»¬è¦checkä¸€ä¸‹app.jsonå¯¹ä¸å¯¹https://docs.expo.io/versions/latest/distribution/building-standalone-apps/#2-configure-appjson\n\n2. æ¥ç€ï¼Œè¿è¡Œ`expo eject`å‘½ä»¤ï¼Œä¼šæœ‰å¦‚ä¸‹æç¤º, æˆ‘é€‰ç¬¬ä¸‰ä¸ªï¼ŒExpoKitã€‚ ExpoKitæ˜¯Objective-C å’ŒJavaåº“ï¼Œ å°†nativeå¼€å‘è·Ÿexpoå¹³å°å¼€å‘ç»“åˆèµ·æ¥ã€‚\n\n```\nIt's recommended to commit all your changes before proceeding,\nso you can revert the changes made by this command if necessary.\n\n? How would you like to eject your app?\n  Read more: https://docs.expo.io/versions/latest/expokit/eject/\n  React Native: I'd like a regular React Native project.\nâ¯ ExpoKit: I'll create or log in with an Expo account to use React Native and the Expo SDK.\n  Cancel: I'll continue with my current project structure.\n```\nä½ ä¼šå‘ç°å¤šäº†ä¸¤ä¸ªç›®å½•\n```\nrn-project/\n  - ios/\n  - android/\n```\n## è¿è¡ŒNativeå·¥ç¨‹\n\nReact Native packageræ–¹é¢ï¼Œè¦åƒä»¥å‰é‚£æ ·ï¼Œè¿è¡Œ`expo start`ã€‚ \næ¥ç€é…ç½®nativeå·¥ç¨‹ã€‚ä»¥iOSä¸ºä¾‹: \n\n1. è¿›å…¥iosæ–‡ä»¶å¤¹, pod install (å¦‚æœé‡åˆ°undefined method'native_target', è¯·å‚è€ƒ[Issues Â· expo/expo Â· GitHub](https://github.com/expo/expo/issues/2401d), å°†cocoapodsé™åˆ°1.5.3ç‰ˆæœ¬ã€‚ \n2. æ‰“å¼€xcwordspaceæ–‡ä»¶ï¼Œæ­£å¸¸buid & run iOSé¡¹ç›®\n\n appå¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šè‡ªåŠ¨è¯·æ±‚å¹¶åŠ è½½JS bundleã€‚å¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†jsæ–‡ä»¶ï¼Œå†ä¿å­˜ï¼Œhot-updateä¹Ÿç”Ÿæ•ˆçš„.\n \n## é…ç½® PushNotificationIOS \n[å®˜æ–¹æ•™ç¨‹PushNotificationIOS Â· React Native](https://facebook.github.io/react-native/docs/pushnotificationios) å¾ˆæ˜¯éº»çƒ¦ï¼Œè¿˜å®¹æ˜“æŠ¥ä¸€å †è¿™ä¸ªé‚£ä¸ªæ‰¾ä¸åˆ°çš„é”™è¯¯ã€‚\n\n```\nRCTPushNotificationManager.h not found\nReact/RCTEventEmitter.h file not found\n```\nå…¶å®å®ƒæœ¬è´¨ä¸Šæ˜¯xcodeprojectè¦æ‰‹åŠ¨link RCTPushNotification libï¼Œæˆ‘ä»¬å¤§å¯ä»¥ç›´æ¥ä¿®æ”¹Podfileæ–‡ä»¶ï¼Œå¦‚ä¸‹: \n- æœ€åä¸€è¡Œï¼Œæ·»åŠ `RCTPushNotification`\n- å†runä¸€ä¸‹`pod install`\n- é‡æ–°`build`.\n\n```\n  pod 'React',\n    :path => \"../node_modules/react-native\",\n    :inhibit_warnings => true,\n    :subspecs => [\n      \"Core\",\n      \"ART\",\n      \"RCTActionSheet\",\n      \"RCTAnimation\",\n      \"RCTCameraRoll\",\n      \"RCTGeolocation\",\n      \"RCTImage\",\n      \"RCTNetwork\",\n      \"RCTText\",\n      \"RCTVibration\",\n      \"RCTWebSocket\",\n      \"DevSupport\",\n      \"CxxBridge\",\n      \"RCTPushNotification\"\n    ]\n```","categories":["React Native"]},{"title":"ç†è§£æ‰‹æœºGPSå®šä½åŸç†","url":"/2019/06/08/ç†è§£GPSå®šä½åŸç†/","content":"\næœ¬æ–‡å–æè‡ª TEDæ•™å­¦è§†é¢‘[How does your smartphone know your location? - Wilton L. Virgo](https://www.youtube.com/watch?v=70cDSUI4XKE)\næˆ‘ä»¬çš„æ‰‹æœºæ˜¯å¦‚ä½•å‡†ç¡®å®šä½çš„å‘¢ï¼Ÿ ç­”æ¡ˆåœ¨ç¦»æˆ‘ä»¬2000å¤šè‹±é‡Œçš„å«æ˜Ÿä¸Šã€‚\n\nç¬¬ä¸€ä¸ªé—®é¢˜ï¼š ä¸ºå•¥å«æ˜Ÿä¸Šçš„æ—¶é—´å¯¹GPSå®šä½å¦‚æ­¤é‡è¦ï¼Ÿ å› ä¸ºæˆ‘ä»¬è¦çŸ¥é“æ‰‹æœºè·Ÿå«æ˜Ÿçš„è·ç¦»ã€‚ æ¯ä¸ªå«æ˜Ÿåœ¨ä¸æ–­å¯¹å¤–å¹¿æ’­ä¿¡å·ã€‚ä¿¡å·ä¸­è®°å½•è‡ªå·±çš„åˆ›å»ºæ—¶é—´ã€‚\n\n\n![48bce392.png](/img/a9bb4ba0-9918-4e5c-9fc0-3b9a28363e6b/48bce392.png)\n\næ‰‹æœºæ”¶åˆ°ä¿¡å·åï¼Œåˆ©ç”¨æ”¶åˆ°ä¿¡å·çš„åˆ°è¾¾æ—¶é—´ï¼Œ è®¡ç®—è‡ªå·±è·Ÿå«æ˜Ÿçš„è·ç¦»: \n\n$$distance = c * \\Delta T $$\n\nc: å…‰çš„é€Ÿåº¦\n$\\Delta T$: ä¿¡å·ä¼ æ’­çš„æ—¶é—´é—´éš” $time_{arrive} - time_{create}$\n\nä½†æ˜¯c = 299,792,458 m/s, éå¸¸å¤§ã€‚ å¦‚æœç”¨ç§’åšå•ä½è®¡ç®—$\\Delta T$ï¼Œ åœ°çƒä¸Šæ‰€æœ‰ç‚¹ï¼Œç”šè‡³æœ‰äº›è¿œç¦»æˆ‘ä»¬çš„ä½ç½®ï¼Œè®¡ç®—å‡ºæ¥çš„distanceéƒ½æ˜¯ä¸€æ ·çš„å€¼ã€‚ \n\n![f8edfbb6.png](/img/a9bb4ba0-9918-4e5c-9fc0-3b9a28363e6b/f8edfbb6.png)\n\n\næ‰€ä»¥æˆ‘ä»¬éœ€è¦éå¸¸éå¸¸éå¸¸ç²¾ç¡®çš„æ—¶é’Ÿè®¡ç®—æ—¶é—´. äºæ˜¯åŸå­é’Ÿç²‰å¢¨ç™»åœº. å°±åƒæœºæ¢°é’Ÿé å˜€å—’å˜€å—’æ‘‡æ‘†æ¥è®¡æ—¶ï¼Œ åŸå­é’Ÿä¹Ÿæœ‰è¿™ç§é—´éš”æ—¶é—´å›ºå®šçš„æ»´ç­”æ»´ç­”è®¡æ—¶æ–¹å¼ã€‚ \n\n## åŸå­é’Ÿ\n\n![782d2620.png](/img/a9bb4ba0-9918-4e5c-9fc0-3b9a28363e6b/782d2620.png)\nåŸå­é’Ÿä¾èµ–åŸå­è·ƒè¿æ‰€é‡Šæ”¾æˆ–å¸æ”¶çš„ç”µç£æ³¢æ¥è®¡æ—¶ã€‚åŸå­åœ¨ä¸€ä¸ªè½¨é“è·‘äº†ä¸€åœˆåï¼Œè·ƒè¿åˆ°å¦ä¸€ä¸ªè½¨é“çš„æ—¶å€™ä¼šä»¥ç”µç£æ³¢å½¢å¼é‡Šæ”¾å‡ºèƒ½é‡ã€‚\n\n![a68ec7af.png](/img/a9bb4ba0-9918-4e5c-9fc0-3b9a28363e6b/a68ec7af.png)\n\nèƒ½é‡è®¡ç®—å…¬å¼ï¼š $\\Delta E = h \\nu$ $\\Delta E$ å˜åŒ–çš„èƒ½é‡; hæ˜¯å¸¸é‡(h=6.626x$10^{-34}$ Js)ã€‚ $\\nu$æ˜¯é¢‘ç‡ã€‚ æ¯”å¦‚é“¯åŸå­é’Ÿï¼Œå®ƒçš„é¢‘ç‡æ˜¯ä¸ªå›ºå®šå€¼ 9,192,631,770Hzï¼Œä½ å¯ä»¥æƒ³è±¡ä¸ºä¸€ä¸ªæ¯ç§’è·‘9billionåœˆçš„æ—¶é’Ÿã€‚æ‰€ä»¥ç”¨åŸå­é’Ÿå¯ä»¥æ¯ç§’ç²¾ç¡®åˆ° 1/1billionã€‚ \n\n![0bc32fc3.png](/img/a9bb4ba0-9918-4e5c-9fc0-3b9a28363e6b/ca6ea804.png)\nè¿™å¼ å›¾çš„detectoræ˜¯ç”¨æ¥æ£€æµ‹probe laserå›ºå®šé¢‘ç‡å‘å‡ºçš„ç”µç£æ³¢ã€‚\n\n\næœ‰äº†ç²¾ç¡®çš„æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æ‰‹æœºè·Ÿå«æ˜Ÿçš„è·ç¦»ã€‚ ä»¥å«æ˜Ÿä¸ºä¸­å¿ƒï¼Œdistanceä¸ºåŠå¾„ç”»åœ†(çƒ)\n\n![f58c51ad.png](/img/a9bb4ba0-9918-4e5c-9fc0-3b9a28363e6b/f58c51ad.png)\n\nå¦‚æœå¤šå‡ ä¸ªå«æ˜Ÿï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‡ ä½•å…¬å¼è®¡ç®—å‡ºå®ƒä»¬çš„ç©ºé—´äº¤å‰ç‚¹\n\n![293478f1.png](/img/a9bb4ba0-9918-4e5c-9fc0-3b9a28363e6b/293478f1.png)\n\n![6cbd0ed3.png](/img/a9bb4ba0-9918-4e5c-9fc0-3b9a28363e6b/6cbd0ed3.png)\n\n","categories":["LBS"]},{"title":"714. Best Time to Buy and Sell Stock with Transaction Fee","url":"/2019/06/06/714-Best-Time-to-Buy-and-Sell-Stock-with-Transaction-Fee/","content":"\n##  [é¢˜ç›®](https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-transaction-fee)\n\n## åˆ†æ\n\n### å®šä¹‰ä¸¤ä¸ªçŠ¶æ€å˜é‡: \n- buy_profit: è‹¥i-1å¤©ï¼ŒæŒæœ‰è‚¡ç¥¨ï¼Œæœ€å¤§åˆ©æ¶¦æ˜¯ $(buy_profit)\n- sell_profit: è‹¥i-1å¤©ï¼Œå–å‡ºè‚¡ç¥¨, æœ€å¤§åˆ©æ¶¦æ˜¯ $(sell_profit)\n\n### ä¹°å–åˆ©æ¶¦æƒ…å†µï¼š \n\n**æœ€å¼€å§‹**: i == 0;  `int buy_profit = -prices[0], sell_profit = 0`\n**ç¬¬iå¤©**: \n\n- å½“å¤©ä¹°: \n    - ç»´æŒi-1å¤©æŒæœ‰, ä¸å˜ï¼› $buy\\_profit_i == buy\\_profit_{i-1}$ \n    - i-1å¤©å–å‡ºï¼Œiå¤©ä¹°è¿› (å› ä¸ºé¢˜ç›®è¦æ±‚æ¯æ¬¡åªèƒ½ä¹°1 share of stock, ä¹°å…¥å‰å¿…é¡»æŠŠæ‰‹ä¸Šçš„stockéƒ½å–å‡º); $buy\\_profit_i = sell\\_profit_{i-1} - prices[i]$\n- å½“å¤©å–:  \n    - i-1å¤©æŒæœ‰ï¼Œiå¤©å–å‡º; å½“å¤©çš„åˆ©æ¶¦ä¸º $sell\\_profit_i=buy\\_profit_i-1 + prices[i] - fee$\n    - i-1å¤©å·²ç»å–å‡ºï¼Œå½“å¤©ä¸æ“ä½œï¼›åˆ©æ¶¦ä¸º $sell\\_profit_i == sell\\_profit_{i-1}$ \n    \næ¯ä¸ªiè¿­ä»£ï¼Œæˆ‘ä»¬éƒ½è¦è€ƒè™‘è¿™å››ç§æƒ…å†µï¼Œè®¡ç®—å‡ºbuy_profitè·Ÿsell_profitçš„å±€éƒ¨æœ€ä¼˜. \n\n\n### ä¾‹å­\nInput: prices = [1, 3, 2, 8, 4, 9], fee = 2\n\næœ€ä¼˜æ“ä½œï¼š \n\n|  | 1 | 3 | 2 | 8 | 4 | 9 |\n| --- | --- | --- | --- | --- | --- | --- |\n| max buy_profit | -1 | -1 max{-1, -3} | -1 max{-1, -2}| -1 max{-1, 8}| 1 max{1, -4} | 1 max{1, -4}|\n| max sell_profit | 0 | 0 max{0, 0}| 0 max{0, -1}| 5 max{0, 5}| 5 max{5, 3}| 8 {5, 8}|\n\n### è´ªå¿ƒç®—æ³•\nA greedy algorithm always makes the choice that `looks best at the moment` That is, it makes a `locally optimal choice` in the hope that this choice will `lead to a globally optimal solution`. \n\n\n## Greedy Algorithm   \n\n\n```c++\nint maxProfit(vector<int>& prices, int fee) {\n    if (prices.empty()) return 0;\n    int buy_profit = -prices[0], sell_profit = 0;\n    for (int i = 1; i < prices.size(); ++i) {\n        buy_profit = max(buy_profit, sell_profit - prices[i]);\n        sell_profit = max(sell_profit, buy_profit + prices[i] - fee);\n     }\n\n    return sell_profit;\n}\n```\næˆ–è€…\n\n```c++\n    int maxProfit(vector<int>& prices, int fee) {\n      int n = prices.size();\n      if (n <= 1 ) return 0; // need at least 2 days to make a transactions\n      \n      vector<int> buys (n); // buys [i] means max money on day i ending in buy  state (have stock in hand)\n      vector<int> sells(n); // sells[i] means max money on day i ending in sell state (no stock in hand)\n      \n      buys [0] = -prices[0];\n      sells[0] = 0;\n      \n      for (int i = 1; i < n; ++i) {\n        buys [i] = max(buys [i-1], sells[i-1]-prices[i]);     // buy  state to buy  state: continue holding onto stock\n                                                              // sell state to buy  state: buy on day i\n        sells[i] = max(sells[i-1], buys [i-1]+prices[i]-fee); // sell state to sell state: continue not holding any stock\n                                                              // buy  state to sell state: sell on day i\n      }\n      return sells[n-1];\n    }\n```\næ—¶é—´å¤æ‚åº¦: $o(n)$","tags":["Algorithm"],"categories":["Algorithm"]},{"title":"LeetCode:413. Arithmetic Slices","url":"/2019/06/04/LeetCode-413-Arithmetic-Slices/","content":"\n##  [413. Arithmetic Slices](https://leetcode.com/problems/arithmetic-slices/)\nè¿™é“é¢˜ï¼Œç®€è€Œè¨€ä¹‹ï¼Œæ±‚æ•°ç»„é‡Œï¼Œç­‰å·®åºåˆ—çš„ä¸ªæ•°ã€‚ \n\næ¯”å¦‚\n```\nA = [1, 2, 3, 4]\næœ‰3ä¸ªç­‰å·®æ•°åˆ—\n[1, 2, 3], [2, 3, 4], [1, 2, 3, 4]\n```\n\né¢˜ç›®æ²¡æœ‰è¯´æ˜Aæ˜¯ç­‰å·®æ•°åˆ—ï¼Œæ‰€ä»¥ä¹Ÿè¦è€ƒè™‘Aä¸æ˜¯ç­‰å·®æ•°åˆ—ï¼Œä½†æ˜¯å…¶å­æ•°ç»„æ˜¯ç­‰å·®æ•°åˆ—çš„æƒ…å†µã€‚\n```\nA = [1, 3, 5, 7, 9, 15, 20, 25]\n1, 3, 5\n\n3, 5, 7\n1, 3, 5, 7\n\n5, 7, 9\n3, 5, 7, 9\n1, 3, 5, 7, 9\n\n15, 20, 25\n```\n\n## Solution \n\n```c++\nint numberOfArithmeticSlices(vector<int>& A) {\n    int dp = 0;\n    int sum = 0;\n\n    for (int i = 2; i < A.size(); ++i) {\n        if (A[i] - A[i-1] == A[i-1] - A[i-2])  {\n           dp = 1+dp;\n           sum += dp;\n        } else {\n           dp = 0;\n        }\n    }\n    return sum;\n}\n```","tags":["Algorithm"],"categories":["Algorithm"]},{"title":"ReactNativeå¼€å‘-ç¥å™¨Reactoron","url":"/2019/05/23/ReactNative-reactoron/","content":"Reactoronèƒ½æ”¹å–„React Nativeå¼€å‘ä½“éªŒã€‚ \n<!--more--> \n \nReactoronè¿™ä¸ªå¼€å‘å·¥å…·ï¼ŒæŠŠæˆ‘ä»¬è¾“å‡ºçš„æ—¥å¿—åƒtwitterä¿¡æ¯æµä¸€æ ·ä¿å­˜èµ·æ¥ï¼Œç­‰æˆ‘ä»¬éœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥å›è¿‡å¤´è¿‡æ»¤æ‰¾åˆ°æ—¥å¿—ï¼Œå±•å¼€æ—¥å¿—è¯¦æƒ…æŸ¥çœ‹ã€‚æé«˜ReactNativeå¼€å‘æ•ˆç‡ã€‚ çœ‹æ—¥å¿—ä¼šç‰¹åˆ«æ–¹ä¾¿ï¼Œä½“éªŒä¹Ÿä¸é”™ã€‚\n\n![image](https://github.com/infinitered/reactotron/raw/master/docs/images/quick-start-react-native/react-demo-native-reactotron.jpg)\n\né¡¹ç›®åœ°å€ï¼š [GitHub - infinitered/reactotron: A desktop app for inspecting your React JS and React Native projects. macOS, Linux, and Windows.](https://github.com/infinitered/reactotron)\n\nä¸‹è½½æœ€æ–°çš„releaseåŒ…ï¼Œæœ¬åœ°å®‰è£…ã€‚\n\n## ä½¿ç”¨\n\n### 1. é›†æˆåœ¨React Nativeé¡¹ç›®ä¸­\n\n```sh\nnpm i --save-dev reactotron-react-native\n// or\nyarn add reactotron-react-native --dev\n```\n\n### 2. é…ç½®æ–‡ä»¶\n\nåˆ›å»º`ReactotronConfig.js`\n\nåŸºç¡€ç”¨æ³•ï¼š\n```js\nimport Reactotron from 'reactotron-react-native'\n\nReactotron\n  .configure() // controls connection & communication settings\n  .useReactNative() // add all built-in react native plugins\n  .connect() // let's connect!\n```\né«˜çº§é…ç½®: \n\n```js\nimport Reactotron from 'reactotron-react-native'\n\nReactotron\n  .configure({\n    name: \"React Native Demo\"\n  })\n  .useReactNative({     \n      asyncStorage: {ignore: []},\n      networking: {\n          ignoreUrls: new RegExp(`http://127.0.0.1:19000/logs`)\n      },\n      editor: false,\n      errors: {veto: (stackFrame) => false},\n      overlay: false,})\n  .connect();\n```\n\n#### asyncStorage \n\nå‚æ•°ç±»å‹ï¼š\n\n```js\nexport interface AsyncStorageOptions {\n    ignore?: string[];\n}\n```\n\n`ignore`çš„å€¼ï¼Œä¼ å…¥keyæ•°ç»„ï¼Œ`reactotron`ä¸ä¼šå±•ç¤ºè¿™äº›keyçš„å­˜å‚¨æ•°æ®\n\n#### networking\nå‚æ•°ç±»å‹ï¼š \n```js\nexport interface NetworkingOptions {\n    ignoreContentTypes?: RegExp; // å¦‚æœresponseçš„Content-TypeåŒ¹é…ä¸Šè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸å±•ç¤ºresponseï¼Œ\n    ignoreUrls?: RegExp; //  è¦å¿½ç•¥çš„urls\n}\n```\nä¾‹å­ï¼š\n```js networking({\n  ignoreContentTypes: /^(image)\\/.*$/i,\n  ignoreUrls: /\\/(logs|symbolicate)$/,\n})\n```\n\n\n#### Error \nå‚æ•°ç±»å‹ï¼š\n```js\nexport interface TrackGlobalErrorsOptions {\n    veto?: (frame: any) => boolean;\n}\n```\n`veto`å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæŒ‡å®šæˆ‘ä»¬ä¸æƒ³çœ‹åˆ°çš„å †æ ˆä¿¡æ¯.è¿™é‡Œçš„frameæŒ‡stack frame.\n\næ¯”å¦‚ï¼š å¦‚ä¸‹å¿½ç•¥æŠ¥é”™æ—¶æ‰€æœ‰react-native moduleé‡Œå¤´çš„stack frame.\n```js\nReactotron\n  .configure()\n  .use(trackGlobalErrors({\n    veto: frame => frame.fileName.indexOf('/node_modules/react-native/') >= 0\n   }))\n  .connect()\n```\n### 3. improt\n\n åœ¨`App.js` æˆ–è€…`index.js`æ–‡ä»¶å¤´ä¸­å¼•å…¥ï¼š\n \n```js\nif(__DEV__) {\n  import('./ReactotronConfig').then(() => console.log('Reactotron Configured'))\n}\n```\n\n### 4. æ‰“ç‚¹\n\nåƒç”¨`console.log`ä¸€æ ·ï¼Œè°ƒç”¨ `Reactotron.log`\n\nReactNativeé¡¹ç›®è·‘èµ·æ¥åï¼Œå¯ä»¥åœ¨Reactotroné¢æ¿ä¸Šçœ‹åˆ°ï¼š \n\n![9b1dbee4.png](https://github.com/infinitered/reactotron/raw/master/docs/images/quick-start-react-native/hello-1.jpg)\n\nå…¶ä»–APIï¼š \n```js\nReactotron.log({ numbers: [1, 2, 3], boolean: false, nested: { here: 'we go' } })\n\nReactotron.warn('*glares*')\nReactotron.error('Now you\\'ve done it.')\nReactotron.display({\n  name: 'KNOCK KNOCK',\n  preview: 'Who\\'s there?',\n  value: 'Orange.'\n})\n\nReactotron.display({\n  name: 'ORANGE',\n  preview: 'Who?',\n  value: 'Orange you glad you don\\'t know me in real life?',\n  important: true\n})\n\n```\n\n## Reduxçš„æ•°æ®ä¿¡æ¯\n[reactotron/plugin-redux.md at master Â· infinitered/reactotron Â· GitHub](https://github.com/infinitered/reactotron/blob/master/docs/plugin-redux.md)\n![](https://github.com/infinitered/reactotron/raw/master/docs/images/redux/redux-keys-values.jpg)\n\n[YouTube](https://www.youtube.com/watch?v=UiPo9A9k7xc)\n\n\n","tags":["React Native Dev"],"categories":["React Native"]},{"title":"LeetCode:542. 01 Matrix-DP","url":"/2019/05/23/LeetCode-542-01-Matrix-DP/","content":"Given a matrix consists of 0 and 1, find the distance of the nearest 0 for each cell.\n\n<!--more-->\n \n\n## é¢˜ç›®: [01-matrix](https://leetcode.com/problems/01-matrix/)\nGiven a matrix consists of 0 and 1, find the distance of the nearest 0 for each cell.\n\nThe distance between two adjacent cells is 1.\n```\nExample:\nInput:\n[[0,0,0],\n [0,1,0],\n [1,1,1]]\n\nOutput:\n[[0,0,0],\n [0,1,0],\n [1,2,1]]\n```\n## åˆ†æï¼š \né¢˜ç›®æœ‰ç‚¹æ²¡è®²æ˜ç™½ï¼Œè¿™é“é¢˜ï¼Œæ±‚å€¼ä¸º1çš„cellåˆ°æœ€è¿‘çš„0çš„æœ€çŸ­è·ç¦»ã€‚\n\nè¿™é“é¢˜ï¼Œæˆ‘çš„ç¬¬ä¸€æƒ³æ³•æ˜¯BFSï¼Œåæ¥çœ‹åˆ°DPå†™æ³•æ›´ä¼˜é›…ã€‚[Simple-Java-solution](https://leetcode.com/problems/01-matrix/discuss/101051/Simple-Java-solution-beat-99-(use-DP))\n\nå¯ä»¥å‘ç°è§„å¾‹ã€‚å¯¹matrix[i][j], å¦‚æœçŸ¥é“å®ƒä¸Šä¸‹å·¦å³å››ä¸ªcellåˆ°0çš„æœ€çŸ­è·ç¦»ï¼Œé‚£ä¹ˆ\n$$matrix[i][j] = min(left, top, right, bottom) + 1$$\n\n1. éå†matrixçŸ©é˜µï¼Œmatrix[i][j]ä¸ä¸º0ï¼Œè®¡ç®— leftCell è·Ÿ topCellæœ€å°å€¼ï¼Œå†åŠ 1. \n2. å†å€’å™éå†matrix, matrix[i][j]ä¸ä¸º0, å…ˆè®¡ç®—rightCell è·Ÿ topCellçš„æœ€å°å€¼ï¼Œå†è·Ÿmin(left, top)çš„å€¼æ¯”è¾ƒ\n\n```c++\n vector<vector<int>> updateMatrix(vector<vector<int>>& matrix) {\n     if (matrix.empty()) return {};\n     int n = (int)matrix.size(), m = (int)matrix[0].size(), MAX_LEN = 10002;\n     for (int i = 0; i < n; ++i) {\n         for (int j = 0; j < m; ++j) {\n             if (matrix[i][j] != 0) {\n                 int top = (i - 1 < 0) ? MAX_LEN : matrix[i-1][j];\n                 int left = (j - 1 < 0) ? MAX_LEN : matrix[i][j-1];\n                 matrix[i][j] = 1 + min(top, left);\n             }\n         }\n    \n     for (int i = n - 1; i >= 0; i--) {\n         for (int j = m - 1; j >= 0; j--) {\n             if(matrix[i][j] != 0) {\n                 int right = (j + 1 >= m) ? MAX_LEN: matrix[i][j+1];\n                 int bottom = (i + 1 >= n) ? MAX_LEN: matrix[i+1][j];\n                 matrix[i][j] = min(min(right, bottom) + 1, matrix[i][j]);\n             }\n         }\n     }\n     return matrix;\n }\n```\n### æ—¶é—´å¤æ‚åº¦ $o(n^2)$\n### ç©ºé—´å¤æ‚åº¦ $o(1)$\n\n```\nRuntime: 184 ms, faster than 96.53% of C++ online submissions for 01 Matrix.\nMemory Usage: 20.9 MB, less than 91.39% of C++ online submissions for 01 Matrix.\n```\næœ‰äººé—®ï¼Œä¸ºå•¥è¦ä¸¤æ¬¡éå†ï¼Ÿ ä¸èƒ½åƒä¸‹é¢è¿™ä¹ˆå†™å—ï¼Ÿ\n\n```c++\n// é”™è¯¯çš„å†™æ³•\n vector<vector<int>> updateMatrix(vector<vector<int>>& matrix) {\n       if (matrix.empty()) return {};\n       int n = (int)matrix.size(), m = (int)matrix[0].size();\n       for (int i = 0; i < n; ++i) {\n           for (int j = 0; j < m; ++j) {\n               if (matrix[i][j] != 0) {\n                   int top = (i - 1 < 0) ? INT32_MAX : matrix[i-1][j];\n                   int left = (j - 1 < 0) ? INT32_MAX : matrix[i][j-1];\n                   int right = (j + 1 >= m) ? INT32_MAX : matrix[i][j+1];\n                   int bottom = (i + 1 >= n) ? INT32_MAX : matrix[i+1][j];\n                   matrix[i][j] = 1 + min(min(top, left), min(right, bottom));\n               }\n           }\n       }\n       return matrix;\n   }\n```\né—®é¢˜åœ¨äºï¼Œé¡ºåºéå†æ—¶å€™ï¼Œbottomè·Ÿrightè¿˜æ²¡æ›´æ–°ä¸ºæ­£ç¡®çš„å€¼ã€‚æ¯”å¦‚ä¸‹å›¾ï¼Œéå†åˆ°matrix[3][0]çš„æ—¶å€™ï¼Œmatrix[3, 1] è¿˜æ˜¯1ï¼Œ è€Œmatrix[2][0] == 2; ç»“æœå°±å‡ºé”™äº†ã€‚\n```\n0 0 0 0 0 \n1 0 0 0 0 \n1 1 1 0 0 \n1 1 1 1 0 \n```\n","tags":["Algorithm"],"categories":["Algorithm"]},{"title":"LeetCode:650. 2 Keys Keyboard","url":"/2019/05/20/LeetCode-650-2-Keys-Keyboard/","content":"\n## é¢˜æ„: \nnotepadé‡Œåªæœ‰ä¸€ä¸ª'A'å­—ç¬¦ä¸²ã€‚ åªèƒ½å…è®¸ä¸¤ä¸ªæ“ä½œ: \n\n1. Copy All: æŠŠnotepadé‡Œæ‰€æœ‰çš„å­—ç¬¦ä¸²copy\n2. Paste: å¤åˆ¶ä¸Šæ¬¡copyçš„å†…å®¹\n\né—®ï¼Œæœ€å°‘çš„æ­¥éª¤ï¼ˆcopy & paste) èƒ½ç”Ÿæˆnä¸ª'A'\n\n## åˆ†æ\n\nå¯ä»¥å‘ç°è§„å¾‹: \n\n\n| n | op | cur char |\n| --- | --- | --- |\n| 2 | c | A |\n|  | p | AA |\n| 3 | c | A |\n|  | p | AA |\n|  | p | AAA |\n| 4 | c | A |\n|  | p | AA |\n|  | c | AA |\n|  | p | AAAA |\n| 5 | c | A |\n|  | p | AA |\n|  | p | AAA |\n|  | p | AAAA |\n|  | p | AAAAA |\n| 6 | c | A |\n|  | p | AA |\n|  | c | AA |\n|  | p | AAAAA |\n|  | p | AAAAAA |\n\nå½“nä¸ºè´¨æ•°ï¼Œ æ‰€éœ€æœ€å°‘æ­¥éª¤ä¸ºn; å½“nä¸æ˜¯è´¨æ•°ï¼Œ æ‰€éœ€æ­¥éª¤ä¸º nçš„è´¨å› æ•°ç›¸åŠ ä¹‹å’Œã€‚æ¯”å¦‚6 = 2 x 3;å®ƒæ‰€éœ€æœ€å°æ­¥éª¤ 2+3 = 5\n\n## Solution 1ï¼š è´¨å› æ•°åˆ†è§£\n```c++\nint minSteps(int n) {\n    int ans = 0, d = 2;\n    while (n > 1) {\n        while (n % d == 0)  {\n            ans += d;\n            n /= d;\n        }\n        d++;\n    }\n\n    return ans;\n}\n```\n\n## Solution 2: \n\n```c++\nint minSteps(int n) {\n    if (n <= 1) return 0;\n    if (n <= 5) return n;\n    // n>1çš„æ“ä½œï¼Œå‰ä¸¤æ­¥éª¤éƒ½æ˜¯copy & paste, ä»'A'å˜æˆ 'AA', æ‰€ä»¥ cur_len == 2, res == 2, ä¸Šæ¬¡copyçš„å­—ç¬¦æ•°é‡ == 1, å¦‚æœä¸‹ä¸€æ¬¡è¦copy & paste, è¦ä¸€æ¬¡copy'AA' 2ä¸ªå­—ç¬¦  \n    int cur_len = 2, res = 2, next_cp_num = 2, copy_num = 1;\n    while (cur_len < n) {\n        if ((n - cur_len) % next_cp_num == 0) {\n           // copy + paste\n           cur_len += next_cp_num;\n           copy_num = next_cp_num;\n           // copy + paste; 2 steps\n           res += 2;\n        } else {\n            // paste the characters copied last time \n            cur_len += copy_num;\n            // only paste, 1 step\n            res += 1;\n        }\n\n        // é¢˜ç›®è¦æ±‚ï¼šCopyæ“ä½œè¦Copyæ‰€æœ‰å­—ç¬¦\n        next_cp_num = cur_len;\n    }\n\n    return res;\n}\n```\n","tags":["Algorithm"],"categories":["Algorithm"]},{"title":"å°ç™½è¯»è®ºæ–‡:Semantic Image Synthesis with Spatially-Adaptive Normalization","url":"/2019/05/18/Semantic-Image-Synthesis-with-Spatially-Adaptive-Normalization/","content":"[GauGAN: Changing Sketches into Photorealistic Masterpieces](https://www.youtube.com/watch?v=p5U4NgVGAwg&feature=youtu.be) 3æœˆçš„æ—¶å€™ï¼Œè‹±ä¼Ÿè¾¾å‘å¸ƒäº†ä¸€ä¸ªè§†é¢‘æŒºç«çš„ï¼š ä½ åªè¦ç²—ç•¥å‹¾å‹’ç®€å•çš„çº¿æ¡ï¼ŒAIå°±èƒ½ç”Ÿæˆé€¼çœŸçš„å†™å®å›¾ç‰‡ã€‚\n\n\n  \n  \n\n\n<!--more-->\n[GauGAN: Changing Sketches into Photorealistic Masterpieces](https://www.youtube.com/watch?v=p5U4NgVGAwg&feature=youtu.be) 3æœˆçš„æ—¶å€™ï¼Œè‹±ä¼Ÿè¾¾å‘å¸ƒäº†ä¸€ä¸ªè§†é¢‘æŒºç«çš„ï¼š ä½ åªè¦ç²—ç•¥å‹¾å‹’ç®€å•çš„çº¿æ¡ï¼ŒAIå°±èƒ½ç”Ÿæˆé€¼çœŸçš„å†™å®å›¾ç‰‡ã€‚\n\n![68747470733a2f2f6e766c6162732e6769746875622e696f2f53504144452f2f696d616765732f6f6365616e2e676966](https://camo.githubusercontent.com/a295a79daea9d1dd0cb16b48055607d0f17258b2/68747470733a2f2f6e766c6162732e6769746875622e696f2f53504144452f2f696d616765732f6f6365616e2e676966)\n[GitHubåœ°å€](https://github.com/NVlabs/SPADE)\né‚£å®ƒæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ è¿™ä¸ªé¡¹ç›®ç”¨çš„æ˜¯GANç®—æ³•ã€‚\n## GANæ¨¡å‹çš„ä»»åŠ¡ï¼š \n**å­¦ä¹ ä»»åŠ¡** : è¾“å…¥semantic segmentation mask, åˆæˆ photorealistic imagesã€‚ \n\n`Semantic Image` æ˜¯å•¥å»ï¼Ÿ ç›´è§‚ä¸Šç†è§£ï¼Œå¦‚ä¸‹å›¾ï¼š \n\n![31085460.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/31085460.png)\n\n`Image segmentation`å‘¢ï¼Ÿ \n```\nImage segmentation is a computer vision task in which we label specific regions of an image according to what's being shown. \nthe goal of semantic image segmentation is to label each pixel of an image with a corresponding class of what is being represented.\n```\nå¦‚ä¸‹å›¾é‡Œçš„æ¯ä¸ªåƒç´ éƒ½è¢«åˆ†ç±»å½’å±åˆ°ä¸åŒçš„class\n![Screen-Shot-2018-05-17-at-9.02.15-PM.png](https://www.jeremyjordan.me/content/images/2018/05/Screen-Shot-2018-05-17-at-9.02.15-PM.png)\n[å›¾ç‰‡æ¥æº](https://www.jeremyjordan.me/semantic-segmentation/#representing)\n\n## SPADE:  SPatially-Adaptive (DE)normalization\n\n### [Normalizaing training sets](https://mooc.study.163.com/learn/2001281003?tid=2001391036&_trace_c_p_k2_=5c39b3d9b1544824a0675bd3f4ed78d5#/learn/content?type=detail&id=2001701046)\né¦–å…ˆï¼Œè¦äº†è§£ä¸€ä¸‹Normalizationçš„å¤„ç†è·Ÿå¥½å¤„ã€‚\n\n**å¤„ç†**ï¼š ä»¥é€»è¾‘å›å½’ä¸ºä¾‹, å®ƒçš„è¾“å…¥ç‰¹å¾$X$,æƒé‡$W$, mapå‡½æ•°å¦‚ä¸‹\n$$f(x) = \\sum_{i=1}^{n}x_i*w_i$$\n\n1. å…ˆæ±‚è¾“å…¥çš„ç‰¹å¾$x$çš„æœŸæœ›\n$$\\mu=\\frac{1}{n}\\sum_{i=1}^{n}x_i$$\n\n2. å†æ±‚$x$çš„æ–¹å·®\n\n$$\\sigma^2 = \\frac{1}{n} \\sum_{i=1}^{n}(x_i - \\mu)^2$$\n\n3. å†å¯¹è¾“å…¥ç‰¹å¾åšNormalization: \n$$\\frac{x-u}{\\sigma^2}$$\n\n**å¥½å¤„**æ˜¯ï¼Œç»è¿‡å¤„ç†çš„inputç‰¹å¾å€¼åˆ†å¸ƒæ›´é›†ä¸­å‡åŒ€ï¼Œ å¦‚ä¸‹å›¾çš„ç¬¬ä¸‰ä¸ªåæ ‡ç³»ï¼Œ \n![826f032b.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/826f032b.png)\n\nå¯¹äºæŸå¤±å‡½æ•°ï¼Œ\n$$J(w, x) = \\frac{1}{m}\\sum_{i=1}^{m}L(\\hat{y}, y)$$\nç”¨æ¢¯åº¦ä¸‹é™è®­ç»ƒWï¼ŒBçš„æ—¶å€™ï¼ŒNormalizationåï¼Œå½¢çŠ¶æ›´åœ†ä¸€äº›ï¼Œæ›´å®¹æ˜“ä¼˜åŒ–ã€‚æ— è®ºåˆå§‹ä»å“ªä¸ªä½ç½®å¼€å§‹ï¼Œä½ éƒ½å¯ä»¥ç”¨è¾ƒå¤§çš„æ­¥é•¿,æ¯”è¾ƒå®¹æ˜“æ‰¾åˆ°é€‚åˆçš„w,bçš„å€¼ï¼Œä½¿å¾—Jï¼ˆw,b)çš„å€¼æœ€å°ã€‚\n![6ad7add2.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/6ad7add2.png)\n\n### [Batch Normalization](https://mooc.study.163.com/learn/2001281003?tid=2001391036&_trace_c_p_k2_=f3e0afd9612c439a9f25d08040d39eab#/learn/content?type=detail&id=2001701055) \n[æ”¹å–„æ·±å±‚ç¥ç»ç½‘ç»œï¼šè¶…å‚æ•°è°ƒè¯•ã€æ­£åˆ™åŒ–ä»¥åŠä¼˜åŒ– - ç½‘æ˜“äº‘è¯¾å ‚](https://mooc.study.163.com/learn/2001281003?tid=2001391036&_trace_c_p_k2_=f3e0afd9612c439a9f25d08040d39eab#/learn/content?type=detail&id=2001701055)\n\nBatch Normä¸æ­¢normailize input feature;ä¹Ÿå¯å°†normalization processåº”ç”¨åœ¨ç¥ç»ç½‘ç»œä¸­çš„hidden layerä¸Šã€‚\n\n![747a0d26.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/747a0d26.png)\n\næ¯”å¦‚å¯¹éšè—å±‚$a^{[2]}$çš„è¾“å‡ºè¿›è¡Œæ­£åˆ™åŒ–å¤„ç†ï¼ŒåŠ é€Ÿä¸‹ä¸€å±‚çš„å‚æ•°$w^{[3]}$,$b^{[3]}$çš„è®­ç»ƒé€Ÿåº¦ã€‚æ¯”å¦‚$a^{[2]}$å±‚çš„ç¥ç»å•å…ƒåˆ†åˆ«æ˜¯ $z^{(1)}, z^{(2)}...z^{(m)}$\n\nå¯¹å®ƒçš„å¤„ç†æ˜¯\n1. æ±‚æœŸæœ›:\n$$\\mu = \\frac{1}{m}\\sum_{i=1}^{m}z_i$$\n2. æ±‚æ–¹å·®:\n$$\\sigma^2 = \\frac{1}{m}\\sum_{i=1}^{m}(z_i - u)^2$$\n3. norimal\n$$z_i = \\frac{z_i-u}{\\sqrt{\\sigma^2 + \\varepsilon}}$$\nåŠ ä¸Š$\\varepsilon$æ˜¯é˜²æ­¢$\\sigma^2$ä¸º0\n4. åŠ ä¸Š $\\gamma$ è·Ÿ $\\beta$ï¼› `scale and shift the normalized value`\n$$\\hat{z} = \\gamma z_i + \\beta$$\n \n\n$\\gamma$ è·Ÿ $\\beta$ ä¹Ÿæ˜¯å‚æ•°ï¼Œè·Ÿ`w, b`ä¸€æ ·åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¿­ä»£å­¦ä¹ ã€‚ ç¥ç»ç½‘ç»œä¸­ä»–ä»¬ä¹Ÿå¸¸åœ¨æ¿€æ´»å±‚ä¹‹å‰è¿›è¡ŒBatch Normalizationå¤„ç†ã€‚ \n\n### (Spatially-Adaptive normalization)SPADE\nè¿™ç¯‡è®ºæ–‡æå‡ºè‡ªå·±çš„normalizationæ€è·¯ï¼Œ$h^i$æ˜¯ i-thå±‚çš„æ¿€æ´»å‡½æ•°è¾“å‡ºã€‚\næ­£åˆ™åŒ–å¤„ç†:\n$$\\gamma_{c, y, x}^i (m)\\frac{h_{n, c, y, x}^i - \\mu_c^i}{\\sigma_c^i} + \\beta_{c, y, x}^{i}(m)$$\n\nc: $c \\epsilon C^i, C^i$æ˜¯i-thå±‚çš„channelä¸ªæ•°\nx: $x \\epsilon W^i, W^i$æ˜¯i-thå±‚çš„å®½\ny: $y \\epsilon H^i$, é«˜\nm: segmentation mask m\n$\\gamma_{c, y, x}^i$è·Ÿ$\\beta_{c, y, x}^{i}$ æ˜¯å‡½æ•°ï¼Œç”¨å·ç§¯ç½‘ç»œå®ç°\n\n**ç»“æ„å›¾**ï¼š \n\n![2f3fe4e8.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/1ec7011c.png)\n- `3x3-Conv-k`æ˜¯ 3x3å·ç§¯å±‚ï¼Œæœ‰kä¸ªå·ç§¯filter, filter size 3x3\n- `ReLU` æ¿€æ´»å‡½æ•° \n- è¿™é‡Œçš„`Resize`ç”¨çš„æ˜¯`nearest-neighbor downsampling`ï¼Œä¸ç»†è¯´äº†ã€‚\n\nå®ƒçš„å¤„ç†æµç¨‹æ˜¯è¿™æ ·ï¼Œå¯¹sematic image è¿›è¡Œresizeã€å·ç§¯ã€ReLUæ¿€æ´»å¤„ç†ï¼Œ å³$\\gamma_{c, y, x}^i(m)$è·Ÿ$\\beta_{c, y, x}^{i}(m)$ï¼Œ ä¹˜ã€åŠ ä¸Š`Batch Normalization`çš„è¾“å‡ºæ•°æ®$\\frac{h_{n, c, y, x}^i - \\mu_c^i}{\\sigma_c^i}$ ï¼Œ \n![ab4c46cb.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/ad9094aa.png)\n\næ¯”èµ·ä¼ ç»ŸBatch Normal,SPADEçš„$\\gamma_{c, y, x}^i(m)$è·Ÿ$\\beta_{c, y, x}^{i}(m)$æ˜¯å¯¹sematic imageåšå·ç§¯æ“ä½œï¼Œå®ƒåœ¨normalizationè¿‡ç¨‹ä¸­ä¿å­˜æ›´å¤šsemanticçš„ä¿¡æ¯ã€‚è®ºæ–‡ä¸­ä¹Ÿè®¤ä¸ºè¿™æ˜¯SPADEæ•ˆæœæ›´å¥½çš„åŸå› ã€‚\n\n#### ç›¸å…³ä»£ç ï¼š \n`normalization.py`\n\n```python\n//  ç”¨ä¼ ç»Ÿçš„normalization methodæ­£åˆ™åŒ–æ¿€æ´»å‡½æ•°è¾“å‡º\n  if param_free_norm_type == 'instance':\n      self.param_free_norm = nn.InstanceNorm2d(norm_nc, affine=False)\n  elif param_free_norm_type == 'syncbatch':\n      self.param_free_norm = SynchronizedBatchNorm2d(norm_nc, affine=False)\n  elif param_free_norm_type == 'batch':\n      self.param_free_norm = nn.BatchNorm2d(norm_nc, affine=False)\n  else:\n      raise ValueError('%s is not a recognized param-free norm type in SPADE'\n                             % param_free_norm_type)\n\n \n```\n```python\n   // æ„å»ºgamma,betaå‡½æ•°, å·ç§¯å±‚å®ç°\n   self.mlp_gamma = nn.Conv2d(nhidden, norm_nc, kernel_size=ks, padding=pw)\n   self.mlp_beta = nn.Conv2d(nhidden, norm_nc, kernel_size=ks, padding=pw)\n```\n\n```python\n  def forward(self, x, segmap):\n\n        # Part 1. generate parameter-free normalized activations\n        normalized = self.param_free_norm(x)\n\n        # âœ¨âœ¨âœ¨ Part 2. produce scaling and bias conditioned on semantic map\n        segmap = F.interpolate(segmap, size=x.size()[2:], mode='nearest')\n        actv = self.mlp_shared(segmap)\n        gamma = self.mlp_gamma(actv)\n        beta = self.mlp_beta(actv)\n\n        # apply scale and bias\n        out = normalized * (1 + gamma) + beta\n\n        return out\n```\n\n\n## æ¨¡å‹æ¶æ„ GANs\n\nGANsç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š \n\n1. generatorï¼šè´Ÿè´£åˆæˆå†™å®é£æ ¼çš„å›¾ç‰‡\n2. discriminator: è´Ÿè´£æ‰¾èŒ¬ã€‚è®¤å‡ºè¿™æ˜¯å¼ åˆæˆå›¾ç‰‡ï¼Œ è€Œä¸æ˜¯çœŸå®çš„ç…§ç‰‡ï¼ˆor å†™å®å›¾ç‰‡ï¼‰\n### generator æ¶æ„\n\né¦–å…ˆ\n\n![d3313a9e.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/d3313a9e.png)\n\nè¿™å¹…å›¾é‡Œå¥½å¤šSPADE ResBlkå•Šï¼Œå•¥æ˜¯SPADE ResBlk? ä¸‹é¢æ˜¯å®ƒçš„ç»“æ„å›¾ï¼š \n\n![630b2d2a.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/630b2d2a.png)\n\n- `3x3-Conv-k`æ˜¯ 3x3å·ç§¯å±‚ï¼Œæœ‰kä¸ªå·ç§¯filter, filter size 3x3\n- `ReLU` æ¿€æ´»å‡½æ•°\n- SPADEæ¿€æ´»è§ä¸Šæ–‡åˆ†æ\n\n\né‚£`ResBlk`å‘¢ï¼Ÿ \nè¿™è¦ä»å¤§åé¼é¼çš„æ®‹å·®ç½‘ç»œè¯´èµ· [Residual block](https://mooc.study.163.com/learn/2001281004?tid=2001392030&_trace_c_p_k2_=5c60eb2c1e0d4adbb2516471e9ebb431#/learn/content?type=detail&id=2001728692) ï¼ˆå¼ºçƒˆæ¨èAndrew Ngå…¬å¼€è¯¾; å¼„æ˜ç™½å‡ ä¸ªç‚¹ï¼š 1. Residual Blockè¦è§£å†³ä»€ä¹ˆé—®é¢˜;  2. å®ƒçš„è®¾è®¡;  3. ä¸ºå•¥æœ‰æ•ˆã€‚ å†å›æ¥çœ‹SPADE ResBlk)\n\n![fd021761.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/fd021761.png)\n```python\n    def __init__(self, fin, fout, opt):\n        super().__init__()\n        # Attributes\n        self.learned_shortcut = (fin != fout)\n        fmiddle = min(fin, fout)\n\n        # create conv layers\n        self.conv_0 = nn.Conv2d(fin, fmiddle, kernel_size=3, padding=1)\n        self.conv_1 = nn.Conv2d(fmiddle, fout, kernel_size=3, padding=1)\n        if self.learned_shortcut:\n            self.conv_s = nn.Conv2d(fin, fout, kernel_size=1, bias=False)\n\n        # apply spectral norm if specified\n        if 'spectral' in opt.norm_G:\n            self.conv_0 = spectral_norm(self.conv_0)\n            self.conv_1 = spectral_norm(self.conv_1)\n            if self.learned_shortcut:\n                self.conv_s = spectral_norm(self.conv_s)\n\n        # âœ¨âœ¨âœ¨ define normalization layers\n        spade_config_str = opt.norm_G.replace('spectral', '')\n        self.norm_0 = SPADE(spade_config_str, fin, opt.semantic_nc)\n        self.norm_1 = SPADE(spade_config_str, fmiddle, opt.semantic_nc)\n        if self.learned_shortcut:\n            self.norm_s = SPADE(spade_config_str, fin, opt.semantic_nc)\n```\n## Discriminator \n\ndiscriminatoræ¶æ„å›¾ã€‚ (segmentation image,  image)ä½œä¸ºè¾“å…¥ï¼Œ ä»»åŠ¡æ˜¯è¯†åˆ«imageæ˜¯ä¸æ˜¯å‡çš„ã€‚\n![c5347e81.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/c5347e81.png)\n\nimage encoderå°†å›¾ç‰‡encodeç”Ÿæˆå‡å€¼å‘é‡è·Ÿæ–¹å·®å‘é‡ï¼Œ è®¡ç®—å‡ºnoise inputè¾“å…¥ç»™generator, segmentation maskä¹Ÿä¼šé€šè¿‡SPADE ResBlksè¾“å…¥ç»™generatorã€‚ generatorç”Ÿæˆimageè·Ÿsegmentation image contactåï¼Œå†è¾“å…¥ç»™discriminator, discriminatoræ¥è¾¨åˆ«çœŸä¼ªã€‚ \n![f4341bd9.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/f4341bd9.png)\n\n### Training Data \n\næˆå¯¹çš„segmentation masksè·ŸçœŸå®å›¾ç‰‡ã€‚ (segmentation mask, real image) \n\n### Test \n\n1.å®‰è£…:\n\n```sh\ngit clone https://github.com/NVlabs/SPADE.git\ncd SPADE/\n```\n2.è¿™ä¸ªé¡¹ç›®ä¾èµ–PyTorch 1.0è·Ÿpython3.0+. è¿˜ä¾èµ–Synchronized-BatchNorm-PyTorchä»“åº“ã€‚\n\n```\n// SPADEç›®å½•ä¸‹\ncd models/networks/\ngit clone https://github.com/vacancy/Synchronized-BatchNorm-PyTorch\ncp -rf Synchronized-BatchNorm-PyTorch/sync_batchnorm .\ncd ../../\n```\n3.ç”¨PyCharmæ‰“å¼€è¿™ä¸ªé¡¹ç›®, Preference -> Project Interpreter -> Project -> Project Interpreter; é€‰python3.+çš„è§£é‡Šå™¨, PyCharmä¼šæç¤ºå®‰è£…ä¾èµ–çš„packageã€‚ä¾èµ–åŒ…å®‰è£…å¥½åï¼Œå¦‚ä¸‹å›¾: \n\n![ed349b19.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/ed349b19.png)\n\n4.ä¸‹è½½æå‰è®­ç»ƒå¥½çš„æ¨¡å‹\n[checkpoints.tar.gz - Google äº‘ç«¯ç¡¬ç›˜](https://drive.google.com/file/d/12gvlTbMvUcJewQlSEaZdeb2CdOB-b8kQ/view)\n\n```\ncd checkpoints\ntar xvf checkpoints.tar.gz\ncd ../\n\nls\n// checkpointsç›®å½•å¦‚ä¸‹:\nade20k_pretrained     checkpoints.tar.gz    cityscapes_pretrained coco_pretrained\n```\n5.ç¼–è¾‘Configuration, è¿è¡Œtest.pyè„šæœ¬ã€‚\n```sh\npython test.py --name [type]_pretrained --dataset_mode [dataset] --dataroot [path_to_dataset]\n```\n\nå‚æ•°ï¼š \n- `[type]_pretrained` å…ˆæ¸²æŸ“å¥½çš„æ¨¡å‹ï¼Œcoco_pretrainedï¼Œ ade20k_pretrainedï¼Œ cityscapes_pretrainedä¸­ä»»é€‰ä¸€ä¸ªã€‚\n- `[dataset]` å¡«coco, ade20k, æˆ–è€…cityscapes \n- `[path_to_dataset]` æ•°æ®ï¼Œæ¯”å¦‚./datasets/coco_stuff\n\næ¯”å¦‚ï¼Œæˆ‘çš„å‚æ•°: \n```\n--name\ncoco_pretrained\n--dataset_mode\ncoco\n--dataroot\n./datasets/coco_stuff\n--gpu_ids\n-1\n```\nè¾“å‡ºçš„è·¯å¾„ï¼š `./results/[type]_pretrained/` æˆ‘çš„æ˜¯`./results/coco_pretrained/`\n\n![412b71cb.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/412b71cb.png)\n\nè¿™å‡ å¼ å›¾ç‰‡çœŸæ˜¯çœ‹çš„æˆ‘æœ‰ç‚¹å¤±æœ›ï¼Œå†çœ‹çœ‹ä¸‹å›¾è®ºæ–‡çš„å›¾ç‰‡ã€‚ æœç„¶è®ºæ–‡çš„å›¾ç‰‡éƒ½æ˜¯ç²¾æŒ‘ç»†é€‰, å¥—è·¯æ»¡æ»¡ã€‚\n\n![b037261d.png](/img/7c2b5608-840f-411f-bcd4-024df194b0de/b037261d.png)\n\n- [An overview of semantic image segmentation.](https://www.jeremyjordan.me/semantic-segmentation/)","tags":["Image Segment"],"categories":["Neural Network"]},{"title":"React Nativeè°ƒè¯•:Expo + WebStorm","url":"/2019/05/14/React-Nativeè°ƒè¯•-Expo-WebStorm/"},{"title":"The Weights of the YOLO Neural Network","url":"/2019/05/12/The-Weights-of-the-YOLO-Neural-Network/","content":"\n## Load Weights\n\nFirst, see this C library function:  \n```c\nsize_t fread ( void * ptr, size_t size, size_t count, FILE * stream );\n```\n**Parameters**\n- **ptr** âˆ’ Pointer to a block of memory with a size of at least (size*count) bytes, converted to a void*.\n\n- **size** âˆ’ This is the size in bytes of each element to be read.\n\n- **count** âˆ’ This is the number of elements, each one with a size of size bytes.\n\n- **stream** âˆ’ This is the pointer to a FILE object that specifies an input stream.\n\nThen, in the `load_weights_upto` function in `parser.c`, it begins to load weights for layers from xxx.weights. \n```c\nvoid load_weights_upto(network *net, char *filename, int start, int cutoff) {\n ...\n     // Begin to load weights for layers\n    for(i = start; i < net->n && i < cutoff; ++i){\n        layer l = net->layers[i];\n        if (l.dontload) continue;\n        if(l.type == CONVOLUTIONAL || l.type == DECONVOLUTIONAL){\n            load_convolutional_weights(l, fp);\n        }\n  ...\n}\n```\n\n### Convolutional Layer\nIn `load_convolutional_weights` function, it loads values of biases for filters. One bias for one filter. \n\n```c\n    fread(l.biases, sizeof(float), l.n, fp);\n```\n`l.n` is the number of filter in this layer. \n\nAssign the values to scales, rolling_mean and rooling_variance \n```\n if (l.batch_normalize && (!l.dontloadscales)){\n        fread(l.scales, sizeof(float), l.n, fp);\n        fread(l.rolling_mean, sizeof(float), l.n, fp);\n        fread(l.rolling_variance, sizeof(float), l.n, fp);\n```\n        \nAnd load weights for filters in this layer. The default value of `l.groups` is 1.\n```c\n    int num = l.c/l.groups*l.n*l.size*l.size;\n    fread(l.weights, sizeof(float), num, fp);\n```\n\n`l.c` is input channel. The number of input channel equal to the number of channel of a filter in this layer. Thus, `l.size` is the size of a filter.\n\nFor a 3x3x3 filter (size=3, channel=3), it has 3x3x3=27 parameters as follow  \n\n![-w208](/img/15576478323378/15576531132966.jpg)\n\nIf a convolutional layer has 3 such filters, it will have 3 values for bias, 3x3x3x3 .Its weight layout in memory is like this: \n\n![-w746](/img/15576478323378/15576535368751.jpg)\n\n## Write Weights \n\n`save_weights_upto` and `save_convolutional_weights`functions show how to save weights into a xxx.weights file. It's just a reverse process. \n\n```c\nvoid save_convolutional_weights(layer l, FILE *fp)\n{\n    if(l.binary){\n        //save_convolutional_weights_binary(l, fp);\n        //return;\n    }\n    int num = l.nweights;\n    fwrite(l.biases, sizeof(float), l.n, fp);\n    if (l.batch_normalize){\n        fwrite(l.scales, sizeof(float), l.n, fp);\n        fwrite(l.rolling_mean, sizeof(float), l.n, fp);\n        fwrite(l.rolling_variance, sizeof(float), l.n, fp);\n    }\n    fwrite(l.weights, sizeof(float), num, fp);\n}\n```\n\n```\nsize_t fwrite ( const void * ptr, size_t size, size_t count, FILE * stream );\n\n```\n\n**Parameters**\n- **ptr**\nPointer to the array of elements to be written, converted to a const void*.\n- **size**\nSize in bytes of each element to be written.\nsize_t is an unsigned integral type.\n- **count**\n Number of elements, each one with a size of size bytes.\nsize_t is an unsigned integral type.\n- **stream**\nPointer to a FILE object that specifies an output stream.\n","tags":["YOLO"],"categories":["Neural Network"]},{"title":"LeetCode:237. Delete Node in a Linked List","url":"/2019/05/12/LeetCode-237-Delete-Node-in-a-Linked-List/","content":"\nWrite a function to delete a node (except the tail) in a singly linked list, given only access to that node.\n\n<!--more-->\n\n## [é¢˜ç›®](https://leetcode.com/problems/delete-node-in-a-linked-list/)\n\nWrite a function to delete a node (except the tail) in a singly linked list, given only access to that node.\n\nGiven linked list -- head = [4,5,1,9], which looks like following:\n\n![237_example.png](https://assets.leetcode.com/uploads/2018/12/28/237_example.png)\n\n## åˆ†æï¼š \n\nå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå¦‚ä¸‹çš„Linked Listï¼Œæƒ³åˆ é™¤å€¼æ˜¯5çš„èŠ‚ç‚¹. è¿™é“é¢˜è¦æ±‚ ï¼Œ`only access to that node`ã€‚\n\n```\n4 -> 5 -> 1\n```\n\n![48d29b19.png](/img/f394f304-a25b-4128-bcaa-779a974c8c4a/48d29b19.png)\nç•™æ„å›¾ä¸­ï¼Œè¦åˆ é™¤çš„å¯¹è±¡çš„åœ°å€æ˜¯0x7ff07ae00090\n\n```c++\n    void deleteNode(ListNode* node) {\n        *node = *(node->next);\n    }\n```\n\n`*node`å¯¹nodeæŒ‡é’ˆå–å†…å®¹ï¼Œè¿”å›æ˜¯ä¸€ä¸ªå¯¹è±¡, å¯¹è±¡åœ°å€0x7ff07ae00090\n\n![f94bba4f.png](/img/f394f304-a25b-4128-bcaa-779a974c8c4a/f94bba4f.png)\n\n`*node->next`å¯¹nodeæŒ‡é’ˆå–å†…å®¹ï¼Œè¿”å›æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ å¯¹è±¡åœ°å€0x7ff07ae000a0\n\n![69411ad8.png](/img/f394f304-a25b-4128-bcaa-779a974c8c4a/69411ad8.png)\n\næ‰§è¡Œ\n```\n*node = *(node->next);\n```\nç»“æœå¦‚ä¸‹ï¼š \n\n![83d8670d.png](/img/f394f304-a25b-4128-bcaa-779a974c8c4a/83d8670d.png)\n\nnodeæŒ‡é’ˆæ‰€æ‰§è¡Œçš„å¯¹è±¡åœ°å€ä¸å˜ï¼Œä½†æ˜¯å¯¹è±¡å†…å®¹å‘ç”Ÿå˜åŒ–ã€‚å°±åƒä¸‰ä¸ªæˆ¿å­ï¼Œä½ç½®æ²¡å˜ï¼Œ ä½†æ˜¯ç¬¬ä¸‰ä¸ªæˆ¿å­é‡Œçš„ä½æˆ·æ¬åˆ°äº†ç¬¬äºŒä¸ªæˆ¿å­é‡Œä½äº†ã€‚ nodeæŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡çš„åœ°å€ä¾æ—§æ˜¯0x7ff07ae00090, valä¸å†æ˜¯5è€Œæ˜¯1ï¼Œ nextæŒ‡é’ˆä¹Ÿæ‰§å‘NULLã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿä¸¢å¤±äº†å¯¹0x7ff07ae000a0å¯¹è±¡çš„æŒ‡é’ˆå¼•ç”¨ã€‚\n\n![e8798a20.png](/img/f394f304-a25b-4128-bcaa-779a974c8c4a/e8798a20.png)","tags":["Algorithm"],"categories":["Algorithm"]},{"title":"LeetCode  Flatten a Multilevel Doubly Linked List","url":"/2019/05/12/LeetCode-Flatten-a-Multilevel-Doubly-Linked-List/","content":"Flatten the list so that all the nodes appear in a single-level, doubly linked list. You are given the head of the first level of the list.\n\n<!--more-->\n\né¢˜ç›®ï¼š [430. Flatten a Multilevel Doubly Linked List]([Loading...](https://leetcode.com/problems/flatten-a-multilevel-doubly-linked-list/)\n)\n\nåˆ†æï¼š \n![da80f35a.png](/img/ed6ee62a-3dcb-4189-9404-14b91692d436/da80f35a.png)\n\n å½“é‡åˆ°æœ‰childçš„Nodeï¼Œå…ˆç”¨`*next`å­˜cur->next; æŠŠcur->nextæŒ‡é’ˆæŒ‡å‘child, child->preæŒ‡å‘curï¼› æ¥ç€ä»¥childä¸ºèµ·ç‚¹æ‰¾åˆ°è¯¥æ›¾æœ€åä¸€ä¸ªNodeï¼Œè®©å®ƒæŒ‡å‘`*next`çš„èŠ‚ç‚¹ã€‚ æ¥ç€ä»¥åŸæ¥çš„childä¸ºcur Nodeé‡æ–°å¼€å§‹ä¸€è½®ã€‚ \n\n```c++\n    class Node {\n    public:\n        int val;\n        Node *prev;\n        Node *next;\n        Node *child;\n\n        Node() {}\n\n        Node(int _val, Node *_prev, Node *_next, Node *_child) {\n            val = _val;\n            prev = _prev;\n            next = _next;\n            child = _child;\n        }\n    };\n\n    Node *flatten(Node *head) {\n        Node *cur = head;\n        while (cur) {\n            if (cur->child) {\n                Node *next = cur->next;\n                cur->next = cur->child;\n                cur->child = nullptr;\n                cur->next->prev = cur;\n\n                // iter the children \n                Node *p = cur->next;\n                while (p->next) p = p->next;\n                  \n                p->next = next;\n                if (next) next->prev = p;\n            }\n            cur = cur->next;\n        }\n\n        return head;\n    }\n```\n\næ—¶é—´å¤æ‚åº¦ï¼š $O(n)$","tags":["Algorithm"],"categories":["Algorithm"]},{"title":"The Architecture of YOLO-Tiny Neural Network","url":"/2019/05/08/The-Implementation-of-Convolutional-and-MaxPool-layer/","content":" Now, let's see how Darknet construct a nerual network. See at `detector.c` `test_detector` function, it construct a network by parsing  the `xxx.cfg` file and `xxx.weights` file. In my case, they are yolo3-tiny.cfg and yolo3-tiny.weights \n <!-- more --> \n\n\nI am trying to understand [Darknet source code](https://pjreddie.com/darknet/yolov2/) that implements YOLO algorithm. First, I run the detector.\n\n```\n./darknet detect cfg/yolov3-tiny.cfg yolov3-tiny.weights data/dog.jpg\n```\n## Parse the argumenets \n\nIn `main` function, it goes to function `test_detector` according to the first argument`detect`. \n\n```c\nif (0 == strcmp(argv[1], \"detect\")){\n   float thresh = find_float_arg(argc, argv, \"-thresh\", .5);\n   char *filename = (argc > 4) ? argv[4]: 0;\n   char *outfile = find_char_arg(argc, argv, \"-out\", 0);\n   int fullscreen = find_arg(argc, argv, \"-fullscreen\");\n   test_detector(\"cfg/coco.data\", argv[2], argv[3], filename, thresh, .5, outfile, fullscreen);\n   }   \n```\n\nHere is the architecture of neural network defined by yolov3-tiny.cfg\n\n```\n\nlayer     filters    size              input                output\n    0 conv     16  3 x 3 / 1   416 x 416 x   3   ->   416 x 416 x  16  0.150 BFLOPs\n    1 max          2 x 2 / 2   416 x 416 x  16   ->   208 x 208 x  16\n    2 conv     32  3 x 3 / 1   208 x 208 x  16   ->   208 x 208 x  32  0.399 BFLOPs\n    3 max          2 x 2 / 2   208 x 208 x  32   ->   104 x 104 x  32\n    4 conv     64  3 x 3 / 1   104 x 104 x  32   ->   104 x 104 x  64  0.399 BFLOPs\n    5 max          2 x 2 / 2   104 x 104 x  64   ->    52 x  52 x  64\n    6 conv    128  3 x 3 / 1    52 x  52 x  64   ->    52 x  52 x 128  0.399 BFLOPs\n    7 max          2 x 2 / 2    52 x  52 x 128   ->    26 x  26 x 128\n    8 conv    256  3 x 3 / 1    26 x  26 x 128   ->    26 x  26 x 256  0.399 BFLOPs\n    9 max          2 x 2 / 2    26 x  26 x 256   ->    13 x  13 x 256\n   10 conv    512  3 x 3 / 1    13 x  13 x 256   ->    13 x  13 x 512  0.399 BFLOPs\n   11 max          2 x 2 / 1    13 x  13 x 512   ->    13 x  13 x 512\n   12 conv   1024  3 x 3 / 1    13 x  13 x 512   ->    13 x  13 x1024  1.595 BFLOPs\n   13 conv    256  1 x 1 / 1    13 x  13 x1024   ->    13 x  13 x 256  0.089 BFLOPs\n   14 conv    512  3 x 3 / 1    13 x  13 x 256   ->    13 x  13 x 512  0.399 BFLOPs\n   15 conv    255  1 x 1 / 1    13 x  13 x 512   ->    13 x  13 x 255  0.044 BFLOPs\n   16 yolo\n   17 route  13\n   18 conv    128  1 x 1 / 1    13 x  13 x 256   ->    13 x  13 x 128  0.011 BFLOPs\n   19 upsample            2x    13 x  13 x 128   ->    26 x  26 x 128\n   20 route  19 8\n   21 conv    256  3 x 3 / 1    26 x  26 x 384   ->    26 x  26 x 256  1.196 BFLOPs\n   22 conv    255  1 x 1 / 1    26 x  26 x 256   ->    26 x  26 x 255  0.088 BFLOPs\n   23 yolo\n```\nNow, let's see how Darknet construct a nerual network. See  `detector.c` `test_detector` function, it construct a network by parsing  the `xxx.cfg` file and `xxx.weights` file. In my case, they are yolo3-tiny.cfg and yolo3-tiny.weights \n\n\n## Parse the configuration file\n\n### Sections in the file \n\nparse the yolo.cfg file here \n\n```c\nlist *read_cfg(char *filename)\n{\n    FILE *file = fopen(filename, \"r\");\n    if(file == 0) file_error(filename);\n    char *line;\n    int nu = 0;\n    list *options = make_list();\n    section *current = 0;\n    while((line=fgetl(file)) != 0){\n        ++ nu;\n        strip(line);\n        switch(line[0]){\n            case '[':\n                current = malloc(sizeof(section));\n                list_insert(options, current);\n                current->options = make_list();\n                current->type = line;\n                break;\n            case '\\0':\n            case '#':\n            case ';':\n                free(line);\n                break;\n            default:\n                if(!read_option(line, current->options)){\n                    fprintf(stderr, \"Config file error line %d, could parse: %s\\n\", nu, line);\n                    free(line);\n                }\n                break;\n        }\n    }\n    fclose(file);\n    return options;\n}\n```\n\n\nfor exmaple: \n\n```js\n[net]              // '[' is a tag for a section, the type of current setion is '[net]'\n# Testing          // ignore\nbatch=1         \nsubdivisions=1\n# Training\n# batch=64\n# subdivisions=2\nwidth=416\nheight=416\nchannels=3\nmomentum=0.9\ndecay=0.0005\nangle=0\nsaturation = 1.5\nexposure = 1.5\nhue=.1\n                 // ignore\nlearning_rate=0.001\n...\n\n[convolutional]    // [convoltional] \n...\n\n[maxpool]      // [maxpool] \n\n...\n[yolo]\n...\n\n[route]\n...\n\n```\n\n#### `[net]`\n\nIn section '[net]', `batch=1` is a option stored in `kvp`(option_list.c line 70) struct. Its key is batch, value is 1. Then this kvp object will be inserted into a node list (see it at option_list.c line76 & list.c line 40).\nAfter parsing the yolo3-tiny.cfg file, We will get a section list; its size is 25. Because there are 25 \\'[\\' tags in yolo3-tiny.cfg\n\n\nIn `parse_network_cfg` function, it parses the `[net]` section to get the params for the whole network. \n\n```c\nnetwork *parse_network_cfg(char *filename)\n{\n    list *sections = read_cfg(filename);\n    node *n = sections->front;\n    if(!n) error(\"Config file has no sections\");\n    network *net = make_network(sections->size - 1);\n    // other codes ...\n    \n}\n```\n\n#### `[convolutional]`\n\nThen parse the different sections. \n\n```c\n        s = (section *)n->val;\n        options = s->options;\n        layer l = {0};\n        LAYER_TYPE lt = string_to_layer_type(s->type);\n        if(lt == CONVOLUTIONAL){\n            l = parse_convolutional(options, params);\n        }else if(lt == DECONVOLUTIONAL){\n            l = parse_deconvolutional(options, params);\n        }else if(lt == LOCAL){\n            l = parse_local(options, params);\n        }else if(lt == ACTIVE){\n            l = parse_activation(options, params);\n        // other code here ...\n       \n```\n\n\nFor the first `[convolutional]` section in the yolo3-tiny.cfg as follow, the darknet will construct a `convolutional_layer` using thess params (see function `parse_convolutional` in parse.c and  function `make_convolutional_layer` in convolutional_layer.c)\n\n```js\n[convolutional]\nbatch_normalize=1\nfilters=16\nsize=3\nstride=1\npad=1\nactivation=leaky\n```\n\nIn this layer, there are 16 filters; the size of each filter is 3X3Xnum_channel; what is num_channel? well, `the number of channels in a filter must match the number of channels in input volume`, so here num_channel is equal to 3. The stride value for filters is 1, padding value is 1. \n\n\nLet's see how darknet calculate the output size of convolutional_layer by the input size(`l.h`) and filter params (`l.size`, `l.pad`, `l.stride`). There is a formula that shows how size of input volume relates to the one of output volume\n \n\n```c\n\nint convolutional_out_height(convolutional_layer l)\n{\n    return (l.h + 2*l.pad - l.size) / l.stride + 1;\n}\n\nint convolutional_out_width(convolutional_layer l)\n{\n    return (l.w + 2*l.pad - l.size) / l.stride + 1;\n}\n\n```\n\n As for yolo3-tiny.cfg, for this first convolutional_layer, its input size is 416 x 416 and channel is 3. So its ouput height is (416+2x1 - 3)/1 + 1 = 416, its output width is 416 too. `What about its output channel? It equals to the number of filters (16)`. \n \n ```c\n \n  l.out_c = n    // in func make_convolutional_layer\n  \n ```\n So its output volume size is 416 X 416 X 16.\n \n \n ![02b028d9.png](/img/995676c2-24ed-4165-8224-0bc01148242a/9b76325f.png)\n \n For a beginner, I strongly recommend these courses: [Strided Convolutions - Foundations of Convolutional Neural Networks \\| Coursera](https://www.coursera.org/lecture/convolutional-neural-networks/strided-convolutions-wfUhx) and  [One Layer of a Convolutional Network - Foundations of Convolutional Neural Networks \\| Coursera](https://www.coursera.org/lecture/convolutional-neural-networks/one-layer-of-a-convolutional-network-nsiuW)\n  \nNow, we have 16 filters that are 3X3X3 in this layer, `how many parameters does this layer have`?  Each filter is a 3X3X3 volume, so it's 27 numbers tp be learned, and then plus the bias, so that was the b parameters. it's 28 parameters. There are 16 filters so that would be 448 parameters to be learned in this layer. \n \n```c\n\n    // c: the number of channels; n: the number of filters; \n    // size: the number of filter width or height; groups: default is 1 \n    l.weights = calloc(c/groups*n*size*size, sizeof(float));\n    l.weight_updates = calloc(c/groups*n*size*size, sizeof(float));\n\n    l.biases = calloc(n, sizeof(float));\n    l.bias_updates = calloc(n, sizeof(float));\n\n    l.nweights = c/groups*n*size*size;\n    l.nbiases = n;\n\n```\n \n \n#### Activation \n \n In this convolution layer, it choose leaky ReLU as activation function. The function is defined as follow  where Î± is a small constant.\n \n $$\nf(x)=\\begin{cases}\nÎ±x,\\quad x\\leq 0 \\\\\\\\ \nx,\\quad x>0\n\\end{cases}\n$$\n\n \n Still, I recommend this course for a beginner. [Activation functions - Shallow neural networks \\| Coursera](https://www.coursera.org/lecture/neural-networks-deep-learning/activation-functions-4dDC1)\n\n \nThere are `forward_activation_layer` and `backward_activation_layer` in Darknet. Both of them handle batch inputs. \n\nFor forward activation layer, leaky_activate is to computes f(x)\n\n ```c\n static inline float leaky_activate(float x){return (x>0) ? x : .1*x;}\n ```\n For backward activation layer, leaky_gradient returns the slop of the function \n\n```c\nstatic inline float leaky_gradient(float x){return (x>0) ? 1 : .1;}\n```\n\n\n \n \n#### [maxpool]\n \n Maxpool layer is used to reduce the size of representation to speed up computation as well as to make some of the features it detects a bit more robust. Look at the `tiny-yolo3.cfg`\n \n ```js\n [maxpool]\nsize=2\nstride=2\n\n ```\n ```c\n maxpool_layer make_maxpool_layer(int batch, int h, int w, int c, int size, int stride, int padding)\n{\n    maxpool_layer l = {0};\n    l.type = MAXPOOL;\n    l.batch = batch;\n    l.h = h;\n    l.w = w;\n    l.c = c;         // output channel equals to input one \n    l.pad = padding;  // default value is size - 1\n    l.out_w = (w + padding - size)/stride + 1;\n    l.out_h = (h + padding - size)/stride + 1;\n    l.out_c = c;\n    l.outputs = l.out_h * l.out_w * l.out_c;\n    // other codes ...\n    return l;\n}\n\n \n ```\n This `[maxpool]` sections comes after the `[convolutional]` section. Its input size(416 x 416 x 16) equal to the ouput size of the former layer (416 x 416 x  16). The filter size is 2 x 2, stride is 2. Each time, the filter would move 2 steps, for a 4x4x1 input volume, its output is 2x2x1 volume. \n![e65fb56d.png](/img/995676c2-24ed-4165-8224-0bc01148242a/e65fb56d.png)\n```\n9 == max(1, 3, 2, 9)\n2 == max(2, 1, 1, 1)\n6 == max(1, 3, 5, 6)\n3 == max(2, 3, 1, 2)\n```\nSo in this layer, its ouput width equals to (int)((416+ 1 - 2)/2 + 1), 208. And the number of its output channels equals to the number of input channels. Now, we know its output volume size is 208 X 208 X 16. There is no parameter to be learned. \n\n**input volume size**: \n\n$$ n_H . n_W . n_c$$\n\n  $n_c$ : the number of channels\n\n**output volume size**: \n\n$$(\\frac{n_H + pading-f}{stride} + 1) . (\\frac{n_W + padding-f}{stride} +1) . n_c$$\n \n$f$: the width or height of a filter\n \n [Pooling Layers - Foundations of Convolutional Neural Networks \\| Coursera](https://www.coursera.org/lecture/convolutional-neural-networks/pooling-layers-hELHk)\n \n #### Why does 1 x 1 convolution do? \n \n [Networks in Networks and 1x1 Convolutions - Deep convolutional models: case studies \\| Coursera](https://www.coursera.org/lecture/convolutional-neural-networks/networks-in-networks-and-1x1-convolutions-ZTb8x)\n \n \n For example, in this picture, the number of input volume channels ,192, has gotten too big, we can shrink it to a 28x28x32 dimension volume using 32 filters that are 1x1x192. So this is a way to shrink the number of channels .\n \n ![a085e0e4.png](/img/995676c2-24ed-4165-8224-0bc01148242a/a085e0e4.png)\n \n \n In YOLO, it implements fully connected layer by two convolutional layer. \n \n ```\n[convolutional]\nbatch_normalize=1\nfilters=256\nsize=3\nstride=1\npad=1\nactivation=leaky\n\n[convolutional]\nsize=1\nstride=1\npad=1\nfilters=255\nactivation=linear\n ```\n \n [Convolutional Implementation of Sliding Windows - Object detection \\| Coursera](https://www.coursera.org/lecture/convolutional-neural-networks/convolutional-implementation-of-sliding-windows-6UnU4)\n \n","tags":["YOLO"],"categories":["Neural Network"]},{"title":"LeetCode Unique Paths 1-2","url":"/2019/05/08/Leetcode-Unique-Paths-1-2/","content":"Leetcode Unique Paths 1-2 \n<!-- more --> \n\n# Unique Paths 1-2\n\n## é¢˜ç›®1ï¼š [Unique Paths 1](https://leetcode.com/problems/unique-paths/)\n\n![e2ca2848.png](/img//c5619f25-13a6-4e38-b7f8-d87ff624f5b5/e2ca2848.png)\n\n### åŠ¨æ€è§„åˆ’è§£é¢˜æ­¥éª¤è¦ç‚¹: \n\n1. æ‰¾åˆ°æœ€ä¼˜è§£çš„ç»“æ„\n2. é€’å½’æ–¹æ¡ˆ\n3. bottom-up æˆ–è€… top-downæ–¹å¼æ±‚æœ€ä¼˜è§£\n4. ä¼˜åŒ–ï¼Œç©ºé—´æ¢æ—¶é—´\n\n### åˆ†æ\n\nè¿™é“é¢˜å¾ˆç®€å•ã€‚\n1. å®šä¹‰ä¸€ä¸ª mxn çš„äºŒç»´æ•°ç»„grides[m][n]ï¼Œ å¯¹åº”æ ¼å­åœ°å›¾ã€‚å¯¹åº”é€”ä¸­grides[2][6]\n\n![e594b650.png](/img//c5619f25-13a6-4e38-b7f8-d87ff624f5b5/e594b650.png)\næ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“ä»(0,0)åˆ°(1, 2)æœ‰å‡ æ¡è·¯ã€‚æ ¹æ®é¢˜ç›®è¦æ±‚ï¼Œåªèƒ½å¾€å³èµ°æˆ–è€…ä¸‹èµ°ä¸€ä¸ªæ ¼å­ã€‚\næˆ‘ä»¬å…ˆçœ‹ä»(1, 1)åˆ°ï¼ˆ1ï¼Œ2ï¼‰ï¼Œä¸¤ç§èµ°æ³•ï¼š \n- (2, 0) -> (1, 2)\n- (1, 1) -> (1, 2)\n\nå†çœ‹ä»(0, 0)åˆ°(2ï¼Œ 0) åªæœ‰ä¸€æ¡è·¯: (0, 0) -> (1, 1) -> (2, 0)ï¼› grides[2][0] = 1ã€‚\n\nä»(0, 0)æ ¼å­åˆ°(1,1)æ ¼å­ï¼Œæœ‰ä¸¤ç§è·¯: \n- (0,0) -> (0, 1)-> (1, 1)\n- (0,0) -> (1, 0)-> (1, 1)\né‚£ä¹ˆgrides(1, 1) = 2. \n \nå¾ˆå®¹æ˜“å‘ç°è§„å¾‹ï¼Œ grids[m][n] = grids[m - 1][n] + grides[m][n -1]; å¯ç”¨é€’å½’æ±‚è§£ã€‚ä½†æ˜¯çº¯ç¢çš„é€’å½’æœ‰å¾ˆå¤šé‡å¤è®¡ç®—ã€‚ å¦‚ä¸‹å›¾çš„é€’å½’æ ‘ï¼š \n![72a3d4ef.png](/img//c5619f25-13a6-4e38-b7f8-d87ff624f5b5/72a3d4ef.png)\næ‰€ä»¥æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªrecordæ•°ç»„ï¼Œè®°å½•å·²ç»è®¡ç®—çš„ç»“æœï¼Œçœå»é‡å¤è®¡ç®—ã€‚\n\næ—¶é—´å¤æ‚åº¦: \no(m* n)\n\n```c++\nint inner_path(int i, int j, int m, int n, vector<vector<int>>& record) {\n    if (i < 0 || j < 0) {\n        return 0;\n    }\n\n    if (record[i][j]) {\n        return record[i][j];\n    }\n\n    if ((i == 0) && (j == 0)) {\n        return 1;\n    }\n\n    record[i][j] = inner_path(i-1, j, m, n, record) + inner_path(i, j-1, m, n, record);\n    return record[i][j];\n}\n\nint uniquePaths(int m, int n) {\n    vector<vector<int>> res(m, vector<int>(n, 0));\n    return inner_path(m-1, n-1, m, n, res);\n}\n```\n\n### [Unique Paths 2](https://leetcode.com/problems/unique-paths-ii/)\n\nåˆ†æï¼š \nè·ŸUnique Paths 1æ¯”èµ·æ¥ï¼Œå¤šäº†éšœç¢ç‰©ã€‚å¦‚æœ(i, j)æ˜¯éšœç¢ç‰©ï¼Œé‚£ä¹ˆgrid(i, j) = 0, è¡¨ç¤ºæˆ‘ä»¬æ— æ³•ç»ç”±(i, j) åˆ°è¾¾ç»ˆç‚¹ã€‚\n\n\n\n```c++\nint path_helper(int i, int j, int m, int n, vector<vector<int>>& record, vector<vector<int>> &obstacleGrid) {\n        if (i < 0 || j < 0 || obstacleGrid[i][j] == 1) {\n            return 0;\n        }\n\n        if (record[i][j]) {\n            return record[i][j];\n        }\n\n        if ((i == 0) && (j == 0)) {\n            return 1;\n        }\n\n        record[i][j] = path_helper(i - 1, j, m, n, record, obstacleGrid) + path_helper(i, j - 1, m, n, record, obstacleGrid);\n        return record[i][j];\n    }\n\n    int uniquePathsWithObstacles(vector<vector<int>>& obstacleGrid) {\n        if (obstacleGrid.empty()) return 0;\n        int m = (int)obstacleGrid.size();\n        int n = (int)obstacleGrid[0].size();\n\n        vector<vector<int>> res(m, vector<int>(n, 0));\n        return path_helper(m - 1, n - 1, m, n, res, obstacleGrid);\n    }\n```\n\nè‡ªåº•å‘ä¸Šçš„å†™æ³•ï¼š \n\n```c++\n   int uniquePathsWithObstacles(vector<vector<int>>& grid) {\n        int rows = grid.size();\n        if(rows == 0) return 0;\n        int cols = grid[0].size();\n        vector<vector<long>> res(rows+1, vector<long>(cols+1, 0));\n        for(int i=rows-1; i>=0;i--){\n            for(int j=cols-1; j>=0;j--){\n                if(grid[i][j] == 1) res[i][j] = 0;\n                else if(i == rows-1 && j == cols-1) res[i][j] = 1;\n                else res[i][j] = res[i][j+1] + res[i+1][j];\n            }\n        }\n        return res[0][0];\n    }\n```","tags":["Algorithm"],"categories":["Algorithm"]},{"title":"LeetCode 959. Regions Cut By Slashes ç¬”è®°","url":"/2019/04/23/Leetcode-959-Regions-Cut-By-Slashes/","content":"\né¢˜ç›®ï¼šhttps://leetcode.com/problems/regions-cut-by-slashes/description/\n\n## Solution1: DFS \n\nTime Complexity::  $O(n^2)$\n\n### åˆ†æï¼š \n[è¿™ä¸ªç¥å¥‡çš„æ€è·¯](https://leetcode.com/problems/regions-cut-by-slashes/discuss/205674/C++-with-picture-DFS-on-upscaled-grid)åˆ†å‰²æ ¼å­ï¼Œè½¬åŒ–ä¸ºå›¾çš„DFSé—®é¢˜ã€‚\n```json\nInput:\n[\n  \"\\\\/\",\n  \"/\\\\\"\n]\n```\n\næŠŠ`\\\\`ï¼Œ`/`æˆ–è€…` `åˆ†åˆ«åˆ†å‰²æˆ3*3çš„æ ¼å­ã€‚å›¾è½¬åŒ–ä¸º: \n\n```json\n[\n 1,0,0,0,0,1,\n 0,1,0,0,1,0,\n 0,0,1,1,0,0\n 0,0,1,1,0,0\n 0,1,0,0,1,0\n 1,0,0,0,0,1\n]\n```\n\né—®é¢˜å°±å˜æˆï¼š è®¡ç®—è¢«1åˆ†å‰²å¼€çš„åŒºåŸŸçš„æ•°é‡ã€‚\n\nç±»ä¼¼çš„[å­¤å²›æ•°é‡é—®é¢˜](https://www.geeksforgeeks.org/find-number-of-islands/) éƒ½æ˜¯åŒä¸€ä¸ªé—®é¢˜çš„å˜ç§ï¼š[Counting the number of connected components in an undirected graph](https://www.geeksforgeeks.org/connected-components-in-an-undirected-graph/)\n\n```c++\nvoid dfs(vector<vector<int>>& board, int i, int j ) {\n    // index out of range\n    if (i < 0 || j < 0 || i >= board.size() || j >= board[0].size()) return;\n    // this grid has been visited or it was part of a slash character\n    if (board[i][j] == 1) return;\n\n    // mark this grid visited\n    board[i][j] = true;\n\n    dfs(board, i - 1, j);\n    dfs(board, i + 1, j);\n    dfs(board, i, j - 1);\n    dfs(board, i, j + 1);\n}\n\nint regionsBySlashes(vector<string>& grid) {\n    if (grid.empty())\n        return 0;\n    int row = (int)grid.size(), col = (int)grid[0].size();\n    vector<vector<int>> board (row * 3, vector<int>(col * 3, 0));\n\n    // n*n graph represented as 3n*3n graph\n    for (int i = 0; i < row; ++i) {\n        for (int j = 0; j < col; ++j) {\n            if (grid[i][j] == '/') board[i * 3][j * 3 + 2] = board[i * 3 + 1][j * 3 + 1] = board[i * 3 + 2][j * 3] = 1;\n            if (grid[i][j] == '\\\\') board[i * 3][j * 3] = board[i * 3 + 1][j * 3 + 1] = board[i * 3 + 2][j * 3 + 2] = 1;\n        }\n    }\n\n    int cnt = 0;\n    for (int i = 0; i < row * 3; ++i) {\n        for (int j = 0; j < col * 3; ++j) {\n            // only count components connected by space\n            if (!board[i][j]) {\n               dfs(board, i, j);\n               cnt++;\n            }\n        }\n    }\n\n    return cnt;\n}\n\n```\n\nå¦‚æœåˆ†å‰²ä¸º2*2çš„æ ¼å­ï¼Œä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜:\n```\nInput:\n[\n  \"//\",\n  \"/ \"\n]\nOutput: 5\nExpected: 3\n\n0101\n1010\n0100\n1000\n```\n01**0**1\n1**0**10\n**0**100\n1000\n\nåŠ ç²—çš„è¿™ä¸‰ä¸ª0ï¼Œè¢«åˆ†å‰²å¼€äº†ã€‚é¢˜æ„è¦æ±‚æ˜¯è¿åœ¨ä¸€èµ·çš„ã€‚\n\n\n## Solution2: DSU\n\nTime Complexity:  $O(n^2*\\alpha(n))$\nSpace Complexity: $O(n^2)$\n\n### åˆ†æï¼š \n\n#### DSU: \nhttps://www.youtube.com/watch?v=YKE4Vd1ysPI\nhttps://www.youtube.com/watch?v=gpmOaSBcbYA\n\nDSUä¸­ç”¨æ•°ç»„æ¥è¡¨ç¤ºæ ‘ï¼Œ å¦‚ä¸‹ï¼š \n\n| idx | 0 |  1 | 2 |\n| --- | --- | --- | --- |\n| parent | 1 | -1 | 1 |\n\n \nparent[0] = 1, ä»£è¡¨node 0çš„parentæ˜¯1ï¼› parent[2] = 1ä»£è¡¨node 2çš„parentæ˜¯1; parent[1] = -1, ä»£è¡¨å®ƒæ˜¯rootã€‚ \n\n```\n   1\n /  \\\n0    2\n```\n\nä¸¤ä¸ªoperationï¼š \n**find(x)**: find root of cluster in which x is \n\n```\n   1                   5\n  / \\                 / \\\n 0   2               6   7\n    / \\                   \\\n   3   4                  8\n```\næ¯”å¦‚ï¼š æˆ‘ä»¬æƒ³æ‰¾3è·Ÿ8æ‰€åœ¨clusterçš„rootï¼Œ find(3) == 1,  find(8) == 5\n\n```c\n/*é€’å½’æŸ¥æ‰¾root*/\nint find(int x, int parent[]) {\n    int x_root = x; \n    while (parent[x_root]!= -1) {\n        x_root = parent[x_root];\n    }\n    return x_root;\n}\n```\n**union(x, y)**: union two cluster where x, y are in \n\næ¯”å¦‚ï¼š æˆ‘ä»¬æƒ³union(3, 8),  å°±è¦å…ˆæ‰¾åˆ°3çš„x_rootï¼Œ è·Ÿ8çš„y_rootï¼Œç„¶ååˆå¹¶ä¸¤ä¸ªroot.\n\n```c\nint union(int x, int y, int parent[]) {\n    int x_root = find(x, parent);\n    int y_root = find(y, parent); \n    if (x_root == y_root) {\n        return 0; \n    } else {\n        // y_root å˜æˆ x_rootçš„æ ¹\n        parent[x_root] = y_root;\n        return 1\n    }\n}\n```\n\n```\n              5\n         /   / \\\n        1   6   7\n       / \\       \\\n      0   2       8\n         / \\ \n        3   4 \n```\n\n                                \nDSUè…»å®³çš„ä¸€ç‚¹æ˜¯ä¼˜åŒ–åï¼Œç”¨$O(1)$çš„average time cost, æ£€æµ‹å›¾é‡Œæœ‰å’©æœ‰ç¯\n\nä¸¤ç§ä¼˜åŒ–ï¼š \n- Make tree flat \n- Union by rank\n\nhttps://www.youtube.com/watch?v=VJnUwsE4fWA\n\n\n### åˆ†å‰²æˆ4ä¸ªä¸‰è§’å½¢ï¼Œ ä¸Šä¸‹å·¦å³\næ¯ä¸ªæ ¼å­åˆ†å‰²æˆä¸Šä¸‹å·¦å³å››ä¸ªä¸‰è§’å½¢ã€‚\nhttps://assets.leetcode.com/uploads/2018/12/15/3.png\n\næ¯ä¸ªä¸‰è§’å½¢ç»™ä¸ªidx: 0, 1, 2, 3åˆ†åˆ«å¯¹åº” top, right, bottom, left\n```\n\\ 0 /\n3 \\ 1\n/ 2 \\\n```\nn*nçš„å›¾ï¼›å˜æˆ 4*n*nçš„æ•°ç»„ã€‚ åˆå§‹åŒ–æ—¶æ•°ç»„parentçš„æ¯ä¸ªå€¼éƒ½æ˜¯-1, ä»£è¡¨æ¯ä¸ªç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚æˆ‘ä»¬éå†gridä¸­çš„æ¯ä¸ªç‚¹, grid[i][j]ï¼Œ åˆ†åˆ«è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š \n\n'/':  ä¸Šã€å·¦è¿æ¥ï¼› ä¸‹ã€å³è¿æ¥\n'\\\\': ä¸Šã€å³è¿æ¥ï¼› å·¦ã€ä¸‹è¿æ¥\n' ': å››ä¸ªéƒ¨åˆ†è¿æ¥\n\nå¯¹æ¯ä¸ªgrid[i][j], åˆå¹¶grid[i-1][j]çš„bottomä¸‰è§’å½¢æ ¹grid[i][j]çš„top ä¸‰è§’å½¢ï¼›åˆå¹¶grid[i][j-1]çš„rightä¸‰è§’å½¢è·Ÿgrid[i][j]çš„leftä¸‰è§’å½¢ã€‚\n\næœ€ç»ˆä»£ç å¦‚ä¸‹:\n\n```c++\nclass DSU {\nprivate:\n    // use array represents a graph\n    vector<int> parent;\n    int row = 0;\npublic:\n    // num of root of independent cluster\n    int num_root = 0;\n\n    DSU(int n) {\n        parent = vector<int>(n * n * 4, -1);\n        num_root = n * n * 4;\n        row = n;\n    }\n\n    int find(int x) {\n        // find the root of the cluster where x is iteratively\n        while (parent[x] != -1) {\n            x = parent[x];\n        }\n        return x;\n    }\n\n    /**\n    * return: 1: successfully; 0: failed\n    */\n    int union_cluster(int x, int y) {\n        int x_root = find(x);\n        int y_root = find(y);\n        if (x_root == y_root) {\n            return 0;\n        } else {\n            int min_ = min(x_root, y_root);\n            int max_ = max(x_root, y_root);\n            parent[min_] = max_;\n            \n            num_root--;\n            return 1;\n        };\n    }\n\n    /**\n     * å°†å›¾ä¸­ï¼ˆi,j)ä½ç½®çš„ç‚¹ï¼Œæ˜ å°„åˆ°æ•°ç»„çš„idx\n     * @param i\n     * @param j\n     * @param part\n     * @param n\n     * @return\n     */\n    int idx(int i, int j, int part) {\n        return (i * row + j) * 4 + part;\n    }\n};\n\n\n// https://leetcode.com/problems/regions-cut-by-slashes/discuss/205680/JavaC%2B%2BPython-Split-4-parts-and-Union-Find\nint regionsBySlashes(vector<string> &grid) {\n    if (grid.empty()) return 0;\n    int n = (int) grid.size();\n\n    DSU dsu = DSU(n);\n\n    for (int i = 0; i < n; ++i) {\n        for (int j = 0; j < n; ++j) {\n            // merge the bottom part of the (i-1, j) grid and the top part of the grid (i, j)\n            if (i > 0) dsu.union_cluster(dsu.idx(i - 1, j, 2), dsu.idx(i, j, 0));\n            // merge the right part of the (i, j-1) grid and the left part of the grid(i,j)\n            if (j > 0) dsu.union_cluster(dsu.idx(i, j - 1, 1), dsu.idx(i, j, 3));\n\n            if (grid[i][j] == '/') {\n                // union the top and the left part of this cell\n                dsu.union_cluster(dsu.idx(i, j, 3), dsu.idx(i, j, 0));\n                // union the right and the bottom of this cell\n                dsu.union_cluster(dsu.idx(i, j, 2), dsu.idx(i, j, 1));\n            }\n\n            if (grid[i][j] == '\\\\') {\n                dsu.union_cluster(dsu.idx(i, j, 0), dsu.idx(i, j, 1));\n                dsu.union_cluster(dsu.idx(i, j, 2), dsu.idx(i, j, 3));\n            }\n\n            if (grid[i][j] == ' ') {\n                dsu.union_cluster(dsu.idx(i, j, 0), dsu.idx(i, j, 2));\n                dsu.union_cluster(dsu.idx(i, j, 1), dsu.idx(i, j, 3));\n                dsu.union_cluster(dsu.idx(i, j, 1), dsu.idx(i, j, 2));\n            }\n        }\n    }\n\n    return dsu.num_root;\n}\n\n```\n\nhttps://leetcode.com/problems/regions-cut-by-slashes/discuss/205680/JavaC%2B%2BPython-Split-4-parts-and-Union-Find\n","tags":["Algorithm"],"categories":["Algorithm"]},{"title":"XMPP(6):XMPP-æ¶ˆæ¯å­˜å‚¨ä¸æ‹‰å–å†å²æ¶ˆæ¯","url":"/2019/04/10/XMPP-6-XMPP-æ¶ˆæ¯å­˜å‚¨ä¸æ‹‰å–å†å²æ¶ˆæ¯/","content":"\n\nXEP-0313å®šä¹‰äº†XMPPæ¶ˆæ¯å­˜å‚¨çš„è§„åˆ™ã€‚\n\n### åœºæ™¯éœ€æ±‚\n0313åè®®ä¸»è¦æœ‰è¿™äº›åœºæ™¯ï¼š \n- åŒè´¦å·å¤šå®¢æˆ·ç«¯ä¹‹é—´çš„å†å²æ¶ˆæ¯åŒæ­¥\n- å®¢æˆ·ç«¯æ‹‰å–å†å²æ¶ˆæ¯ï¼ŒæŒ‰æ—¥æœŸæ’åºå±•ç¤ºï¼ˆæƒ³æƒ³æˆ‘ä»¬åœ¨å¾®ä¿¡çš„å†å²æ¶ˆæ¯ï¼‰\n- åˆ†é¡µæ‹‰å–æ¶ˆæ¯\n\n### å­˜å‚¨\n\n1. å•æ¡æ¶ˆæ¯å­˜å‚¨åŒ…æ‹¬ï¼š \n- æ¶ˆæ¯å‘é€è·Ÿæ¥æ”¶çš„æ—¶é—´æˆ³\n- from è·Ÿ to çš„JID\n- server-assigned UID\n- message stanza \n\n2. æ¶ˆæ¯çš„é¡ºåºè¦ä¿å­˜ï¼š ä¾èµ–timestampè¦å°å¿ƒï¼Œå› ä¸ºå¤šæ¡æ¶ˆæ¯å¯èƒ½å…±äº«æ—¶é—´æˆ³\n3. è¶…è¿‡ä¸€å®šæ•°é‡ï¼Œå¯åˆ é™¤æ—§ä¿¡æ¯\n4. ç¾¤èŠè®°å½•ç”¨MAMæœåŠ¡\n5. archive id ` <stanza-id/>`\nè¢«archivedè¿‡çš„æ¶ˆæ¯ï¼Œserverè¦ç»™å®ƒåŠ ä¸Šstanza-id\nExample 1. Client receives a message that has been archived\n\n```xml\n<message to='juliet@capulet.lit/balcony'\n         from='romeo@montague.lit/orchard'\n         type='chat'>\n  <body>Call me but love, and I'll be new baptized; Henceforth I never will be Romeo.</body>\n  <stanza-id xmlns='urn:xmpp:sid:0' by='juliet@capulet.lit' id='28482-98726-73623' />\n</message>\n\n```\nstanza-id: archive ID \n\n### æŸ¥è¯¢\n\n#### 1. A user queries their archive for messages\nç”¨æ¶ˆæ¯UIDæŸ¥è¯¢\n\n'urn:xmpp:mam:2' namespace, indicating the UID of the first and last message of the (possibly limited) result set. \n\n```xml\n<iq type='set' id='juliet1'>\n  <query xmlns='urn:xmpp:mam:2' queryid='f27' />\n</iq>\n```\n\n#### 2. Their server sends the matching messages\n\n\n\n```xml\n<message id='aeb213' to='juliet@capulet.lit/chamber'>\n  <result xmlns='urn:xmpp:mam:2' queryid='f27' id='28482-98726-73623'>\n    <forwarded xmlns='urn:xmpp:forward:0'>\n      <delay xmlns='urn:xmpp:delay' stamp='2010-07-10T23:08:25Z'/>\n      <message xmlns='jabber:client' from=\"witch@shakespeare.lit\" to=\"macbeth@shakespeare.lit\">\n        <body>Hail to thee</body>\n      </message>\n    </forwarded>\n  </result>\n</message>\n\n```\n\n#### 3. Server returns the result IQ to signal the end\n\n\n```xml\n<iq type='result' id='juliet1'>\n  <fin xmlns='urn:xmpp:mam:2'>\n    <set xmlns='http://jabber.org/protocol/rsm'>\n      <first index='0'>28482-98726-73623</first>\n      <last>09af3-cc343-b409f</last>\n    </set>\n  </fin>\n</iq>\n```\n\nserverçš„è¿™æ¡iq stanzaæ ‡è®°æŸ¥è¯¢ç»“æœç»“æŸã€‚\n\n### è¿‡æ»¤å™¨\n\n#### 1. æ ¹æ®JIDè¿‡æ»¤\n\n`with` å­—æ®µ + JID(Bare JID)ï¼š ä¼šæ‹¿åˆ°toæˆ–fromåœ°å€åŒ¹é…JIDçš„ä¿¡æ¯; å¦‚æœæ²¡æœ‰with, æœåŠ¡ç«¯è¿”å›queryæŒ‡å®šçš„æ—¶é—´æ®µå†…çš„æ¶ˆæ¯ã€‚ \n\n```xml \nExample 6. Querying for all messages to/from a particular JIDÂ¶\n<iq type='set' id='juliet1'>\n  <query xmlns='urn:xmpp:mam:2'>\n    <x xmlns='jabber:x:data' type='submit'>\n      <field var='FORM_TYPE' type='hidden'>\n        <value>urn:xmpp:mam:2</value>\n      </field>\n      <field var='with'>\n        <value>juliet@capulet.lit</value>\n      </field>\n    </x>\n  </query>\n</iq>\n```\n\n**ä½¿ç”¨åœºæ™¯ï¼š**\nAæƒ³æŸ¥è¯¢è·ŸBçš„èŠå¤©è®°å½•ï¼Œwithå­—æ®µçš„valueè®¾ä¸ºB, æœåŠ¡ç«¯è¿”å›çš„messagesä¸­ï¼Œæ—¢æœ‰Bå‘é€ç»™Açš„msgï¼Œä¹Ÿæœ‰Aå‘é€ç»™Bçš„msgã€‚ \n\n![3c4760c7.png](/img/f3eaaed1-370f-4abc-93b2-a3312d3ebcd4/3c4760c7.png)\n#### 2. æ ¹æ®æ¥æ”¶æ—¶é—´è¿‡æ»¤\n\n`start` è·Ÿ `end` å­—æ®µæ ‡è®°æ—¶é—´æˆ³ã€‚ æ—¶é—´æˆ³æ ¼å¼è§https://xmpp.org/extensions/xep-0082.html\n\n```xml\nExample 7. Querying the archive for all messages in a certain timespanÂ¶\n<iq type='set' id='juliet1'>\n  <query xmlns='urn:xmpp:mam:2'>\n    <x xmlns='jabber:x:data' type='submit'>\n      <field var='FORM_TYPE' type='hidden'>\n        <value>urn:xmpp:mam:2</value>\n      </field>\n      <field var='start'>\n         // UTCæ ¼å¼\n        <value>2010-06-07T00:00:00Z</value>\n      </field>\n      <field var='end'>\n        <value>2010-07-07T13:23:54Z</value>\n      </field>\n    </x>\n  </query>\n</iq>\n```\nå¦‚æœ`end` ç¼ºå¤±ï¼Œ serverä¼šè‡ªåŠ¨è®¤ä¸ºæ˜¯æœ€è¿‘çš„æ¶ˆæ¯çš„å­˜å‚¨æ—¶é—´\n\n``` xml\nExample 8. Querying the archive for all messages after a certain timeÂ¶\n<iq type='set' id='juliet1'>\n  <query xmlns='urn:xmpp:mam:2'>\n    <x xmlns='jabber:x:data' type='submit'>\n      <field var='FORM_TYPE' type='hidden'>\n        <value>urn:xmpp:mam:2</value>\n      </field>\n      <field var='start'>\n        <value>2010-08-07T00:00:00Z</value>\n      </field>\n    </x>\n  </query>\n</iq>   \n```\n\n#### 3. é™å®šresultsçš„æ•°é‡\n\n[Result Set Management (XEP-0059)](https://xmpp.org/extensions/xep-0059.html) \n\n```xml\nExample 9. A query using Result Set ManagementÂ¶\n<iq type='set' id='q29302'>\n  <query xmlns='urn:xmpp:mam:2'>\n    <x xmlns='jabber:x:data' type='submit'>\n      <field var='FORM_TYPE' type='hidden'>\n        <value>urn:xmpp:mam:2</value>\n      </field>\n      <field var='start'>\n        <value>2010-08-07T00:00:00Z</value>\n      </field>\n    </x>\n    <set xmlns='http://jabber.org/protocol/rsm'>\n      <max>10</max>\n    </set>\n  </query>\n</iq>\n```\n\nè¿™ä¸ªè¯·æ±‚ï¼ŒæŒ‡å®šå®¢æˆ·ç«¯æœ€å¤šåªèƒ½æ”¶åˆ°10æ¡stanzasã€‚ä½†æœåŠ¡ç«¯çš„è¿”å›ç»“æœå¯èƒ½å›æ”¹å˜`set`çš„å†…å®¹ï¼Œè¿”å›è‡ªå·±é™å®šçš„æ•°é‡ï¼Œæ¯”å¦‚ï¼š è¿™æ˜¯è¿”å›`start`æ—¶é—´è·Ÿ`end`æ—¶é—´æ®µå†…çš„20æ¡æ¶ˆæ¯ã€‚\n\n```xml\nExample 10. Server responds to client with limited results using RSMÂ¶\n<!-- result messages -->\n<iq type='result' id='q29302'>\n  <fin xmlns='urn:xmpp:mam:2'>\n    <set xmlns='http://jabber.org/protocol/rsm'>\n      <first index='0'>28482-98726-73623</first>\n      <last>09af3-cc343-b409f</last>\n      <count>20</count>\n    </set>\n  </fin>\n</iq>\n```\n\n#### 4. åˆ†é¡µæ‹‰å–æ¶ˆæ¯\n\nå¦‚æœä¹‹å‰å·²ç»è·å–äº†mæ¡æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥å†å‘é€åŒæ ·çš„è¯·æ±‚ï¼Œæ‹‰å–ä¸‹ä¸€é¡µæ¶ˆæ¯ã€‚`set`ä¸­è¦å¸¦ä¸Š`after`(ä¸Šæ¬¡æ‹‰å–åˆ°çš„æœ€åä¸€æ¡æ¶ˆæ¯çš„UID)\n\n```xml\nExample 11. A page query using Result Set ManagementÂ¶\n<iq type='set' id='q29303'>\n  <query xmlns='urn:xmpp:mam:2'>\n      <x xmlns='jabber:x:data' type='submit'>\n        <field var='FORM_TYPE' type='hidden'><value>urn:xmpp:mam:2</value></field>\n        <field var='start'><value>2010-08-07T00:00:00Z</value></field>\n      </x>\n      <set xmlns='http://jabber.org/protocol/rsm'>\n         <max>10</max>\n         <after>09af3-cc343-b409f</after>\n      </set>\n  </query>\n</iq>\n```\n\nserverè¿”å›æœ€åä¸€é¡µæ¶ˆæ¯ï¼Œä¼šåœ¨ finé‡Œå¤´å¸¦ä¸Š`complete`å±æ€§ï¼Œå€¼ä¸º`ture`\n\n```xml\nExample 12. Server completes a result with the last page of messagesÂ¶\n<!-- result messages -->\n<iq type='result' id='u29303'>\n  <fin xmlns='urn:xmpp:mam:2' complete='true'>\n    <set xmlns='http://jabber.org/protocol/rsm'>\n      <first index='0'>23452-4534-1</first>\n      <last>390-2342-22</last>\n      <count>16</count>\n    </set>\n  </fin>\n</iq>\n    \n```\n\n**ä½¿ç”¨åœºæ™¯ï¼š**\n\nAå®¢æˆ·ç«¯æœ¬åœ°å­˜å‚¨è·ŸBçš„èŠå¤©ä¿¡æ¯ï¼Œ æœ€åä¸€æ¡messageçš„idæ˜¯`09af3-cc343-b409f`ã€‚ ç°åœ¨Aæƒ³çœ‹çœ‹æœ€è¿‘çš„æ¶ˆæ¯ï¼ˆ`09af3-cc343-b409f`åçš„messageï¼Œå¯ä»¥å‘é€iqè¯·æ±‚ä¸­å¸¦ä¸Š`<after>09af3-cc343-b409f</after>`ã€‚å·®é‡è¯·æ±‚æœ€æ–°æ¶ˆæ¯ï¼ŒåŸºäºæ¸¸æ ‡çš„åˆ†é¡µã€‚\n#### 5.å…¶ä»–å­—æ®µçš„ç­›é€‰\n\nå®¢æˆ·ç«¯æŸ¥è¯¢æœåŠ¡ç«¯æ”¯æŒçš„å…¶ä»–å­—æ®µ\n```xml\nExample 13. Client requests supported query fieldsÂ¶\n<iq type='get' id='form1'>\n  <query xmlns='urn:xmpp:mam:2'/>\n</iq>\n```\n\n```xml\nExample 14. Server returns supported fieldsÂ¶\n<iq type='result' id='form1'>\n  <query xmlns='urn:xmpp:mam:2'>\n    <x xmlns='jabber:x:data' type='form'>\n      <field type='hidden' var='FORM_TYPE'>\n        <value>urn:xmpp:mam:2</value>\n      </field>\n      <field type='jid-single' var='with'/>\n      // æŒ‰æ¶ˆæ¯receivedæ—¶é—´æŸ¥è¯¢\n      <field type='text-single' var='start'/>\n      <field type='text-single' var='end'/>\n      // æŒ‰æ–‡æœ¬æŸ¥è¯¢\n      <field type='text-single' var='urn:example:xmpp:free-text-search'/>\n      // stanzaå†…å®¹\n      <field type='text-single' var='urn:example:xmpp:stanza-content'/>\n    </x>\n  </query>\n</iq>\n```\n### è¿”å›çš„message stanza ç»“æ„\n\n- `message`è¢«å°è£…åœ¨`forwarded`å…ƒç´ ä¸­ã€‚ [XEP-0297: Stanza Forwarding](https://xmpp.org/extensions/xep-0297.html)\n- å¸¦`result` å…ƒç´ ï¼Œ å…¶å±æ€§idæ˜¯è¿™æ¡messageçš„UID\n- delayå…ƒç´  [XEP-0203: Delayed Delivery](https://xmpp.org/extensions/xep-0203.html) messageè¢«æ”¶åˆ°çš„æ—¶é—´, UTCæ—¶é—´æˆ³æ ¼å¼\n\n\n```xml\nExample 16. Server returns two matching messagesÂ¶\n<message id='aeb213' to='juliet@capulet.lit/chamber'>\n  <result xmlns='urn:xmpp:mam:2' queryid='f27' id='28482-98726-73623'>\n    <forwarded xmlns='urn:xmpp:forward:0'>\n      <delay xmlns='urn:xmpp:delay' stamp='2010-07-10T23:08:25Z'/>\n      <message xmlns='jabber:client'\n        to='juliet@capulet.lit/balcony'\n        from='romeo@montague.lit/orchard'\n        type='chat'>\n        <body>Call me but love, and I'll be new baptized; Henceforth I never will be Romeo.</body>\n      </message>\n    </forwarded>\n  </result>\n</message>\n\n<message id='aeb214' to='juliet@capulet.lit/chamber'>\n  <result xmlns='urn:xmpp:mam:2' queryid='f27' id='5d398-28273-f7382'>\n    <forwarded xmlns='urn:xmpp:forward:0'>\n      <delay xmlns='urn:xmpp:delay' stamp='2010-07-10T23:09:32Z'/>\n      <message xmlns='jabber:client'\n         to='romeo@montague.lit/orchard'\n         from='juliet@capulet.lit/balcony'\n         type='chat' id='8a54s'>\n        <body>What man art thou that thus bescreen'd in night so stumblest on my counsel?</body>\n      </message>\n    </forwarded>\n  </result>\n</message>\n    \n```\n\n## MUC Archive\n\n- å­˜å‚¨æ‰€æœ‰å‘é€ç»™roomJidçš„message\n- ä¸åŒ…å«`private message`\n- useréœ€è¦æƒé™æŸ¥è¯¢ç¾¤å†å²èŠå¤©è®°å½•\n- `forward` stanzaä¸­å¸¦æœ‰`to`å±æ€§,å€¼æ˜¯roomJidï¼Œ`from`å€¼æ˜¯userJid \n- `x`é‡Œæœ‰è¯¥æ¶ˆæ¯çš„å‘é€è€…Jid\n```xml\nExample 17. Server returns MUC messagesÂ¶\n<message id='iasd207' from='coven@chat.shakespeare.lit' to='hag66@shakespeare.lit/pda'>\n  <result xmlns='urn:xmpp:mam:2' queryid='g27' id='34482-21985-73620'>\n    <forwarded xmlns='urn:xmpp:forward:0'>\n      <delay xmlns='urn:xmpp:delay' stamp='2002-10-13T23:58:37Z'/>\n      <message xmlns=\"jabber:client\"\n        from='coven@chat.shakespeare.lit/firstwitch'\n        id='162BEBB1-F6DB-4D9A-9BD8-CFDCC801A0B2'\n        type='groupchat'>\n        <body>Thrice the brinded cat hath mew'd.</body>\n        <x xmlns='http://jabber.org/protocol/muc#user'>\n          <item affiliation='none'\n                jid='witch1@shakespeare.lit'\n                role='participant' />\n        </x>\n      </message>\n    </forwarded>\n  </result>\n</message>\n\n<message id='iasd207' from='coven@chat.shakespeare.lit' to='hag66@shakespeare.lit/pda'>\n  <result xmlns='urn:xmpp:mam:2' queryid='g27' id='34482-21985-73620'>\n    <forwarded xmlns='urn:xmpp:forward:0'>\n      <delay xmlns='urn:xmpp:delay' stamp='2002-10-13T23:58:43Z'/>\n      <message xmlns=\"jabber:client\"\n        from='coven@chat.shakespeare.lit/secondwitch'\n        id='90057840-30FD-4141-AA44-103EEDF218FC'\n        type='groupchat'>\n        <body>Thrice and once the hedge-pig whined.</body>\n        <x xmlns='http://jabber.org/protocol/muc#user'>\n          <item affiliation='none'\n                jid='witch2@shakespeare.lit'\n                role='participant' />\n        </x>\n      </message>\n    </forwarded>\n  </result>\n</message>\n```\n[XEP-0313: Message Archive Management](https://xmpp.org/extensions/xep-0313.html#intro)","tags":["XMPP"],"categories":["XMPP"]},{"title":"XMPP(5): æ¶ˆæ¯","url":"/2019/04/09/XMPP-5-æ¶ˆæ¯/","content":"\n \n## Messageæ¶ˆæ¯ä½“æ„é€ \n\nå±æ€§ï¼š \n1. to ï¼šæ¥æ”¶æ–¹åœ°å€ï¼Œ JID \n2. from ï¼š å‘é€æ–¹ï¼Œ JID\n3. type \n  - chat: ä¸€å¯¹ä¸€èŠå¤©\n  - error: å‡ºé”™\n  - groupchat: ç¾¤èŠ\n  - headline: é€šçŸ¥ã€ä¸´æ—¶æ¶ˆæ¯è¿™ç§ä¸éœ€è¦å›å¤çš„ç³»ç»Ÿæ¶ˆæ¯\n  - normal: ä¹‹å‰æ²¡æœ‰èŠå¤©çš„è®°å½•ï¼Œ å®¢æˆ·ç«¯å¯ä»¥å›å¤çš„æ¶ˆæ¯\n\nå­å…ƒç´ \n1. body: æ¶ˆæ¯å†…å®¹\n\n```xml\n<message\n    from='juliet@example.com/balcony'\n    id='b4vs9km4'\n    to='romeo@example.net'\n    type='chat'\n    xml:lang='en'>\n  <body>Wherefore art thou, Romeo?</body>\n</message>\n\n```\n2. Subject: èŠå¤©çš„è¯é¢˜\n\n```xml\n\n<message\n    from='juliet@example.com/balcony'\n    id='c8xg3nf8'\n    to='romeo@example.net'\n    type='chat'\n    xml:lang='en'>\n  <subject>I implore you!</subject>\n  <body>Wherefore art thou, Romeo?</body>\n</message>\n```\n\n3. Thread: èŠå¤©ä¼šè¯çš„å”¯ä¸€æ ‡è¯†\n\n## Example \n\nå¯¹è¯ï¼š \n\n```xml\nCC: <message\n        from='juliet@example.com/balcony'\n        to='romeo@example.net'\n        type='chat'\n        xml:lang='en'>\n      <body>My ears have not yet drunk a hundred words</body>\n      <thread>e0ffe42b28561960c6b12b944a092794b9683a38</thread>\n    </message>\n\nCC: <message\n        from='juliet@example.com/balcony'\n        to='romeo@example.net'\n        type='chat'\n        xml:lang='en'>\n      <body>Of that tongue's utterance, yet I know the sound:</body>\n      <thread>e0ffe42b28561960c6b12b944a092794b9683a38</thread>\n    </message>\n\nCC: <message\n        from='juliet@example.com/balcony'\n        to='romeo@example.net'\n        type='chat'\n        xml:lang='en'>\n      <body>Art thou not Romeo, and a Montague?</body>\n      <thread>e0ffe42b28561960c6b12b944a092794b9683a38</thread>\n    </message>\n\nUC: <message\n        from='romeo@example.net/orchard'\n        to='juliet@example.com/balcony'\n        type='chat'\n        xml:lang='en'>\n      <body>Neither, fair saint, if either thee dislike.</body>\n      <thread>e0ffe42b28561960c6b12b944a092794b9683a38</thread>\n    </message>\n\nCC: <message\n        from='juliet@example.com/balcony'\n        to='romeo@example.net/orchard'\n        type='chat'\n        xml:lang='en'>\n      <body>How cam'st thou hither, tell me, and wherefore?</body>\n      <thread>e0ffe42b28561960c6b12b944a092794b9683a38</thread>\n    </message>\n\n```\n\nåœ¨[xmpp.js](https://github.com/xmppjs/xmpp.js/)ä¸­ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹äº†WebSocketé•¿é“¾æ¥åï¼Œå‘æ¶ˆæ¯ï¼Œéœ€è¦è‡ªå·±æ„é€ æ¶ˆæ¯ä½“\n\n``` js \nconst {client, xml} = require('@xmpp/client')\n\nconst xmpp = client({\n  service: 'ws://localhost:5280/xmpp-websocket',\n  domain: 'localhost',\n  resource: 'example',\n  username: 'username',\n  password: 'password',\n})\n\n const message = xml(\n    'message',\n    {type: 'chat', to: address},\n    xml('body', 'hello world')\n  )\n  await xmpp.send(message)\n\n```\n\nå¦‚æœæ”¶åˆ°æ¶ˆæ¯ä¼šèµ°åˆ°ä¸€ä¸ªå›è°ƒé‡Œ, chat-sdkå°±å¯ä»¥æ ¹æ®typeå­—æ®µæ¥åˆ†å‘ã€‚\n\n\n```js \nself.xmppClient.on('stanza', function (stanza: any) {\n    Utils.DLog('[Chat] RECV:', stanza.toString());\n    /**\n     * Detect typeof incoming stanza\n     * and fire the Listener\n     */\n    if (stanza.is('presence')) {\n        self._onPresence(stanza);\n    } else if (stanza.is('iq')) {\n        self._onIQ(stanza);\n    } else if (stanza.is('message')) {\n        if (stanza.attrs.type === 'headline') {\n            self._onSystemMessageListener(stanza);\n        } else if (stanza.attrs.type === 'error') {\n            self._onMessageErrorListener(stanza);\n        } else {\n            self._onMessage(stanza);\n        }\n    }\n});\n```\n\n- ref: https://xmpp.org/rfcs/rfc6121.html#message","tags":["XMPP"],"categories":["XMPP"]},{"title":"JWT å…¥é—¨","url":"/2019/04/03/JWT-å…¥é—¨/","content":"\n\n## ä»€ä¹ˆæ˜¯JSON Web Tokens (JWT)ï¼Ÿ \n\n\n```\n  JSON Web Token (JWT) is a compact, URL-safe means of representing\n   claims to be transferred between two parties.  The claims in a JWT\n   are encoded as a JSON object that is used as the payload of a JSON\n   Web Signature (JWS) structure or as the plaintext of a JSON Web\n   Encryption (JWE) structure, enabling the claims to be digitally\n   signed or integrity protected with a Message Authentication Code\n   (MAC) and/or encrypted.\n   \n\n```\n\n## æ€ä¹ˆç”¨ï¼Ÿ \n\nauthenticationæ—¶ï¼Œå½“useræˆåŠŸç™»å½•ï¼Œserverç”Ÿæˆaccess token, å‘é€ç»™userï¼›userè¯·æ±‚serveræ—¶å¸¦ä¸ŠJWTï¼Œserveré€šè¿‡JWTéªŒè¯æ˜¯å¦æ˜¯å¯ä¿¡ä»»çš„å®¢æˆ·ç«¯è¯·æ±‚äº†ã€‚\n\n\n![1*SSXUQJ1dWjiUrDoKaaiGLA.png](https://cdn-images-1.medium.com/max/1600/1*SSXUQJ1dWjiUrDoKaaiGLA.png)\n\n## ç»“æ„\n\nåœ¨å®¢æˆ·ç«¯çœ‹æ¥JWTæ˜¯ä¸€ä¸²encodeåŠ å¯†è¿‡çš„å­—ç¬¦ä¸²,`header.payload.signature`ï¼Œå¦‚ä¸‹å›¾å·¦è¾¹ã€‚ä½†å®ƒdecodeåå…¶å®æ˜¯ä¸‹å›¾å³è¾¹çš„JSONç»“æ„ä½“\n\n![legacy-app-auth-5.png](https://cdn.auth0.com/blog/legacy-app-auth/legacy-app-auth-5.png)\n\n#### 1. ç”Ÿæˆheader\n\ne.g.\n```json\n{\n  \"alg\": \"HS256\",\n  \"typ\": \"JWT\"\n}\n```\n\nè¿™é‡Œï¼Œalgçš„å€¼æŒ‡å®šç”¨HMAC-SHA256ç®—æ³•ç­¾å\n\n#### 2. ç”Ÿæˆpayload\n\nåŒ…å«ç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯\n```\nThe second part of the token is the payload, which contains the claims. \nClaims are statements about an entity (typically, the user) and additional data. \n```\næœ‰ä¸‰ç§[claims](https://tools.ietf.org/html/rfc7519#section-4.1): registered, public, and private claims.\n\ne.g.\n```json\n\n{\n  \"sub\": \"1234567890\",\n  \"name\": \"John Doe\",\n  \"iat\": 1516239022\n}\n```\n\n#### 3.ç”Ÿæˆsignature\n\n```js\n\nHMACSHA256(\n  base64UrlEncode(header) + \".\" +\n  base64UrlEncode(payload),\n  your-256-bit-secret\n) \n```\næŠŠheaderè·Ÿpayload encodeç»“æ„åï¼Œç”¨'.'è¿æ¥ï¼Œç”Ÿæˆ: <span style=\"color:#fb015b\"> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span><span>.</span>\n<span style=\"color:#d63aff\"> eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ</span>\n\nå†ç”¨æŒ‡å®šçš„hashç®—æ³•(ä¾‹å­æ˜¯HS256),ç”¨ç§é’¥ï¼ˆæœåŠ¡ç«¯çš„ï¼‰ç”Ÿæˆç­¾å:<span style=\"color:#00b9f1\">SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c<span>\n\n\n## éªŒè¯\n\nå¦‚å›¾1ï¼Œ JWTç”±Authentication serverç”Ÿæˆï¼Œ åœ¨clientè®¤è¯åå‘ç»™clientï¼› clientè¯·æ±‚application serverçš„æ—¶å€™å¸¦ä¸ŠJWTï¼Œapplication serveråœ¨è®¤è¯é˜¶æ®µä»Authentiation serveré‚£å„¿æ‹¿åˆ°scret keyï¼›ç”¨åŒæ ·ç®—æ³•ç”Ÿæˆsignatureï¼Œ è·Ÿclientå‘æ¥çš„JWTçš„signatureåšæ¯”è¾ƒï¼Œçœ‹æ˜¯å¦matchã€‚\n\n\n\n\n\n\n\n\n\n\n\n\n[5 Easy Steps to Understanding JSON Web Tokens (JWT)](https://medium.com/vandium-software/5-easy-steps-to-understanding-json-web-tokens-jwt-1164c0adfcec)\n[JSON Web Token Introduction - jwt.io](https://jwt.io/introduction/) \n[RFC 7519 - JSON Web Token (JWT)](https://tools.ietf.org/html/rfc7519)","tags":["Auth"],"categories":["NetWork"]},{"title":"XMPP(4):Search å’Œ vCard","url":"/2019/03/31/XMPP-4-Search-vCard/","content":"`jabber:iq:search`åè®®ç”¨æ¥æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯ã€‚\n\n1. æˆ‘ä»¬å…ˆæŸ¥è¯¢å¯ä»¥ç”¨å“ªäº›å­—æ®µæŸ¥æ‰¾ç”¨æˆ·\n<!-- more -->\n\n# XMPP Search \n\n`jabber:iq:search`åè®®ç”¨æ¥æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯ã€‚\n\n1. æˆ‘ä»¬å…ˆæŸ¥è¯¢å¯ä»¥ç”¨å“ªäº›å­—æ®µæŸ¥æ‰¾ç”¨æˆ·\n\n```xml\n// Requesting Search Fields\n\n<iq type='get'\n    from='romeo@montague.net/home'\n    to='characters.shakespeare.lit'\n    id='search1'\n    xml:lang='en'>\n  <query xmlns='jabber:iq:search'/>\n</iq>\n```\n\n2. service è¿”å›\n\n```xml\n// Receiving Search Fields\n<iq type='result'\n    from='characters.shakespeare.lit'\n    to='romeo@montague.net/home'\n    id='search1'\n    xml:lang='en'>\n  <query xmlns='jabber:iq:search'>\n    <instructions>\n      Fill in one or more fields to search\n      for any matching Jabber users.\n    </instructions>\n    <first/>\n    <last/>\n    <nick/>\n    <email/>\n  </query>\n</iq>\n```\n3. æœåŠ¡ç«¯è¿”å›ï¼Œå¯ä»¥ç”¨`first` `last` `nick` `email` è¿™å‡ ä¸ªå­—æ®µæ‰¾äººã€‚æ¥ç€å°±ç”¨lastæŸ¥äºº.\n\n```xml\n// Submitting a Search Request\n\n<iq type='set'\n    from='romeo@montague.net/home'\n    to='characters.shakespeare.lit'\n    id='search2'\n    xml:lang='en'>\n  <query xmlns='jabber:iq:search'>\n    <last>Capulet</last>\n  </query>\n</iq>\n```\n\næœåŠ¡ç«¯å¯ä»¥èƒ½ä¼šè¿”å›å¥½å¤šä¸ªlaståŒ¹é…çš„item\n```xml\n<iq type='result'\n    from='characters.shakespeare.lit'\n    to='romeo@montague.net/home'\n    id='search2'\n    xml:lang='en'>\n  <query xmlns='jabber:iq:search'>\n    <item jid='juliet@capulet.com'>\n      <first>Juliet</first>\n      <last>Capulet</last>\n      <nick>JuliC</nick>\n      <email>juliet@shakespeare.lit</email>\n    </item>\n    <item jid='tybalt@shakespeare.lit'>\n      <first>Tybalt</first>\n      <last>Capulet</last>\n      <nick>ty</nick>\n      <email>tybalt@shakespeare.lit</email>\n    </item>\n  </query>\n</iq>\n```\næ²¡æœ‰ç»“æœçš„è¯ï¼Œqueryå°±æ²¡æœ‰å­å…ƒç´ \n\n```xml\n<iq type='result'\n    from='characters.shakespeare.lit'\n    to='romeo@montague.net/home'\n    id='search2'\n    xml:lang='en'>\n  <query xmlns='jabber:iq:search'/>\n</iq>\n```\n\nXMPP Search \n\n`jabber:iq:search`åè®®ç”¨æ¥æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯ã€‚\n\næˆ‘ä»¬å…ˆæŸ¥è¯¢å¯ä»¥ç”¨å“ªäº›å­—æ®µæŸ¥æ‰¾ç”¨æˆ·\n\n```xml\n// Requesting Search Fields\n\n<iq type='get'\n    from='romeo@montague.net/home'\n    to='characters.shakespeare.lit'\n    id='search1'\n    xml:lang='en'>\n  <query xmlns='jabber:iq:search'/>\n</iq>\n```\n\nservice è¿”å›\n\n```xml\n// Receiving Search Fields\n<iq type='result'\n    from='characters.shakespeare.lit'\n    to='romeo@montague.net/home'\n    id='search1'\n    xml:lang='en'>\n  <query xmlns='jabber:iq:search'>\n    <instructions>\n      Fill in one or more fields to search\n      for any matching Jabber users.\n    </instructions>\n    <first/>\n    <last/>\n    <nick/>\n    <email/>\n  </query>\n</iq>\n```\næœåŠ¡ç«¯è¿”å›ï¼Œå¯ä»¥ç”¨`first` `last` `nick` `email` è¿™å‡ ä¸ªå­—æ®µæ‰¾äººã€‚æ¥ç€å°±ç”¨lastæŸ¥äºº.\n\n```xml\n// Submitting a Search Request\n\n<iq type='set'\n    from='romeo@montague.net/home'\n    to='characters.shakespeare.lit'\n    id='search2'\n    xml:lang='en'>\n  <query xmlns='jabber:iq:search'>\n    <last>Capulet</last>\n  </query>\n</iq>\n```\n\næœåŠ¡ç«¯å¯ä»¥èƒ½ä¼šè¿”å›å¥½å¤šä¸ªlaståŒ¹é…çš„item\n```xml\n<iq type='result'\n    from='characters.shakespeare.lit'\n    to='romeo@montague.net/home'\n    id='search2'\n    xml:lang='en'>\n  <query xmlns='jabber:iq:search'>\n    <item jid='juliet@capulet.com'>\n      <first>Juliet</first>\n      <last>Capulet</last>\n      <nick>JuliC</nick>\n      <email>juliet@shakespeare.lit</email>\n    </item>\n    <item jid='tybalt@shakespeare.lit'>\n      <first>Tybalt</first>\n      <last>Capulet</last>\n      <nick>ty</nick>\n      <email>tybalt@shakespeare.lit</email>\n    </item>\n  </query>\n</iq>\n```\næ²¡æœ‰ç»“æœçš„è¯ï¼Œqueryå°±æ²¡æœ‰å­å…ƒç´ \n\n```xml\n<iq type='result'\n    from='characters.shakespeare.lit'\n    to='romeo@montague.net/home'\n    id='search2'\n    xml:lang='en'>\n  <query xmlns='jabber:iq:search'/>\n</iq>\n```\n\n# vCard \nvCardåè®®ä¸»è¦è´Ÿè´£ç”¨æˆ·ä¿¡æ¯å­˜å‚¨ï¼Œå°±åƒä¸ªäººåç‰‡ã€‚\n\n1. æŸ¥çœ‹è‡ªå·±çš„vCard\nå¦‚æœå®¢æˆ·ç«¯æƒ³æŸ¥è¯¢è‡ªå·±çš„vCard, éœ€è¦å‘é€IQ-set stanzaï¼Œæ³¨æ„æ²¡æœ‰toåœ°å€å“¦ã€‚\n\n```xml\n<iq from='stpeter@jabber.org/roundabout'\n    id='v1'\n    type='get'>\n  <vCard xmlns='vcard-temp'/>\n</iq>\n```\n\n2. è¿”å›ä¿¡æ¯\næ¥ç€æœåŠ¡ç«¯è¿”å›ä¸€å †çš„ç”¨æˆ·ä¿¡æ¯\n\n```xml\n\n<iq id='v1'\n    to='stpeter@jabber.org/roundabout'\n    type='result'>\n  <vCard xmlns='vcard-temp'>\n    <FN>Peter Saint-Andre</FN>\n    <N>\n      <FAMILY>Saint-Andre</FAMILY>\n      <GIVEN>Peter</GIVEN>\n      <MIDDLE/>\n    </N>\n    <NICKNAME>stpeter</NICKNAME>\n    <URL>http://www.xmpp.org/xsf/people/stpeter.shtml</URL>\n    <BDAY>1966-08-06</BDAY>\n    <ORG>\n      <ORGNAME>XMPP Standards Foundation</ORGNAME>\n      <ORGUNIT/>\n    </ORG>\n    <TITLE>Executive Director</TITLE>\n    <ROLE>Patron Saint</ROLE>\n    <TEL><WORK/><VOICE/><NUMBER>303-308-3282</NUMBER></TEL>\n    <TEL><WORK/><FAX/><NUMBER/></TEL>\n    <TEL><WORK/><MSG/><NUMBER/></TEL>\n    <ADR>\n      <WORK/>\n      <EXTADD>Suite 600</EXTADD>\n      <STREET>1899 Wynkoop Street</STREET>\n      <LOCALITY>Denver</LOCALITY>\n      <REGION>CO</REGION>\n      <PCODE>80202</PCODE>\n      <CTRY>USA</CTRY>\n    </ADR>\n    <TEL><HOME/><VOICE/><NUMBER>303-555-1212</NUMBER></TEL>\n    <TEL><HOME/><FAX/><NUMBER/></TEL>\n    <TEL><HOME/><MSG/><NUMBER/></TEL>\n    <ADR>\n      <HOME/>\n      <EXTADD/>\n      <STREET/>\n      <LOCALITY>Denver</LOCALITY>\n      <REGION>CO</REGION>\n      <PCODE>80209</PCODE>\n      <CTRY>USA</CTRY>\n    </ADR>\n    <EMAIL><INTERNET/><PREF/><USERID>stpeter@jabber.org</USERID></EMAIL>\n    <JABBERID>stpeter@jabber.org</JABBERID>\n    <DESC>\n      More information about me is located on my\n      personal website: http://www.saint-andre.com/\n    </DESC>\n  </vCard>\n</iq>\n```\nå¦‚æœæ²¡æœ‰ç›¸å…³vCardï¼Œä¼šè¿”å›error\n```xml\n// item-not-found\n<iq id='v1'\n    to='stpeter@jabber.org/roundabout'\n    type='error'>\n  <vCard xmlns='vcard-temp'/>\n  <error type='cancel'>\n    <item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>\n  </error>\n</iq>\n```\n\n```xml\n// empty element\n<iq id='v1'\n    to='stpeter@jabber.org/roundabout'\n    type='result'>\n  <vCard xmlns='vcard-temp'/>\n</iq>\n\n```\n\n3. æŸ¥çœ‹åˆ«äººçš„vCard\n\nç”¨IQ-get stanza, å¸¦ä¸Štoåœ°å€\n\n```xml \n\n<iq from='stpeter@jabber.org/roundabout'\n    id='v3'\n    to='jer@jabber.org'\n    type='get'>\n  <vCard xmlns='vcard-temp'/>\n</iq>\n```\n\n```xml\n<iq from='jer@jabber.org'\n    to='stpeter@jabber.org/roundabout'\n    type='result'\n    id='v3'>\n  <vCard xmlns='vcard-temp'>\n    <FN>JeremieMiller</FN>\n    <N>\n      <GIVEN>Jeremie</GIVEN>\n      <FAMILY>Miller</FAMILY>\n      <MIDDLE/>\n    </N>\n    <NICKNAME>jer</NICKNAME>\n    <EMAIL><INTERNET/><PREF/><USERID>jeremie@jabber.org</USERID></EMAIL>\n    <JABBERID>jer@jabber.org</JABBERID>\n  </vCard>\n</iq>\n\n```\n\n4. æ›´æ–°vCard\n\nå®¢æˆ·ç«¯å¯ä»¥ç”¨IQ-set stanza æ›´æ–°è‡ªå·±çš„vCardä¿¡æ¯\n\n```xml\n<iq id='v2' type='set'>\n  <vCard xmlns='vcard-temp'>\n    <FN>Peter Saint-Andre</FN>\n    <N>\n      <FAMILY>Saint-Andre</FAMILY>\n      <GIVEN>Peter</GIVEN>\n      <MIDDLE/>\n    </N>\n    <NICKNAME>stpeter</NICKNAME>\n    <URL>http://www.xmpp.org/xsf/people/stpeter.shtml</URL>\n    <BDAY>1966-08-06</BDAY>\n    <ORG>\n      <ORGNAME>XMPP Standards Foundation</ORGNAME>\n      <ORGUNIT/>\n    </ORG>\n    <TITLE>Executive Director</TITLE>\n    <ROLE>Patron Saint</ROLE>\n    <TEL><WORK/><VOICE/><NUMBER>303-308-3282</NUMBER></TEL>\n    <TEL><WORK/><FAX/><NUMBER/></TEL>\n    <TEL><WORK/><MSG/><NUMBER/></TEL>\n    <ADR>\n      <WORK/>\n      <EXTADD>Suite 600</EXTADD>\n      <STREET>1899 Wynkoop Street</STREET>\n      <LOCALITY>Denver</LOCALITY>\n      <REGION>CO</REGION>\n      <PCODE>80202</PCODE>\n      <CTRY>USA</CTRY>\n    </ADR>\n    <TEL><HOME/><VOICE/><NUMBER>303-555-1212</NUMBER></TEL>\n    <TEL><HOME/><FAX/><NUMBER/></TEL>\n    <TEL><HOME/><MSG/><NUMBER/></TEL>\n    <ADR>\n      <HOME/>\n      <EXTADD/>\n      <STREET/>\n      <LOCALITY>Denver</LOCALITY>\n      <REGION>CO</REGION>\n      <PCODE>80209</PCODE>\n      <CTRY>USA</CTRY>\n    </ADR>\n    <EMAIL><INTERNET/><PREF/><USERID>stpeter@jabber.org</USERID></EMAIL>\n    <JABBERID>stpeter@jabber.org</JABBERID>\n    <DESC>\n      Check out my blog at https://stpeter.im/\n    </DESC>\n  </vCard>\n</iq>\n```\n\næœåŠ¡ç«¯è¿”å›ç»“æœ\n\n```xml\n<iq id='v2'\n    to='stpeter@jabber.org/roundabout'\n    type='result'/>\n```\n\nref: https://xmpp.org/extensions/xep-0054.html#intro\nref: https://xmpp.org/extensions/xep-0055.html#intro","tags":["XMPP"],"categories":["XMPP"]},{"title":"å½±å“æ›å…‰çš„3ä¸ªå› ç´ ","url":"/2019/03/31/å½±å“æ›å…‰çš„å‡ ä¸ªå› ç´ /","content":"\n\n\n## è¿›å…‰é‡\n\n`æ›å…‰`ä¹ŸæŒ‡å•ä½é¢ç§¯ä¸Šå…‰å­çš„æ•°é‡ã€‚\n\n- å¦‚æœæˆ‘ä»¬æ²¡æœ‰æ•è·è¶³å¤Ÿçš„å…‰ï¼Œé‚£ä¹ˆç›¸ç‰‡å°±ä¼š`æ¬ æ›`:\n\n<img src=\"/img/15000130641224/15000133443588.jpg\" width = \"368\" height = \"500\" alt=\"å›¾ç‰‡åç§°\" align=center />\n\n\n- å¦‚æœæˆ‘ä»¬æ•è·çš„å…‰å¤ªå¤šï¼Œå›¾åƒå°±ä¼š`è¿‡æ›`:\n\n<img src=\"/img/15000130641224/15000133832576.jpg\" width = \"368\" height = \"500\" alt=\"å›¾ç‰‡åç§°\" align=center />\n\n\n\n## ä¸‰ä¸ªè¦ç´ å¯ä»¥å½±å“æ›å…‰çš„è¿›å…‰é‡\n\n- å¿«é—¨é€Ÿåº¦\n- å…‰åœˆ\n- æ„Ÿå…‰åº¦ (ISO)\n\n![](/img/15000130641224/15006272782478.jpg)\n\næƒ³è±¡ç›¸æœºæ˜¯é»‘æš—æˆ¿é—´ï¼Œæœ‰ä¸ªçª—æˆ·ï¼ˆå…‰åœˆï¼‰ï¼Œ æœ‰å—çª—å¸˜ï¼ˆå¿«é—¨ï¼‰ï¼Œçª—æˆ·è¶Šå¤§è¿›å…‰é‡è¶Šå¤§ï¼Œçª—å¸˜æ‹‰å¼€çš„æ—¶é—´è¶Šä¹…ã€‚ çª—æˆ·å¯¹é¢æœ‰é¢é•œå­ï¼ˆæ„Ÿå®˜å…ƒä»¶ï¼‰ï¼Œæ•è·å…‰å­æˆåƒã€‚\n\n## 1.å¿«é—¨é€Ÿåº¦\nå½“æˆ‘ä»¬æ•æ‰å›¾ç‰‡æ—¶ï¼Œå›¾åƒä¼ æ„Ÿå™¨éœ€è¦æ•æ‰ä¸€æ®µæ—¶é—´çš„å…‰ã€‚ è¿™ä¸ªæ—¶é—´æ®µæ›å…‰æ—¶é—´ï¼ˆä¹Ÿå«å¿«é—¨é€Ÿåº¦ã€‚ç›¸æœºä¸­ä¸€èˆ¬ç”¨`1/400ã€8`è¿™æ ·çš„å½¢å¼è¡¨ç¤ºï¼‰è¿™ä¸ªæ•°å€¼è¶Šå¤§ï¼Œå¿«é—¨å¼€å¯çš„æ—¶é—´è¶Šé•¿ï¼Œè¿›å…¥ç›¸æœºçš„å…‰çº¿å°±è¶Šå¤šï¼Œä½†è¿åŠ¨çš„ç‰©ä½“å¾ˆå¯èƒ½æ¨¡ç³Š.\n\nçœ‹ä¸‹å›¾ï¼š \n\n![](/img/15000130641224/15006271573170.jpg)\n\n\n## 2.æ„Ÿå…‰åº¦ (ISO)\n\nå®ƒè¢«ç”¨æ¥è¡¡é‡å›¾åƒä¼ æ„Ÿå™¨å¯¹å…‰çš„`çµæ•ç¨‹åº¦`ï¼Œä»¥åŠå› æ­¤å¸¦æ¥çš„æ›å…‰å™ªéŸ³ã€‚ISOè¶Šå¤§ï¼Œä¼ æ„Ÿå™¨è¶Šçµæ•ï¼Œæ•è·å…‰èƒ½åŠ›è¶Šå¼ºï¼Œç…§ç‰‡è¶Šäº®ï¼Œä½†å™ªç‚¹ä¹Ÿè¶Šå¤šã€‚\n\n![](/img/15000130641224/15006272197963.jpg)\n\n####å·¦ï¼š ISO 32 å’Œ 1/3 ç§’æ›å…‰\n####å³ï¼š ISO 1600 å’Œ 1/180 ç§’\n![](/img/15000130641224/15000247388896.jpg)\n\n\n**å›¾åƒä¼ æ„Ÿå™¨**\nè¿™ä¸ªéƒ¨åˆ†å°±ç›¸å½“äºæˆ‘ä»¬çœ¼ç›é‡Œçš„è§†ç½‘è†œã€‚å›¾åƒä¼ æ„Ÿå™¨å¯ä»¥å°†å…‰æˆ–è€…å…‰å­è½¬æ¢ä¸ºç”µä¿¡å·ã€‚\n\n**å›¾åƒä¼ æ„Ÿå™¨æ˜¯ç”±æµ·é‡çš„ç‹¬ä¸ªçš„åƒç´ ä¼ æ„Ÿå™¨ä¸²èµ·æ¥çš„å·¨å¤§çŸ©å½¢åŒºåŸŸ** æˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªåƒç´ ä¼ æ„Ÿå™¨æƒ³è±¡æˆä¸€ä¸ªè£…ç”µè·çš„æ¡¶ã€‚å½“å…‰å­æ’å‡»åˆ°åƒç´ ä¼ æ„Ÿå™¨çš„å…‰äºŒæç®¡æ—¶ï¼Œå®ƒä»¬å°†åœ¨è¿™ä¸ªåƒç´ çš„æ¡¶ä¸­ç¼“æ…¢åœ°ç§¯æ”’ç”µè·ã€‚æœ€åï¼Œæ¯ä¸ªåƒç´ éƒ½ä¼šæœ‰å®ƒè‡ªå·±çš„ä¸€å°æ¡¶ç”µå­ã€‚è¿™äº›ç”µè·çš„æ•°é‡æ˜¯ä¾èµ–äºå…‰å­æ•°é‡çš„ -- æˆ–è€…è¯´æ˜¯å†³å®šäºæ‰“åˆ°è¿™ä¸ªç‰¹å®šçš„ç‚¹ä¸Šçš„å…‰çš„å¼ºåº¦ã€‚\n\nå› ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªåƒç´ ä¼ æ„Ÿå™¨çš„äºŒç»´é˜µåˆ—ï¼Œæˆ‘ä»¬ç°åœ¨å°±æ‹¥æœ‰èƒ½å¤Ÿååº”å‡ºæ‰€æœ‰è¿™äº›ä½ç½®çš„å…‰çš„å¼ºåº¦çš„ä¸€ç»„äºŒç»´ç”µè·é˜µåˆ—äº†ã€‚**åœ¨ iPhone 6 ä¸Šï¼Œæˆ‘ä»¬æœ‰å…«ç™¾ä¸‡ä¸ªè¿™æ ·çš„å¾®å°çš„åƒç´ ä¼ æ„Ÿå™¨**ï¼Œä»¥åŠå®ƒä»¬æ‰€å¯¹åº”çš„ç”µè·æ¡¶ã€‚\n\n\n## 3.å…‰åœˆ\n\nç›¸æœºçš„é•œå¤´çš„å…‰åœˆ(Aperture)æ˜¯ç”¨æ¥è¡¡é‡åˆ°è¾¾å›¾åƒæ„Ÿåº”å™¨çš„å…‰æ‰€é€šè¿‡çš„`é€šå­”çš„å¤§å°`çš„\n\n\n#### æ›å…‰å€¼\n\næ›å…‰å€¼ï¼ˆExposure Valueï¼ŒEVï¼‰ä»£è¡¨èƒ½å¤Ÿç»™å‡ºåŒæ ·æ›å…‰çš„æ‰€æœ‰ç›¸æœºå…‰åœˆå¿«é—¨ç»„åˆ\n\n![](/img/15000130641224/15026013567638.jpg)\nå…¶ä¸­Næ˜¯å…‰åœˆï¼ˆfå€¼ï¼‰ï¼›tæ˜¯æ›å…‰æ—¶é—´ï¼ˆå¿«é—¨ï¼‰ï¼Œå•ä½ç§’ã€‚æ›å…‰å€¼0ï¼ˆEV0ï¼‰å¯¹åº”äºæ›å…‰æ—¶é—´ä¸º1ç§’è€Œå…‰åœˆä¸ºf/1.0çš„ç»„åˆæˆ–å…¶ç­‰æ•ˆç»„åˆã€‚\n\n`æ›å…‰å€¼ != æ›å…‰é‡`\n\n####æ›å…‰é‡ï¼ˆphotometric exposureï¼‰\n\n![](/img/15000130641224/15026015278605.jpg)\nå…¶ä¸­  Hæ˜¯æ›å…‰é‡ï¼Œ Eæ˜¯å½±åƒå¹³é¢çš„ç…§åº¦ï¼Œè€Œ  tæ˜¯æ›å…‰æ—¶é—´ã€‚ç…§åº¦ Eç”±få€¼æ‰€æ§åˆ¶ï¼Œä½†ä¹Ÿå–å†³äºç¯å¢ƒäº®åº¦ã€‚\n\n## å…‰åœˆä¸æ™¯æ·±\n\n##### æ™¯æ·±\n\n![](/img/15000130641224/15026018990936.jpg)\n\n![](/img/15000130641224/15026016717518.jpg)\n\n![](/img/15000130641224/15026016975426.jpg)\n\nå…‰åœˆç³»æ•°= `é•œå¤´ç„¦è·/å…‰åœˆå­”å¾„`ï¼›å¸¸ç”¨çš„é•œå¤´çš„å…‰åœˆæ•°åºåˆ—ä¸º\n`1ï¼Œ 1.4ï¼Œ 2ï¼Œ 2.8ï¼Œ 4ï¼Œ 5.6ï¼Œ 8ï¼Œ 11ï¼Œ 16ï¼Œ 22ï¼Œ 32ï¼Œ 45ï¼Œ 64ï¼Œ90ï¼Œ128`\n\n\n\n\n","tags":["CV"]},{"title":"XMPP(3):Roster&è”ç³»äºº","url":"/2019/03/31/Roster-è”ç³»äºº/","content":"\n\n\n\nXMPPä¸­è”ç³»äººæ¨¡å—åè®®æ˜¯`jabber:iq:roster`. Rosterç›´æ¥ç¿»è¯‘å«èŠ±åå†Œï¼Œå…¶å®å®ƒå°±æ˜¯è”ç³»äººåˆ—è¡¨å•¦ã€‚\n\n## å®¢æˆ·ç«¯è·å–è”ç³»äººåˆ—è¡¨\n\næ¯”è¾ƒç®€å•ï¼Œå‘é€IQ stanzaç»™server. xmlns=`jabber:iq:roster`;type='get'\n\n```xml\n\n<iq from='user@server.com/balcony'\n       id='bv1bs71f'\n       type='get'>\n    <query xmlns='jabber:iq:roster'/>\n  </iq>\n\n```\nè¿”å›ç»“æœçš„itemä¸­æœ‰è”ç³»äººJid\n\n```xml\n<iq id='bv1bs71f'\n       to='user@server.com/balcony'\n       type='result'>\n    <query xmlns='jabber:iq:roster' ver='ver7'>\n      <item jid='contact1@server.com'/>\n      <item jid='contact2@server.com'/>\n    </query>\n  </iq>\n\n```\n\n## æ·»åŠ è”ç³»äºº(åŠ å¥½å‹ï¼‰çš„æµç¨‹ \n\næ–¹æ³•æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§ç”¨IQ set, è§[rfc6121](https://xmpp.org/rfcs/rfc6121.html#roster-add).\n\n1. å®¢æˆ·ç«¯è¯·æ±‚æ·»åŠ è”ç³»äºº\n\nxmlnsç”¨`jabber:iq:roster`; å¸¦ä¸Šæƒ³æ·»åŠ çš„ç”¨æˆ·jid. nameå¯ä»¥ä¸å¸¦; `group`åˆ†ç»„ç”¨ã€‚\n\n\n```xml\n<iq from='user@server.com/balcony' type='set' id='roster_2'>\n  <query xmlns='jabber:iq:roster'>\n    <item jid='contact@server.com'\n          name='contact'>\n      <group>Servants</group>\n    </item>\n  </query>\n</iq>\n```\n\n2.1. serveré€šçŸ¥åŒä¸€ä¸ªè´¦æˆ·å…³è”çš„æ‰€æœ‰å®¢æˆ·ç«¯: è”ç³»äººåˆ—è¡¨æ›´æ–°äº†ã€‚\n\n```xml\n\n<iq to='user@server.com/balcony'\n    type='set'\n    id='a78b4q6ha463'>\n  <query xmlns='jabber:iq:roster'>\n    <item jid='contact@server.com'\n          name='contact'\n          subscription='none'>\n      <group>Servants</group>\n    </item>\n  </query>\n</iq>\n\n<iq to='user@server.com/chamber'\n    type='set'\n    id='a78b4q6ha464'>\n  <query xmlns='jabber:iq:roster'>\n    <item jid='contact@server.com'\n          name='contact'\n          subscription='none'>\n      <group>Servants</group>\n    </item>\n  </query>\n</iq>\n```\n\nserverå›å¤IQ stanzaç»™è¯·æ±‚æ·»åŠ è”ç³»äººçš„å®¢æˆ·ç«¯balcony\n```xml\n<iq to='user@server.com/balcony' type='result' id='roster_2'/>\n```\n\n\n##  åˆ é™¤è”ç³»äºº\n\nç»™serverå‘é€ä¸ªIQ setï¼Œ subscriptionä¸€å®šæ˜¯'remove'.\n\n```xml\n\n<iq from='user@server.com/balcony' type='set' id='roster_4'>\n  <query xmlns='jabber:iq:roster'>\n    <item jid='contact@server.com' subscription='remove'/>\n  </query>\n</iq>\n\n```\n\n## Presence\n\nå¢åˆ è”ç³»äººçš„å¦ä¸€ç§æ–¹æ³•æ˜¯Presenceè®¢é˜…æœºåˆ¶.Presence stanzaå…¶å®æœ‰ä¸¤ç§åŠŸèƒ½ï¼š\n- å¹¿æ’­online/offlineçŠ¶æ€, [ä¹‹å‰æ–‡ç« ](https://suelan.github.io/2019/03/26/XMPP-Overview/#The-Presence-Stanza)æè¿‡\n- æ§åˆ¶è”ç³»äººè®¢é˜…. å°±æ˜¯å¢åˆ å¥½å‹åŠŸèƒ½å’¯\n\næˆ‘ä»¬ç”¨typeæ¥åŒºåˆ†è¿™ä¸¤ç§åŠŸèƒ½ã€‚typeæ˜¯`available| unavailable`ï¼Œ presence stanzaè¡¨è¾¾online/offlineçŠ¶æ€ã€‚typeè‹¥æ˜¯`subscribe | subscribed | unsubscribe| unsubscribed`ï¼Œå°±è·Ÿè”ç³»äººæœ‰å…³å•¦ã€‚\n\n\nsubscribtionæœ‰å››ç§çŠ¶æ€ï¼š\n- NONE :  \n- TO  :  userè®¢é˜…contactçš„çŠ¶æ€\n- FROM : contactè¢«userè®¢é˜…\n- BOTH : userè·Ÿcontactç›¸äº’subcribe\n\n![flow](https://www.blikoontech.com/wp-content/uploads/2018/03/XMPP_Subscription_Flow.png)\n\nå¦‚ä¸Šå›¾ï¼šä¸€å¼€å§‹userè·Ÿcontactæ²¡å•¥å…³ç³»ï¼ŒsubscriptionçŠ¶æ€éƒ½æ˜¯noneã€‚ æ¥ç€userå‘é€äº†ä¸€æ¡Presence stanzaç»™contactï¼Œæƒ³subscribeä»–çš„çŠ¶æ€ã€‚å¦‚ä¸‹ï¼š\n```xml\n// from user\n<presence to='contact@server.com' type='subscribe'/>\n```\nç°åœ¨userç”¨`jabber:iq:roster` æŸ¥è¯¢æ‰€æœ‰è”ç³»äººçš„æ—¶å€™ï¼Œä¼šå‘ç°itemå¤šäº†ä¸€æ¡, contactè¿˜æ²¡ç¡®è®¤, æ‰€ä»¥ ask='subscribe', subscribtion='none'\n\n```xml\n// user's roster\n<item ask='subscribe' subscription='none' jid='contact@server.com'/>\n```\nserverè¦å°†æ¶ˆæ¯è½¬å‘ç»™contactå®¢æˆ·ç«¯, contactç™»å½•æ—¶ï¼Œä¼šæ”¶åˆ°ä¸€æ¡æ¥è‡ªuserçš„presence stanza; typeæ˜¯'subscribe'ã€‚ æˆ‘ä»¬å¯ä»¥ç”¨è¿™æ¡æ¶ˆæ¯æ¥åšâ€œæ”¶åˆ°æ¥è‡ªuseræ·»åŠ å¥½å‹çš„è¯·æ±‚â€è¿™æ ·çš„åŠŸèƒ½\n```xml\n<presence from='user@server.com' to='contact@server.com' type='subscribe' xmlns='jabber:client'></presence>\n```\n\nåŒæ—¶contact/devè®¾å¤‡ä¼šæ”¶åˆ°Rosteræ›´æ–°çš„ä¿¡æ¯. \n```xml\n<iq  from='contact@server.com' to='contact@server.com/dev' id='13a99ca5' type='result' xmlns='jabber:client'>\n    <query  xmlns='jabber:iq:roster'>\n         <item  ask='subscribe' subscription='none' jid='user@server.com'/>\n       </query>\n</iq>\n```\n#### æ¥å—è¯·æ±‚\nå¦‚æœcontactæ¥å—è¯·æ±‚ï¼Œä»–è¦å‘é€ä¸€æ¡presenceç»™user. typeå€¼æ˜¯'subscribed'\n\n```xml\n<presence to='user@server.com' type='subscribed'/>\n```\n\nuserè¿™è¾¹çš„rosterä¼šæ›´æ–°\n```xml\n// user's roster\n<item subscription='to' jid='contact@server.com'/>\n```\nè¿™æ—¶åœ¨contactçš„rosteråˆ—è¡¨é‡Œï¼Œuserçš„subscriptionæ˜¯fromã€‚ ```xml\n// contact's roster\n<item ask='subscribe' subscription='from' jid='user@server.com'/>\n```\n\næ¥ç€contactä¹Ÿè¯·æ±‚è®¢é˜…user \n\n```xml\n<iq from='user@server.com/balcony' type='set' id='roster_2'>\n  <query xmlns='jabber:iq:roster'>\n    <item jid='contact@server.com'\n          name='contact'>\n      <group>Servants</group>\n    </item>\n  </query>\n</iq>\n```\n\nContactåŒæ ·æµç¨‹åï¼Œä»–ä¸¤çš„subscriptionéƒ½å˜æˆäº†bothã€‚\n\n#### æ‹’ç»\nå¦‚æœcontactæƒ³æ‹’ç»userçš„è¯·æ±‚ï¼Œä¹Ÿæ˜¯å‘é€presence \n```xml\n<presence to='user@server.com' type='unsubscribed'/>\n```\nå¦‚æœuseræƒ³å–æ¶ˆå¯¹contactçš„è®¢é˜…, å‘é€presence stanzaï¼Œtype æ˜¯unsubscribed\n```xml\n<presence to='contact@server.com' type='unsubscribed'/>\n```\n\n\nref: https://xmpp.org/rfcs/rfc3921.html#roster","tags":["XMPP"],"categories":["XMPP"]},{"title":"XMPP(2):æ³¨å†Œè´¦æˆ·","url":"/2019/03/29/XMPP-2-æ³¨å†Œè´¦æˆ·/","content":"\n\n\n## XMPPæ³¨å†Œæµç¨‹\n\n\n#### 1. clientå‘é€æ¶ˆæ¯ä½“, å»æœåŠ¡ç«¯æŸ¥è¯¢æ³¨å†Œéœ€è¦çš„å­—æ®µ\n\n\n```xml\n<iq type='get' id='reg1' to='localhost'>\n  <query xmlns='jabber:iq:register'/>\n</iq>\n```\n\nxmlnsæ˜¯ `jabber:iq:register`, typeæ˜¯`get`\n\n#### 2.1. æœªæ³¨å†Œï¼šè¿”å›æ³¨å†Œéœ€è¦çš„å­—æ®µ\n\n```xml\n<iq type='result' id='reg1'>\n  <query xmlns='jabber:iq:register'>\n    <instructions>\n      Choose a username and password for use with this service.\n      Please also provide your email address.\n    </instructions>\n    <username/>\n    <password/>\n    <email/>\n  </query>\n</iq>\n```\n\n`<instructions/>` elementï¼šSHOULD contain an <instructions/> element (whose XML character data MAY be modified to reflect the fact that the entity is currently registered)\n\n#### 2.2. å·²æ³¨å†Œï¼šæœåŠ¡ç«¯çš„è¿”å›ç»“æœ\n\n```xml\n<iq  xmlns='jabber:client' xml:lang='en' to='olivia@localhost/180244803852118156522754' from='localhost' type='result' id='reg1'>\n    <query  xmlns='jabber:iq:register'>\n        <username>olivia</username>\n        <registered/>\n        <password/>\n        <instructions>Choose a username and password to register with this server</instructions>\n    </query>\n</iq>\n```\n\nhostä¼šæ ¹æ®\"from\"çš„åœ°å€åˆ¤æ–­entityæ˜¯å¦å·²ç»æ³¨å†Œäº†ï¼ŒIQ resultæ¶ˆæ¯æœ‰ä¸€ä¸ªç©ºçš„`<registered/>`ï¼Œ æ ‡ç¤ºè¯¥entiryå·²ç»æ³¨å†Œè¿‡äº†ã€‚\n\n#### 3.client æ³¨å†Œ \n\niq stanzaçš„typeæ˜¯`set`, xmlns`jabber:iq:register`\n\n```xml\n<iq type='set' id='reg2'>\n  <query xmlns='jabber:iq:register'>\n    <username>bill</username>\n    <password>Calliope</password>\n    <email>bard@shakespeare.lit</email>\n  </query>\n</iq>\n```\n\n#### 4.1 æ³¨å†ŒæˆåŠŸ \n\n```xml\n<iq type='result' id='reg2'/>\n\n```\n\n#### 4.2 æ³¨å†Œå¤±è´¥ï¼Œå‘½åå†²çª\n\n```xml\n<iq type='error' id='reg2'>\n  <query xmlns='jabber:iq:register'>\n    <username>bill</username>\n    <password>m1cro$oft</password>\n    <email>billg@bigcompany.com</email>\n  </query>\n  <error code='409' type='cancel'>\n    <conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>\n  </error>\n</iq>\n```\n\n#### 4.3 æ¶ˆæ¯ä¸å…¨ ` <not-acceptable/> `\n\n```xml\n<iq type='error' id='reg2'>\n  <query xmlns='jabber:iq:register'>\n    <username>bill</username>\n    <password>Calliope</password>\n  </query>\n  <error code='406' type='modify'>\n    <not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>\n  </error>\n</iq>\n```\n\n#### 4.4 æœåŠ¡ç«¯è®¿é—®æƒé™é—®é¢˜\n\n```xml\n<iq  xmlns='jabber:client' xml:lang='en' to='olivia@localhost/180244803852118156522754' from='olivia@localhost' type='error' id='reg2'>\n    <query  xmlns='jabber:iq:register'>\n        <email>bard@shakespeare.lit</email>\n        <username>bill</username>\n        <password>Calliope</password>\n    </query>\n    <error  code='403' type='auth'>\n        <forbidden  xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>\n        <text  xmlns='urn:ietf:params:xml:ns:xmpp-stanzas' xml:lang='en'>Access denied by service policy</text>\n    </error>\n</iq>\n```\n\n#### 5.å¦‚æœç”¨ç¬¬ä¸‰æ–¹æ³¨å†Œçš„æ–¹å¼ï¼Œå¯èƒ½éœ€è¦è¡¥å……ä¸€äº›é¢å¤–çš„ä¿¡æ¯\n\nå®¢æˆ·ç«¯æŸ¥è¯¢\n\n```xml\n<iq type='get'\n    from='juliet@capulet.com/balcony'\n    to='contests.shakespeare.lit'\n    id='reg3'>\n  <query xmlns='jabber:iq:register'/>\n</iq>\n```\n\n#### 6.æœåŠ¡ç«¯è¿”å›æ¶ˆæ¯ï¼Œ æç¤ºéœ€è¦æä¾›çš„ä¿¡æ¯\n\n```xml\n<iq type='result'\n    from='contests.shakespeare.lit'\n    to='juliet@capulet.com/balcony'\n    id='reg3'>\n  <query xmlns='jabber:iq:register'>\n    <instructions>\n      Use the enclosed form to register. If your Jabber client does not\n      support Data Forms, visit http://www.shakespeare.lit/contests.php\n    </instructions>\n    <x xmlns='jabber:x:data' type='form'>\n      <title>Contest Registration</title>\n      <instructions>\n        Please provide the following information\n        to sign up for our special contests!\n      </instructions>\n      <field type='hidden' var='FORM_TYPE'>\n        <value>jabber:iq:register</value>\n      </field>\n      <field type='text-single' label='Given Name' var='first'>\n        <required/>\n      </field>\n      <field type='text-single' label='Family Name' var='last'>\n        <required/>\n      </field>\n      <field type='text-single' label='Email Address' var='email'>\n        <required/>\n      </field>\n      <field type='list-single' label='Gender' var='x-gender'>\n        <option label='Male'><value>M</value></option>\n        <option label='Female'><value>F</value></option>\n      </field>\n    </x>\n  </query>\n</iq>\n```\n\n#### 7.å®¢æˆ·ç«¯æä¾›ä¿¡æ¯\n\n```xml\n<iq type='set'\n    from='juliet@capulet.com/balcony'\n    to='contests.shakespeare.lit'\n    id='reg4'>\n  <query xmlns='jabber:iq:register'>\n    <x xmlns='jabber:x:data' type='submit'>\n      <field type='hidden' var='FORM_TYPE'>\n        <value>jabber:iq:register</value>\n      </field>\n      <field type='text-single' label='Given Name' var='first'>\n        <value>Juliet</value>\n      </field>\n      <field type='text-single' label='Family Name' var='last'>\n        <value>Capulet</value>\n      </field>\n      <field type='text-single' label='Email Address' var='email'>\n        <value>juliet@capulet.com</value>\n      </field>\n      <field type='list-single' label='Gender' var='x-gender'>\n        <value>F</value>\n      </field>\n    </x>\n  </query>\n</iq>\n```\n\n## Cancellation of Existing Registration\n\n#### 1. cilent req: \n```xml\n<iq type='set' from='bill@shakespeare.lit/globe' id='unreg1'>\n  <query xmlns='jabber:iq:register'>\n    <remove/>\n  </query>\n</iq>\n```\nè·Ÿæ³¨å†Œä¸åŒçš„æ˜¯ `query` çš„childå¤šäº†ä¸ª`<remove/>`\n\n#### 2.1. æˆåŠŸæ³¨é”€,server response: \n  \n```xml\n\n<iq type='result' to='bill@shakespeare.lit/globe' id='unreg1'/>\n\n```\n\n#### 2.2.Error Case  \n\n|Condition | Description  |\n| --- | --- |\n| ``<bad-request/>``|\tThe <remove/> element was not the only child element of the <query/> element.|\n|``<forbidden/>``\t| æƒé™ä¸å¤Ÿ|\n|``<not-allowed/>``\t|ä¸å…è®¸ç”¨æˆ·æ³¨é”€è´¦æˆ·|\n|``<registration-required/>``|è¦æ³¨é”€çš„è´¦æˆ·æœ¬æ¥å°±ä¸å­˜åœ¨|\n|``<unexpected-request/>``\t| The host is an instant messaging server and the IQ get does not contain a 'from' address because the entity is not registered with the server.|\n\n## ç”¨æˆ·ä¿®æ”¹å¯†ç \n\n#### 1. Client:\n```xml\n<iq type='set' to='shakespeare.lit' id='change1'>\n  <query xmlns='jabber:iq:register'>\n    <username>bill</username>\n    <password>newpass</password>\n  </query>\n</iq>\n\n```\n\nè¿™é‡Œçš„å¯†ç æ˜¯æ˜æ–‡ï¼Œ è¦ç•™æ„å®¢æˆ·ç«¯æœåŠ¡ç«¯é€šä¿¡æ˜¯å¦ç”¨SSLæˆ–è€…TLSåŠ å¯†ï¼Œè€Œä¸”æœåŠ¡ç«¯è¯ä¹¦å¯ä¿¡ã€‚\n\n#### 2.1. æˆåŠŸ, Server: \n\n```xml\n<iq type='result' id='change1'/>\n\n```\n\n\n#### 2.2. å¤±è´¥ Case \n\n\n|Condition | Description  |\n| --- | --- |\n| ``<bad-request/>``| requestè¯·æ±‚ä½“æ‹¼å†™æœ‰é—®é¢˜ï¼Œæ¯”å¦‚æ²¡å¸¦username |\n|``<not-authorized/>`` | æ²¡é€šè¿‡serverçš„å®‰å…¨éªŒè¯ |\n|``<not-allowed/>`` |\tserver ä¸å…è®¸|\n|``<unexpected-request/>`` | The host is an instant messaging server and the IQ set does not contain a 'from' address because the entity is not registered with the server. |\n\næ¯”å¦‚ï¼š\n```xml\n// Bad  request\n<iq type='error' from='shakespeare.lit' to='bill@shakespeare.lit/globe' id='change1'>\n  <error code='400' type='modify'>\n    <bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>\n  </error>\n</iq>\n\n// Not Authorized\n<iq type='error' from='shakespeare.lit' to='bill@shakespeare.lit/globe' id='change1'>\n  <error code='401' type='modify'>\n    <not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>\n  </error>\n</iq>\n\n// Not Allowed\n<iq type='error' from='shakespeare.lit' to='bill@shakespeare.lit/globe' id='change1'>\n  <error code='405' type='cancel'>\n    <not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>\n  </error>\n</iq>\n```\n\næœ‰æ—¶å€™ï¼ŒæœåŠ¡ç«¯éœ€è¦æ›´å¤šçš„ä¿¡æ¯æ¥æ”¹å¯†ç ï¼Œè¿™æ—¶å€™å®ƒä¼šè¿”å›ä¿¡æ¯æç¤ºå®¢æˆ·ç«¯\n\n```xml\n<iq type='error' from='shakespeare.lit' to='bill@shakespeare.lit/globe' id='change1'>\n  <query xmlns='jabber:iq:register'>\n    <x xmlns='jabber:x:data' type='form'>\n      <title>Password Change</title>\n      <instructions>Use this form to change your password.</instructions>\n      <field type='hidden' var='FORM_TYPE'>\n        <value>jabber:iq:register:changepassword</value>\n      </field>\n      <field type='text-single' label='Username' var='username'>\n        <required/>\n      </field>\n      <field type='text-private' label='Old Password' var='old_password'>\n        <required/>\n      </field>\n      <field type='text-private' label='New Password' var='password'>\n        <required/>\n      </field>\n      <field type='text-single' label='Mother&apos;s Maiden Name' var='x-mmn'>\n        <required/>\n      </field>\n    </x>\n  </query>\n  <error code='401' type='modify'>\n    <not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>\n  </error>\n</iq>\n\n```\n\nç„¶åå®¢æˆ·ç«¯è¿”å›ç›¸å…³ä¿¡æ¯\n\n```xml\n<iq type='set' from='bill@shakespeare.lit/globe' to='shakespeare.lit' id='change2'>\n  <query xmlns='jabber:iq:register'>\n    <x xmlns='jabber:x:data' type='submit'>\n      <field type='hidden' var='FORM_TYPE'>\n        <value>jabber:iq:register:changepassword</value>\n      </field>\n      <field type='text-single' var='username'>\n        <value>bill@shakespeare.lit</value>\n      </field>\n      <field type='text-private' var='old_password'>\n        <value>theglobe</value>\n      </field>\n      <field type='text-private' var='password'>\n        <value>groundlings</value>\n      </field>\n      <field type='text-single' var='x-mmn'>\n        <value>Throckmorton</value>\n      </field>\n    </x>\n  </query>\n</iq>\n```\n\nref: [XEP-0077: In-Band Registration](https://xmpp.org/extensions/xep-0077.html#usecases)\n","tags":["XMPP"],"categories":["XMPP"]},{"title":"XMPP Overview","url":"/2019/03/26/XMPP-Overview/","content":"\n\n\nè·Ÿæœ‹å‹åšä¸€ä¸ªé¡¹ç›®ï¼Œæƒ³å¿«é€Ÿå¼€å‘ï¼Œé€‰äº†XMPPåè®®ã€‚å®ƒæ˜¯ä¸€å¥—é€šä¿¡åè®®ã€‚åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œ[XMPP Core Services](https://xmpp.org/rfcs/rfc6121.html#A%20Sample%20Session) å’Œ XMPP Extension Protocols. æ ¸å¿ƒç”±åŸºç¡€featureç»„æˆï¼Œæ‰©å±•åè®®å°±éå¸¸ä¸°å¯Œï¼Œè€Œä¸”ä¸€ç›´åœ¨å‘å±•ã€‚Wikiä¸Šæœ‰å¼ å„ç§IMåè®®çš„æ±‡æ€»è¡¨ï¼Œæ¨èï¼\n\n- [Comparison of instant messaging protocols - Wikipedia](https://en.wikipedia.org/wiki/Comparison_of_instant_messaging_protocols)\n\n\n## XMPP Addressing \n\nè¿™æ˜¯ä¸€å¼ Client-Serverçš„å›¾ï¼Œå›¾é‡Œçš„serverã€clientéƒ½éµå¾ªXMPPåè®®ã€‚å« XMPP entity. å®ƒä»¬æœ‰å„è‡ªå”¯ä¸€çš„Address, æ ¼å¼å¦‚'username@server.com', å« JID (Jaber ID)\n [RFC 7622 - Extensible Messaging and Presence Protocol (XMPP): Address Format](https://datatracker.ietf.org/doc/rfc7622/)\n \n ![28a215f7.png](/img/32c16f22-9862-45e8-b15f-1b1eceb7b30f/28a215f7.png)\n \nå…¶ä¸­resourceæ˜¯æ‹¿æ¥åšåŒä¸€è´¦å·å¤šå®¢æˆ·ç«¯æ ‡è®°çš„ï¼Œ æ¯”å¦‚å›¾ä¸­`User1` ä» pc ,phone1 å’Œ phone2ç™»å½•åŒä¸€è´¦å·ï¼Œresourceåˆ†åˆ«æ˜¯ `pc`, `iphone1`,`iphone2`\n \n \n ## XMPP Client- Server Streams\n \n å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šè¿‡é•¿é“¾æ¥æ–¹å¼é€šä¿¡ï¼Œç°åœ¨å¤šç”¨WebSocketã€‚å½“å®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯æ¡æ‰‹æˆåŠŸï¼Œå®ƒä»¬å¼€å§‹ç”¨ XML streamé€šä¿¡ã€‚\n \n ![f1565a2e.png](/img/32c16f22-9862-45e8-b15f-1b1eceb7b30f/f1565a2e.png)\\\n\n \nXML stream æ€»æ˜¯ä»¥  ``<stream>`` å¼€å¤´ï¼Œ ``</stream>`` tagç»“å°¾ã€‚æ˜¯xmlæ¶ˆæ¯çš„å®¹å™¨ã€‚\n\n```\nAn XML stream is a container for the exchange of XML elements between any two entities over a network. \nDuring the life of the stream, the entity that initiated it can send an unbounded number of XML elements over the stream, either elements used to negotiate the stream (e.g., to complete TLS negotiation or SASL negotiation) or XML stanzas. \n```\n\nä¸‹é¢æ˜¯clientè·Ÿserverçš„ä¸€æ¬¡æ¶ˆæ¯äº¤äº’ï¼Œ ç»¿è‰²æ¥è‡ªclientçš„ï¼Œé»‘è‰²æ¶ˆæ¯æ¥è‡ªserver\n\n \n  ![f97e583b.png](/img/32c16f22-9862-45e8-b15f-1b1eceb7b30f/65d38868.png)\n\n ### XML stanza\n An XML stanza is the basic unit of meaning in XMPP. A stanza is a first-level element (at depth=1 of the stream) whose element name is \"message\", \"presence\", or \"iq\" and whose qualifying namespace is 'jabber:client' or 'jabber:server'. \n \n \n ### XMPP Communication Primitives\n\nA `stanza` is the smallest piece of XML data a client can send to a server ( server send to client) in one package.\n\nxmppä¸­ï¼ŒæœåŠ¡ç«¯ã€å®¢æˆ·æ•°æ®äº¤æ¢æ—¶ï¼Œæœ€å°XMLæ•°æ®å•ä½ å« stanzaã€‚å¦‚ä¸Šå›¾ï¼Œç»¿è‰²çš„å°±æ˜¯ä¸€ä¸ªstanzaï¼Œé»‘è‰²çš„ä¹Ÿæ˜¯ä¸€ä¸ªstanzaã€‚Stanzaæœ‰å‡ ç§ç±»å‹: `message`, `iq`, `presence`ã€‚ \n\n#### The Message Stanza\n\nThe <message/> stanza is meant to be used to send data between XMPP entities.\n\n![6fe8a15e.png](/img/32c16f22-9862-45e8-b15f-1b1eceb7b30f/6fe8a15e.png)\n\n - fromï¼šå‘é€æ–¹\n - toï¼š æ¥æ”¶æ–¹\n - body: æ¶ˆæ¯å†…å®¹\n - type æœ‰å‡ ç§ç±»å‹:\n     -`<message type=â€chatâ€/>` ( chat message stanza) \n     - `< message type=â€groupchatâ€/>` ( groupchat message stanza)\n     - `< message type=â€errorâ€/>` (error message stanza)\n\n#### The Presence Stanza\n\nç”¨æ¥è¡¨ç¤ºåœ¨çº¿çŠ¶æ€çš„\n \n\n![0fbe995b.png](/img/32c16f22-9862-45e8-b15f-1b1eceb7b30f/0fbe995b.png)\n\n`show` æ ‡ç­¾é‡Œå¯èƒ½ä¼šæœ‰çš„å‡ ç§çŠ¶æ€: \n`chat` : online and available for chat ; \n`away` : æš‚æ—¶ç¦»å¼€\n`xa` : é•¿æ—¶é—´ç¦»å¼€\n`dnd`: è¯·å‹¿æ‰“æ‰°\n\nå¦‚æœä½ æƒ³çŸ¥é“åˆ«çš„çŠ¶æ€ï¼Œéœ€è¦å…ˆå‘æ¶ˆæ¯ç»™Serverï¼Œsubscribeåˆ«äººã€‚ \n\n\n#### The IQ stanza\n \n The IQ( Info/Query) stanza is used to get some information from the server ( info about the server or its registered clients) or to apply some settings to the server.\n \n ç”¨æ¥è·å–æ¶ˆæ¯ï¼Œæˆ–è€…è¯·æ±‚è®¾ç½®\n  \nTypeå±æ€§ä¸­çš„ç±»å‹ :get ,set ,result or error. \n- `< iq type=â€getâ€/>` stanzas are used to get(ask) some information ( from the server). \n- `<iq type=â€setâ€/>` stanzas are used to apply some settings to the server.When you send get/set IQ stanzas to the server ,\n- it can reply either with an `< iq type=â€resultâ€/>` stanza when your request has been successfully processed by the server or \n- `<iq type=â€errorâ€/>` stanza when something has gone wrong with your request.The figure below shows an IQ stanza that we send to the server and the reply we get from the server.\n\n\n![30c96f66.png](/img/32c16f22-9862-45e8-b15f-1b1eceb7b30f/30c96f66.png)\n\n\nThe client sends an IQ get stanza to the server to request its contact list.We know it is asking for the contact list because of the `jabber:iq:roster` XML namespace.\n\nThe XMPP engine in the server is programmed to know that when a client sends `jabber:iq:roster` namespaced IQ ,it wants to retrieve its contact list.There are other `namespaces` in XMPP for other uses and you will surely come accross them in your XMPPing journey.\n\nThe server responds with a list of the JIDâ€™s contacts wraped within a `jabber:iq:roster` namespaced `<query/>`tag.\n\n\n## æœ¬åœ°æ­å»º Server \n\næˆ‘æ­çš„æ˜¯ejabberd. å®˜æ–¹å®‰è£…æ•™ç¨‹: [Installing ejabberd \\| ejabberd Docs](https://docs.ejabberd.im/admin/installation/#install-on-macos)\n\n#### å¯åŠ¨æœåŠ¡\n\n```\ncd /Applications/ejabberd-19.02\n//å¼€å¯æœåŠ¡\n./bin/ejabberdctl start  \n//çŠ¶æ€\n./bin/ejabberdctl status  \n\n// help æŸ¥çœ‹æ›´å¤šåŠŸèƒ½å“¦\n./bin/ejabberdctl help \n```\n\n#### æ³¨å†Œè´¦æˆ·\n\næ‰“å¼€ [admin é¡µé¢](http://localhost:5280/admin/), è™šæ‹Ÿä¸»æœº -> localhost(å¯èƒ½ä½ çš„åå­—ä¸ä¸€æ ·) -> ç”¨æˆ·ã€‚ ç°åœ¨ä½ å¯ä»¥è‡ªå·±åˆ›å»ºè´¦æˆ·äº†ã€‚\n\n![578b88b6.png](/img/32c16f22-9862-45e8-b15f-1b1eceb7b30f/578b88b6.png)\n\n\nå¦‚æœæœ‰è‡ªå®šä¹‰éœ€æ±‚,é…ç½®æ•™ç¨‹ [Configuring ejabberd \\| ejabberd Docs](https://docs.ejabberd.im/admin/configuration/#mod-http-ws) \n \n#### å®¢æˆ·ç«¯ç©èµ·æ¥\n\nå®¢æˆ·ç«¯æœ‰å¾ˆå¤š[é€‰æ‹©](https://xmpp.org/software/clients.html)ï¼Œä¸è¿‡å¤§å¤šæ•°éƒ½æ˜¯æ¸£ã€‚å¦‚æœæ˜¯WebSocketï¼Œç”¨è¿™ä¸ª [GitHub - processone/xmpp-websocket-client: Test XMPP Websocket client](https://github.com/processone/xmpp-websocket-client) è°ƒè¯•å¯ä»¥çœ‹åˆ°stanzaï¼ŒæŒºæ–¹ä¾¿çš„ã€‚\n\nå¦‚æœMacç”¨æˆ·æŠ¥authé—®é¢˜ï¼Œå¯ä»¥æ‰“å¼€`vim conf/ejabberd.yml`, `tls`é…ç½®æˆ`false`\n![5202ee46.png](/img/32c16f22-9862-45e8-b15f-1b1eceb7b30f/5202ee46.png)\n\n#### å…³äºjs lib\næ‰“ç®—ç”¨React Nativeå†™ï¼Œlibé€‰äº† [GitHub - xmppjs/xmpp.js: XMPP for JavaScript](https://github.com/xmppjs/xmpp.js) ã€‚å½“ç„¶ Webå¤šç”¨æ¡†æ¶ Strophe.jsã€‚è¿™å„¿æœ‰ä¸ªç®€å•æ¯”è¾ƒ[How do you compare to strophe.js Â· Issue #217 Â· xmppjs/xmpp.js Â· GitHub](https://github.com/xmppjs/xmpp.js/issues/217)\n\n### å…¶ä»–èµ„æ–™\n\n- ç®€å•ä»‹ç» [A friendly introduction to XMPP â€“ blikoon](https://www.blikoontech.com/xmpp/xmpp-a-soft-friendly-introduction)\n\n- å®˜æ–¹åè®®å¾ˆè¯¦ç»†ï¼Œä¾‹å­ä¹Ÿå¾ˆå½¢è±¡ã€‚ [Extensible Messaging and Presence Protocol (XMPP): Core](https://xmpp.org/rfcs/rfc6120.html#tls)\n\n- å¦‚ä½•é€‰æ‹©å³æ—¶é€šè®¯åº”ç”¨çš„æ•°æ®ä¼ è¾“æ ¼å¼ [å¦‚ä½•é€‰æ‹©å³æ—¶é€šè®¯åº”ç”¨çš„æ•°æ®ä¼ è¾“æ ¼å¼-å…¶å®ƒåˆ†äº«/ä¸“é¡¹æŠ€æœ¯åŒº - å³æ—¶é€šè®¯å¼€å‘è€…ç¤¾åŒº!](http://www.52im.net/thread-276-1-1.html)\n- å¼ºåˆ—å»ºè®®å°†Protobufä½œä¸ºä½ çš„å³æ—¶é€šè®¯åº”ç”¨æ•°æ®ä¼ è¾“æ ¼å¼ [å¼ºåˆ—å»ºè®®å°†Protobufä½œä¸ºä½ çš„å³æ—¶é€šè®¯åº”ç”¨æ•°æ®ä¼ è¾“æ ¼å¼-å…¶å®ƒåˆ†äº«/ä¸“é¡¹æŠ€æœ¯åŒº - å³æ—¶é€šè®¯å¼€å‘è€…ç¤¾åŒº!](http://www.52im.net/thread-277-1-1.html) \n\n\n\n\n","tags":["XMPP"],"categories":["NetWork"]}]